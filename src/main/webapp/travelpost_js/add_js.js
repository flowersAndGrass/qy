function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(t){"use strict";function e(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i}function i(t,e){return t<<e|t>>>32-e}function n(t,n,o,r,a,s){return e(i(e(e(n,t),e(r,s)),a),o)}function o(t,e,i,o,r,a,s){return n(e&i|~e&o,t,e,r,a,s)}function r(t,e,i,o,r,a,s){return n(e&o|i&~o,t,e,r,a,s)}function a(t,e,i,o,r,a,s){return n(e^i^o,t,e,r,a,s)}function s(t,e,i,o,r,a,s){return n(i^(e|~o),t,e,r,a,s)}function l(t,i){t[i>>5]|=128<<i%32,t[(i+64>>>9<<4)+14]=i;var n,l,d,c,u,p=1732584193,f=-271733879,h=-1732584194,m=271733878;for(n=0;n<t.length;n+=16)l=p,d=f,c=h,u=m,p=o(p,f,h,m,t[n],7,-680876936),m=o(m,p,f,h,t[n+1],12,-389564586),h=o(h,m,p,f,t[n+2],17,606105819),f=o(f,h,m,p,t[n+3],22,-1044525330),p=o(p,f,h,m,t[n+4],7,-176418897),m=o(m,p,f,h,t[n+5],12,1200080426),h=o(h,m,p,f,t[n+6],17,-1473231341),f=o(f,h,m,p,t[n+7],22,-45705983),p=o(p,f,h,m,t[n+8],7,1770035416),m=o(m,p,f,h,t[n+9],12,-1958414417),h=o(h,m,p,f,t[n+10],17,-42063),f=o(f,h,m,p,t[n+11],22,-1990404162),p=o(p,f,h,m,t[n+12],7,1804603682),m=o(m,p,f,h,t[n+13],12,-40341101),h=o(h,m,p,f,t[n+14],17,-1502002290),f=o(f,h,m,p,t[n+15],22,1236535329),p=r(p,f,h,m,t[n+1],5,-165796510),m=r(m,p,f,h,t[n+6],9,-1069501632),h=r(h,m,p,f,t[n+11],14,643717713),f=r(f,h,m,p,t[n],20,-373897302),p=r(p,f,h,m,t[n+5],5,-701558691),m=r(m,p,f,h,t[n+10],9,38016083),h=r(h,m,p,f,t[n+15],14,-660478335),f=r(f,h,m,p,t[n+4],20,-405537848),p=r(p,f,h,m,t[n+9],5,568446438),m=r(m,p,f,h,t[n+14],9,-1019803690),h=r(h,m,p,f,t[n+3],14,-187363961),f=r(f,h,m,p,t[n+8],20,1163531501),p=r(p,f,h,m,t[n+13],5,-1444681467),m=r(m,p,f,h,t[n+2],9,-51403784),h=r(h,m,p,f,t[n+7],14,1735328473),f=r(f,h,m,p,t[n+12],20,-1926607734),p=a(p,f,h,m,t[n+5],4,-378558),m=a(m,p,f,h,t[n+8],11,-2022574463),h=a(h,m,p,f,t[n+11],16,1839030562),f=a(f,h,m,p,t[n+14],23,-35309556),p=a(p,f,h,m,t[n+1],4,-1530992060),m=a(m,p,f,h,t[n+4],11,1272893353),h=a(h,m,p,f,t[n+7],16,-155497632),f=a(f,h,m,p,t[n+10],23,-1094730640),p=a(p,f,h,m,t[n+13],4,681279174),m=a(m,p,f,h,t[n],11,-358537222),h=a(h,m,p,f,t[n+3],16,-722521979),f=a(f,h,m,p,t[n+6],23,76029189),p=a(p,f,h,m,t[n+9],4,-640364487),m=a(m,p,f,h,t[n+12],11,-421815835),h=a(h,m,p,f,t[n+15],16,530742520),f=a(f,h,m,p,t[n+2],23,-995338651),p=s(p,f,h,m,t[n],6,-198630844),m=s(m,p,f,h,t[n+7],10,1126891415),h=s(h,m,p,f,t[n+14],15,-1416354905),f=s(f,h,m,p,t[n+5],21,-57434055),p=s(p,f,h,m,t[n+12],6,1700485571),m=s(m,p,f,h,t[n+3],10,-1894986606),h=s(h,m,p,f,t[n+10],15,-1051523),f=s(f,h,m,p,t[n+1],21,-2054922799),p=s(p,f,h,m,t[n+8],6,1873313359),m=s(m,p,f,h,t[n+15],10,-30611744),h=s(h,m,p,f,t[n+6],15,-1560198380),f=s(f,h,m,p,t[n+13],21,1309151649),p=s(p,f,h,m,t[n+4],6,-145523070),m=s(m,p,f,h,t[n+11],10,-1120210379),h=s(h,m,p,f,t[n+2],15,718787259),f=s(f,h,m,p,t[n+9],21,-343485551),p=e(p,l),f=e(f,d),h=e(h,c),m=e(m,u);return[p,f,h,m]}function d(t){var e,i="";for(e=0;e<32*t.length;e+=8)i+=String.fromCharCode(t[e>>5]>>>e%32&255);return i}function c(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;e<i.length;e+=1)i[e]=0;for(e=0;e<8*t.length;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function u(t){return d(l(c(t),8*t.length))}function p(t,e){var i,n,o=c(t),r=[],a=[];for(r[15]=a[15]=void 0,o.length>16&&(o=l(o,8*t.length)),i=0;16>i;i+=1)r[i]=909522486^o[i],a[i]=1549556828^o[i];return n=l(r.concat(c(e)),512+8*e.length),d(l(a.concat(n),640))}function f(t){var e,i,n="0123456789abcdef",o="";for(i=0;i<t.length;i+=1)e=t.charCodeAt(i),o+=n.charAt(e>>>4&15)+n.charAt(15&e);return o}function h(t){return unescape(encodeURIComponent(t))}function m(t){return u(h(t))}function g(t){return f(m(t))}function v(t,e){return p(h(t),h(e))}function b(t,e){return f(v(t,e))}function x(t,e,i){return e?i?v(e,t):b(e,t):i?m(t):g(t)}t.md5=x}(this),define("assets/issue/constant",[],function(){var t=window.__pageData__,e=0,i=0,n=0,o="",r=0,a=0,s=0;return t&&(n=+t.threadType[0],o=t.threadType[1],i=t.tid,r=t.plan_id,t.forumInfo&&(e=+t.forumInfo.id)),window.BBS&&window.BBS.TID&&!+i&&(i=window.BBS.TID),window.QYER&&window.QYER.uid&&(a=window.QYER.uid),window.BBS&&+window.BBS.ISWRITER&&(s=+window.BBS.ISWRITER),{fid:e,threadType:n,threadTypeName:o,tid:i,planId:r,uid:a,isWriter:s}}),define("assets/issue/editor",[],function(){var t=function(){},e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.theme,n=void 0===i?"simple":i,o=e.id,r=void 0===o?"senior_editor":o,a=e.saveSceneHandler,s=void 0===a?t:a,l=e.initialContent,d=void 0===l?"":l,c=e.toolbars,u=void 0===c?["stylecontrol","bbs_common"]:c,p=e.bbs_font,f=void 0===p||p,h=e.pasteplain,m=void 0===h||h,g=e.initialFrameHeight,v=void 0===g?document.documentElement.clientHeight-160:g,b=e.focus,x=void 0===b||b,_=e.isSubmit,y=void 0!==_&&_,w=e.filterTxtRules,E={theme:n,initialContent:d,toolbars:u,bbs_font:f,pasteplain:m,initialFrameHeight:v,focus:x};y&&(E.isSubmit=!0),w&&(E.filterTxtRules=w);var k=UE.getEditor(r,E);k.addListener("saveScene",s);var T=$.Deferred();return k.ready(function(){T.resolve(k)}),T.promise()};return e});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();define("assets/issue/draft/draftFactory",[],function(){var t=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"loadDraft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.okText,i=void 0===e?"继续写草稿":e,n=t.cancelText,o=void 0===n?"删除草稿写新帖":n,r=t.count,a=void 0===r?3:r,s=t.statusDom,l=void 0===s?$(".qy_issue_mask .text"):s,d=t.deleteHandler,c=void 0===d?function(){}:d,u=t.mode,p=void 0===u?"pub":u,f=t.saveBtn,h=void 0===f?$(".saveBtns .save"):f,m=t.saveBackBtn,g=void 0===m?$(".save-back"):m,v=t.delayRead,b=void 0!==v&&v,x=this.genDraft(p);return x.beforeunload(),!b&&x.read({okText:i,cancelText:o,count:a,statusDom:l,deleteHandler:c}),x.bindEvent(h,g),x}},{key:"genDraft",value:function(){throw new Error("Unsupported opteration on an abstract class.")}}]),t}();return{DraftFactory:t}}),define("common/models/basic/js/normalize",[],function(){function t(t,i,o){if(t.match(s)||t.match(a))return t;t=r(t);var l=o.match(a),d=i.match(a);return!d||l&&l[1]==d[1]&&l[2]==d[2]?n(e(t,i),o):e(t,i)}function e(t,e){if("./"==t.substr(0,2)&&(t=t.substr(2)),t.match(s)||t.match(a))return t;var i=e.split("/"),n=t.split("/");for(i.pop();curPart=n.shift();)".."==curPart?i.pop():i.push(curPart);return i.join("/")}function n(t,e){var n=e.split("/");for(n.pop(),e=n.join("/")+"/",i=0;e.substr(i,1)==t.substr(i,1);)i++;for(;"/"!=e.substr(i,1);)i--;e=e.substr(i+1),t=t.substr(i+1),n=e.split("/");var o=t.split("/");for(out="";n.shift();)out+="../";for(;curPart=o.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var o=/([^:])\/+/g,r=function(t){return t.replace(o,"$1/")},a=/[^\:\/]*:\/\/([^\/])*/,s=/^(\/|data:)/,l=function(e,i,n){i=r(i),n=r(n);for(var o,a,e,s=/@import\s*("([^"]*)"|'([^']*)')|url\s*\((?!#)\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;o=s.exec(e);){a=o[3]||o[2]||o[5]||o[6]||o[4];var l;l=t(a,i,n);var d=o[5]||o[6]?1:0;e=e.substr(0,s.lastIndex-a.length-d-1)+l+e.substr(s.lastIndex-d-1),s.lastIndex=s.lastIndex+(l.length-a.length)}return e};return l.convertURIBase=t,l.absoluteURI=e,l.relativeURI=n,l}),define("common/models/basic/js/require-css",[],function(){if("undefined"==typeof window)return{load:function(t,e,i){i()}};var t=document.getElementsByTagName("head")[0],e=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,i=!1,n=!0;e[1]||e[7]?i=parseInt(e[1])<6||parseInt(e[7])<=9:e[2]||e[8]?n=!1:e[4]&&(i=parseInt(e[4])<18);var o={};o.pluginBuilder="./css-builder";var r,a,s,l=function(){r=document.createElement("style"),t.appendChild(r),a=r.styleSheet||r.sheet},d=0,c=[],u=function(t){d++,32==d&&(l(),d=0),a.addImport(t),r.onload=function(){p()}},p=function(){s();var t=c.shift();return t?(s=t[1],void u(t[0])):void(s=null)},f=function(t,e){if(a&&a.addImport||l(),a&&a.addImport)s?c.push([t,e]):(u(t),s=e);else{r.textContent='@import "'+t+'";';var i=setInterval(function(){try{r.sheet.cssRules,clearInterval(i),e()}catch(t){}},10)}},h=function(e,i){var o=document.createElement("link");if(o.type="text/css",o.rel="stylesheet",n)o.onload=function(){o.onload=function(){},setTimeout(i,7)};else var r=setInterval(function(){for(var t=0;t<document.styleSheets.length;t++){var e=document.styleSheets[t];if(e.href==o.href)return clearInterval(r),i()}},10);o.href=e,t.appendChild(o)};return o.normalize=function(t,e){return".css"==t.substr(t.length-4,4)&&(t=t.substr(0,t.length-4)),e(t)},o.load=function(t,e,n,o){(i?f:h)(e.toUrl(t+".css"),n)},o}),define("common/models/basic/js/require-css!web_old_popup",[],function(){}),define("web_old_popup",["css!web_old_popup"],function(){var t=jQuery,e={$ui:null,$content:null,$box:null,$title:null,$okBtn:null,$cancelBtn:null,$loadBtn:null,$closeIcon:null,$bottomBtns:null,_uiState:"normal",defaultWidth:400,init:function(){var e=['<div class="qui-popup" style="display:none">',"<div>",'<div class="qui-popup-dt">','<div class="qui-popup-box">','<div class="qui-popup-closeIcon">&nbsp;</div>','<div class="qui-popup-box-title fontYaHei">title</div>','<div class="qui-popup-box-content">',"</div>",'<div class="qui-popup-box-bottom">',"&nbsp;",'<input class="qui-popup-cancelBtn ui_button_cancel" type="button" value="取消" />  ','<input class="qui-popup-okBtn ui_button" type="button" value="确定" />  ','<input class="qui-popup-loadingBtn  ui_button_load" type="button" value="" />  ',"</div>","</div>","</div>","</div>","</div>"].join("");this.$ui=t(e),this.$content=this.$ui.find(".qui-popup-box-content"),this.$box=this.$ui.find(".qui-popup-box"),this.$title=this.$ui.find(".qui-popup-box-title"),this.$okBtn=this.$ui.find(".qui-popup-okBtn"),this.$cancelBtn=this.$ui.find(".qui-popup-cancelBtn"),this.$loadBtn=this.$ui.find(".qui-popup-loadingBtn"),this.$closeIcon=this.$ui.find(".qui-popup-closeIcon"),this.$bottomBtns=this.$ui.find(".qui-popup-box-bottom"),this.$ui.appendTo(document.body)},setWidth:function(t){this.$box.animate({width:t},300)},setUIDefault:function(t){this.$ui[0].className="qui-popup",t.exClassName&&this.$ui.addClass(t.exClassName),t.iframeSrc?this.$content.html('<iframe src="'+t.iframeSrc+'"  scrolling="auto" style="height:'+(t.iframeHeight||300)+'px;"  />'):this.$content.html(t.contentHTML||"&nbsp;"),this.$title.html(t.title||"Title"),this.$box.css("width",t.width||this.defaultWidth),this.$title[t.showTitle===!1?"hide":"show"](),this.$okBtn.val(t.okText||"确定"),this.$cancelBtn.val(t.cancelText||"取消"),t.showBottomBtns===!1&&this.$bottomBtns.hide(),this.$okBtn[t.showOKBtn===!1?"hide":"show"](),this.$okBtn.removeAttr("data-bn-ipg"),this.$cancelBtn[t.showCancelBtn===!1?"hide":"show"](),this.$cancelBtn.removeAttr("data-bn-ipg"),this.$loadBtn[t.showLoadBtn===!0?"show":"hide"](),this.$loadBtn.removeAttr("data-bn-ipg"),this.$ui.find(".qui-popup-closeIcon").removeAttr("data-bn-ipg"),this.$closeIcon[t.showCloseIcon===!1?"hide":"show"]()},show:function(i){if("hideing"==e._uiState)e.$box.stop(),e.$ui.stop(),this.$ui.css({display:"block",opacity:1}),this.$box.css({top:0,opacity:1}),e._uiState="normal",i.onShow&&i.onShow();else{e._uiState="showing";var n={},o={top:0};t.support.leadingWhitespace&&(n.opacity=1,o.opacity=1),this.$ui.css("display","block").animate(n,200,function(){e.$box.css("top",-30).animate(o,200,function(){e._uiState="normal",i.onShow&&i.onShow()})})}},hide:function(i){if(!i||!i.onBeforeHide||i.onBeforeHide()!==!1){e._uiState="hideing";var n={top:-30},o={};t.support.leadingWhitespace&&(n.opacity=0,o.opacity=0),this.$box.animate(n,200,function(){e.$ui.animate(o,200,function(){e._uiState="normal",e.$ui.css("display","none"),e.$content.html(""),i&&i.onAfterHide&&i.onAfterHide()})})}}};e.init();var i=null,n={show:function(t){return i=t,e.setUIDefault(t),e.$ui.undelegate("click").delegate(".qui-popup-okBtn,.qui-popup-cancelBtn,.qui-popup-closeIcon","click",function(i){if(-1!=this.className.indexOf("qui-popup-closeIcon")||-1!=this.className.indexOf("qui-popup-cancelBtn")){if(t.onBeforeCancel&&!t.onBeforeCancel(i))return;t.onCancel&&t.onCancel()}else if(-1!=this.className.indexOf("qui-popup-okBtn")&&t.onOK&&t.onOK()===!1)return;e.hide(t)}),e.show(t),this},hide:function(){return e.hide(),this},setContent:function(t){return e.$content.html(t),this},getContent:function(){return e.$content[0]},getButtons:function(){return{okBtn:e.$okBtn[0],cancelBtn:e.$cancelBtn[0],loadBtn:e.$loadBtn[0],closeIcon:e.$ui.find(".qui-popup-closeIcon")[0]}},setOption:function(n){var o={width:function(){e.setWidth(n.width)},showTitle:function(){n.showTitle===!1?e.$title.hide():e.$title.show()},showBottomBtns:function(){n.showBottomBtns===!1?e.$bottomBtns.hide():e.$bottomBtns.show()},okText:function(){e.$okBtn.val(n.okText)},cancelText:function(){e.$cancelBtn.val(n.cancelText)},showOKBtn:function(){n.showOKBtn===!1?e.$okBtn.hide():e.$okBtn.show()},showCancelBtn:function(){n.showCancelBtn===!1?e.$cancelBtn.hide():e.$cancelBtn.show()},showLoadBtn:function(){n.showLoadBtn===!1?e.$loadBtn.hide():e.$loadBtn.show()},showCloseIcon:function(){n.showCloseIcon===!1?e.$closeIcon.hide():e.$closeIcon.show()},title:function(){e.$title.html(n.title)},exClassName:function(){e.$ui[0].className="qui-popup "+n.exClassName},contentHTML:function(){n.iframeSrc||e.$content.html(n.contentHTML)},iframeSrc:function(){e.$content.html('<iframe src="'+n.iframeSrc+'"  scrolling="auto" style="height:'+(n.iframeHeight||300)+'px;" />')},iframeHeight:function(){e.$content.children("iframe").css("height",n.iframeHeight)}};for(var r in n)i[r]=n[r],"function"==t.type(o[r])&&o[r]()}};return n}),define("common/models/basic/js/require-css!web_old_confirm",[],function(){}),define("web_old_confirm",["css!web_old_confirm"],function(){var t=jQuery,e={$ui:null,$box:null,$icon:null,$title:null,$text:null,init:function(){var i=['<div class="qui-confirm">',"<div>",'<div class="qui-confirm-box">','<div class="qui-confirm-box-title">',"title","</div>",'<div class="qui-confirm-box-content">','<div class="qui-confirm-box-content-icon"></div>','<div class="qui-confirm-box-content-text">',"提示文字","</div>",'<div class="qui-confirm-box-clearFloat">&nbsp;</div>',"</div>",'<div class="qui-confirm-box-bottom">','<input class="qui-confirm-okBtn ui_btn_small" type="button" value="确定" />  ','<input class="qui-confirm-cancelBtn ui_btn_small_cancel" type="button" value="取消" />  ',"</div>",'<div class="qui-confirm-closeIcon">&nbsp;</div>',"</div>","</div>","</div>"].join("");this.$ui=t(i),this.$box=e.$ui.find(".qui-confirm-box"),this.$title=e.$ui.find(".qui-confirm-box-title"),this.$icon=e.$ui.find(".qui-confirm-box-content-icon"),this.$text=e.$ui.find(".qui-confirm-box-content-text"),this.$ui.appendTo(document.body)},setUI:function(t){this.$text.html(t.text||""),this.$title.html(t.title||"提示"),this.$icon[0].className="qui-confirm-box-content-icon",this.$icon.addClass("ok"==t.type?"qui-confirm-box-content-iconOK":"error"==t.type?"qui-confirm-box-content-iconError":("warning"==t.type,"qui-confirm-box-content-iconWarning"))},show:function(){var i={},n={top:0};t.support.leadingWhitespace&&(i.opacity=1,n.opacity=1),this.$ui.css("display","table").animate(i,300,function(){e.$box.animate(n,200)})},hide:function(){var i={top:-30},n={};t.support.leadingWhitespace&&(i.opacity=0,n.opacity=0),this.$box.animate(i,200,function(){e.$ui.animate(n,300,function(){e.$ui.css("display","none")})})}};e.init();var i={confirm:function(t){return e.setUI(t),e.$ui.undelegate("click").delegate(".qui-confirm-okBtn,.qui-confirm-cancelBtn,.qui-confirm-closeIcon","click",function(i){-1!=this.className.indexOf("qui-confirm-closeIcon")||-1!=this.className.indexOf("qui-confirm-cancelBtn")?t.onCancel&&t.onCancel(i):-1!=this.className.indexOf("qui-confirm-okBtn")&&t.onOK&&t.onOK(i),e.hide()}),e.show(),this}};return i}),define("common/models/basic/js/require-css!web_old_tip",[],function(){}),define("web_old_tip",["css!web_old_tip"],function(){function t(t){n.html(t.text||"&nbsp;"),i[0].className="qui-tip-box","error"==t.type?i.addClass("qui-tip-box-error"):"warning"==t.type&&i.addClass("qui-tip-box-warning")}var e,i,n,o=jQuery;!function(){var t=['<div class="qui-tip" style="display:none;" >','<div class="qui-tip-box">','<span class="qui-tip-text fontYaHei">这里是提示文本</span>',"</div>","</div>"].join("");e=o(t),n=e.find(".qui-tip-text"),i=e.find(".qui-tip-box"),e.appendTo(document.body)}();var r={_timer:null,tip:function(i){return t(i),e.slideDown(200),window.clearTimeout(this._timer),this._timer=setTimeout(function(){e.slideUp(200)},i.time||3e3),this}};return r}),define("common/models/basic/js/require-css!web_old_inputautocomplete",[],function(){}),define("web_old_inputautocomplete",["css!web_old_inputautocomplete"],function(){function t(t){this.$obj=t.$obj,this.timer=null,this.isSearching=!1,this.$contentDiv=null,this.option=t.option,t.option.parent&&(this.$parent=e(t.option.parent)),this.init()}var e=jQuery;t.prototype={$obj:null,timer:null,option:null,isSearching:!1,$contentDiv:null,$parent:null,init:function(){this.createDomNode(),this.bindEvent()},createDomNode:function(){var t=['<div class="qui-inputAutocomplete" style="display:none;">','<ul class="qui-inputAutocomplete-ul" >','<li class="disableDefalut">loading ... </li>',"</ul>","</div>"].join("");if(this.$contentDiv=e(t),this.$obj.is(":visible")){var i={width:this.$obj.outerWidth()};if(!this.$parent){var n=this.$obj.offset();i.top=n.top+this.$obj.outerHeight(),i.left=n.left,n=null}this.$contentDiv.css(i)}this.$contentDiv.appendTo(this.$parent||document.body),t=i=null},_blurTimer:null,bindEvent:function(){var t=this;this.$obj.keyup(function(i){if(e.inArray(i.keyCode,[37,39])==-1)return 9==i.keyCode?(t.$contentDiv.hide(),void(t.option.onVoid&&t.option.onVoid(t.$obj[0]))):void(e.inArray(i.keyCode,[38,40,13])!=-1&&t.updateUI(i.keyCode))}).on("input",function(){e.trim(t.$obj.val())||t.option.isAllowEmptySeach?t.registSearch():(t.$contentDiv.hide(),t.option.onVoid&&t.option.onVoid(t.$obj[0]))}).blur(function(){t._blurTimer=window.setTimeout(function(){t.$contentDiv.is(":hidden")||t.option.isBlurClose!==!1&&t.$contentDiv.hide()},300),t.option.isBlurSelect&&t.option.onSelect&&t.option.onSelect.call(null,t.$contentDiv.find("li[data-select=true]").get(0),!0)}),this.option.isFocusedSeach&&this.$obj.focus(function(){(e.trim(t.$obj.val())||t.option.isAllowEmptySeach)&&t.registSearch()}),this.$contentDiv.delegate(".qui-inputAutocomplete-ul li","click",function(i){return i.target.className.indexOf("disableDefalut")!=-1?(i.stopPropagation(),void window.clearTimeout(t._blurTimer)):void(this.className.indexOf("disableDefalut")==-1&&(t.$obj.val(e(this).text()),t.$contentDiv.hide(),t.option.onSelect&&(t.option.onSelect.call(t.$obj[0],this),t.$contentDiv.html(""))))})},registSearch:function(){var t=this;this.isSearching=!1,window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){(e.trim(t.$obj.val())||t.option.isAllowEmptySeach)&&(t.isSearching=!0,t.showContentDiv(),t.option.onSearch.call(t.$obj[0]))},300)},showContentDiv:function(){var t=this;if(this.$contentDiv.is(":hidden")){if(this.$obj.is(":visible")){var i={width:this.$obj.outerWidth()};if(!this.$parent){var n=this.$obj.offset();i.top=n.top+this.$obj.outerHeight(),i.left=n.left,n=null}this.$contentDiv.css(i)}this.$contentDiv.show(),e(document).one("click",function(e){t.option.isBlurClose!==!1&&t.$contentDiv.hide()})}},updateUI:function(t){function i(){var t=o.find("li[data-select=true]"),e=o.find("li").index(t);t.attr("data-select",""),t.length?(t=o.find("li:not(.disableDefalut)").eq(e+1),t.length||(t=o.find("li:eq(0)"))):t=o.find("li:eq(0)"),t.attr("data-select","true"),t=null}function n(){var t=o.find("li[data-select=true]"),e=o.find("li").index(t);t.attr("data-select",""),t.length?(t=o.find("li:not(.disableDefalut)").eq(e-1),t.length||(t=o.find("li:eq("+(r-1)+")"))):t=o.find("li:eq("+(r-1)+")"),t.attr("data-select","true"),t=null}if(!this.$contentDiv.is(":hidden")){var o=this.$contentDiv.find(".qui-inputAutocomplete-ul"),r=o.find("li:not(.disableDefalut)").size();if(r&&(e.inArray(t,[38,40])!=-1&&(40==t?i():n()),this.option.enterSelect!==!1&&13==t)){var a=o.find("li[data-select=true]");a.length?(this.$obj.val(a.text()),this.option.onSelect&&(this.option.onSelect.call(this.$obj[0],a[0],!0),this.$contentDiv.html("")),this.$contentDiv.hide()):this.option.isBlurClose!==!1&&this.$contentDiv.hide()}}},pushHTML:function(t){if(this.$obj.is(":visible")){var e={width:this.$obj.outerWidth()};if(!this.$parent){var i=this.$obj.offset();e.top=i.top+this.$obj.outerHeight(),e.left=i.left,i=null}this.$contentDiv.css(e),e=null}this.$contentDiv.html(t),this.isSearching=!1;var n=this.$contentDiv.find(".qui-inputAutocomplete-ul > li:not(.disableDefalut)");n.length&&this.option.autoSelect&&n.eq(0).attr("data-select","true"),n=null},isShow:function(){return!this.$contentDiv.is(":hidden")},hide:function(){return this.$contentDiv.hide()},destroy:function(){this.$contentDiv.remove()}},e.fn.extend({qyerAutocomplete:function(i){var n,o,r=arguments;return e.each(this,function(a,s){n=e(s),"object"==e.type(i)?n.data("_autocomplete",new t({$obj:n,option:i})):"pushHTML"==i?n.data("_autocomplete").pushHTML(r[1]):"getContent"==i?o=n.data("_autocomplete").$contentDiv:"isShow"==i?o=n.data("_autocomplete").isShow():"hide"==i?n.data("_autocomplete").hide():"destroy"==i&&(n.data("_autocomplete").destroy(),n.data("_autocomplete",null))}),n=r=null,"undefined"==typeof o?this:o}})}),define("common/models/common/js/message",[],function(){function t(){this.__listeners__=[]}var e=jQuery;return t.prototype={msg:{},__listeners__:null,addListener:function(t){"object"==e.type(t)&&e.inArray(t,this.__listeners__)==-1&&this.__listeners__.push(t)},removeListener:function(t){var i=e.inArray(t,this.__listeners__);i!=-1&&this.__listeners__.splice(i,1),i=null},postMessage:function(t,i){for(var n,o,r=qyerUtil.sliceArguments(arguments,1),a=0,s=this.__listeners__.length;a<s;a++)n=this.__listeners__[a]||{},o=n[t],"function"==e.type(o)&&o.apply(n,r);r.length=0,n=o=null}},t}),define("common/models/common/component/planItinerary/message",["common/models/common/js/message"],function(t){var e=(jQuery,new t);return e.msg={onBasicModelLoaded:"onBasicModelLoaded",onDataAPIInit:"onDataAPIInit",onDepartureTimeChange:"onDepartureTimeChange",onIncludeComplete:"onIncludeComplete",onAddCity:"onAddCity",onAddCityFromAddPOI:"onAddCityFromAddPOI",onUpdateCity:"onUpdateCity",onUpdatePOI:"onUpdatePOI",oneDelHotel:"oneDelHotel",onAddHotel:"onAddHotel",onUpdateHotel:"onUpdateHotel",onUpdateTraffic:"onUpdateTraffic"},e}),define("common/models/common/component/planItinerary/dataAPI",["common/models/common/component/planItinerary/message"],function(t){function e(t){t.data&&(t.data.sourcetype=1),qyerUtil.doAjax(t)}var i=(jQuery,{_initAction:null,getInitAction:function(){return this._initAction},_topicType:1,getTopicType:function(){return this._topicType},listener:{onBasicModelLoaded:function(){i.initData()}},unListener:function(){},_createUrl:null,getCreateUrl:function(){return this._createUrl},_disableCell:{},getDisableCell:function(){return this._disableCell},init:function(){t.addListener(this.listener)},initData:function(){switch(this.getInitAction()){case"browse":i.unListener(),t.postMessage(t.msg.onDataAPIInit);break;case"empty":i.unListener(),t.postMessage(t.msg.onDataAPIInit);break;case"add":this.loadBasicData();break;case"edit":this.loadBasicData();break;case"guidance":this.loadBasicData()}},_planid:null,getPlanID:function(){return this._planid},_currencys:[],getCurrencyList:function(){return this._currencys},_startTime:null,getStartTime:function(){return this._startTime},_url:null,getPlanUrl:function(){return this._url},_tid:null,getTID:function(){return this._tid},getAllDay:function(){},loadBasicData:function(){var n={};n.posturl="/planapi/base.php?action=getcurrency",n.onSuccess=function(e){i._currencys=e.data.currency,i.unListener(),t.postMessage(t.msg.onDataAPIInit)},n.onError=function(){alert("获取基础数据失败，请刷新重试")},e(n)},setStartTime:function(t){t.onCallSuccessBefore=function(){i._startTime=t.data.starttime},t.posturl="/planapi/route.php?action=saveplan",e(t)},getToken:function(t){t.posturl="planapi/travelnote/route.php?action=gettoken",e(t)},insertDay:function(t){t.onCallSuccessBefore=function(t){t.data.onedayid=t.data.onedayid||t.data.id,t.data.pois=[],t.data.hotels=[],t.data.traffics=[],t.data.citys=[],t.data.tag_list&&t.data.tag_list.length&&(t.data.citys=t.data.tag_list)},t.posturl="/planapi/oneday.php?action=insertoneday",e(t)},delOneDay:function(t){t.posturl="/planapi/oneday.php?action=deloneday",e(t)},createPlan:function(t){t.onCallSuccessBefore=function(t){i._planid=t.data.id,i._startTime=t.data.start_time,i._url=t.data.url},t.posturl="/planapi/travelnote/route.php?action=createplan",e(t)},_page:1,getPage:function(){return this._page},getPlanData:function(t){t.onCallSuccessBefore=function(t){i._planid=t.data.id,i._startTime=t.data.start_time,i._url=t.data.url;for(var e,n=t.data.allday,o=0,r=n.length;o<r;o++)e=n[o].hotels,e&&e.length>1&&(n[o].hotels=[e[0]]);e=n=null},t.posturl="/planapi/travelnote/route.php?action=getplan&ajaxID=59239dc4733e86c93db2a1d0",e(t)},delOneDayNote:function(t){t.posturl="/planapi/travelnote/route.php?action=delonedaynote",e(t)},setLift:function(t){t.posturl="/planapi/travelnote/route.php?action=setlift",e(t)},copyPlan:function(t){t.posturl="/planapi/route.php?action=copyplan",e(t)},delPlan:function(t){t.onCallSuccessBefore=function(t){i._planid=null,i._startTime=null,i._url=null},t.posturl="/planapi/travelnote/route.php?action=removeplan",e(t)},getPlanList:function(t){t.__defaultData__=[],t.posturl="/planapi/travelnote/route.php?action=getmyplanlist",e(t)},includePlan:function(t){t.posturl="/planapi/travelnote/route.php?action=importplan",e(t)},updateCity:function(t){t.posturl="/planapi/oneday.php?action=updatecitylist",e(t)},getRecommendCityList:function(t){t.__defaultData__=[],t.posturl="/planapi/recommend.php?action=getrelatedcitylist",e(t)},getAddedCityList:function(t){t.__defaultData__=[],t.posturl="/planapi/route.php?action=getplancityunique",t.onCallSuccessBefore=function(t){t.data.unshift({})},e(t)},searchCity:function(t){t.__defaultData__=[],t.posturl="/planapi/place.php?action=searchcityonly",e(t)},searchPOI:function(t){t.__defaultData__=[],t.posturl="/planapi/poi.php?action=search",e(t)},getRecommendPOIList:function(t){t.__defaultData__={counts:0,list:[]},t.posturl="/planapi/travelnote/ra.php?action=getrecommendpoi",e(t)},updatePOI:function(t){t.posturl="/planapi/travelnote/poi.php?action=save",e(t)},searchHotel:function(t){t.__defaultData__=[],t.posturl="/planapi/hotel.php?action=searchhotel",e(t)},delHotel:function(t){t.posturl="/planapi/hotel.php?action=delhotel",e(t)},addHotel:function(t){t.posturl="/planapi/hotel.php?action=addhotel",e(t)},updateHotel:function(t){t.posturl="/planapi/hotel.php?action=updatehotel",e(t)},updataTraffic:function(t){t.__defaultData__={},t.posturl="/planapi/travelnote/traffic.php?action=save",e(t)}});return i.init(),i}),define("common/models/common/component/planItinerary/index",[],function(){function t(t){this.option=t,this.init()}var e,i=jQuery;t.prototype={option:null,init:function(){this.loadModels()},unInit:function(){for(var t in this)this[t]=null;e=null},loadModels:function(){i("#__planItinerary__").html('<div style="border:solid 1px #ccc;width:auto;text-align:center;font-size:16px;color:#aaa;background-color:#fff;height:40px;line-height:40px;">loading...</div>'),this.option.isNew&&i("#__planItinerary__").attr("data-isnew","true");var t=["common/models/common/component/planItinerary/tpl","common/models/common/component/planItinerary/dataAPI","common/models/common/component/planItinerary/message","common/models/common/component/planItinerary/model","css!common/models/common/component/planItinerary/planItinerary.css","common/models/common/ui/popup/popup","common/models/common/ui/tip/tip"];"browse"==this.option.action||"empty"==this.option.action?t.push("common/models/common/component/planItinerary/browser"):"add"!=this.option.action&&"edit"!=this.option.action&&"guidance"!=this.option.action||(t.push("common/models/common/component/planItinerary/model_city"),t.push("common/models/common/component/planItinerary/model_hotel"),t.push("common/models/common/component/planItinerary/model_poi"),t.push("common/models/common/component/planItinerary/model_traffic"),t.push("common/models/common/component/planItinerary/frame"),t.push("common/models/common/ui/datepicker/datepicker"),t.push("common/models/common/ui/select/select"),t.push("common/models/common/ui/inputValidation/inputValidation"),t.push("common/models/common/ui/slidConfirm/slidConfirm"),t.push("common/models/common/ui/confirm/confirm"),t.push("common/models/common/ui/inputAutocomplete/inputAutocomplete"),t.push("css!common/models/common/component/planItinerary/model.css")),requirejs(t,function(){t.length=0,t=null,requirejs(["common/models/common/component/planItinerary/message","common/models/common/component/planItinerary/dataAPI"],function(t,i){
i._planid=e.option.planid,i._initAction=e.option.action,i._createUrl=e.option.createUrl,i._tid=e.option.tid,i._topicType=e.option.topicType||1,i._disableCell=e.option.disableCell||{},t.postMessage(t.msg.onBasicModelLoaded)})})}};var n={init:function(i){e&&e.unInit(),e=new t(i)}};return n}),define("common/models/basic/js/require-css!web_old_loading",[],function(){}),define("web_old_loading",["css!web_old_loading"],function(){function t(t){i.find(".qui-loading-text").html(t.text||"loading ...")}var e=jQuery,i=null;!function(){var t=['<div class="qui-loading" style="display:none">',"<div>",'<div class="qui-loading-box">','<span class="qui-loading-text">loading ...</span>',"</div>","</div>","</div>"].join("");i=e(t),i.appendTo(document.body)}();var n={show:function(n,o){t(n);var r=e.support.leadingWhitespace?{opacity:1}:{};return i.css("display","table").animate(r,300,function(){o&&o()}),this},hide:function(t){var n=e.support.leadingWhitespace?{opacity:0}:{};return i.animate(n,300,function(){i.css("display","none",function(){t&&t()})}),this},setUI:function(e){return t(e),this}};return n}),define("common/models/basic/js/require-css!web_old_popup2",[],function(){}),define("web_old_popup2",["css!web_old_popup2"],function(){function t(t){return this.option=t,this.initUI(),this.ui.setUIDefault(this.option),this}var e=jQuery;return t.prototype={option:null,ui:null,initUI:function(){var t=this.ui={$ui:null,$content:null,$box:null,$title:null,$okBtn:null,$cancelBtn:null,$loadBtn:null,$closeIcon:null,defaultWidth:"auto"},i=['<div class="qui-popup2" style="display:none">',"<div>",'<div class="qui-popup2-dt">','<div class="qui-popup2-box">','<div class="qui-popup2-closeIcon">&nbsp;</div>','<div class="qui-popup2-box-title">title</div>','<div class="qui-popup2-box-content">',"</div>",'<div class="qui-popup2-box-bottom">',"&nbsp;",'<input class="qui-popup2-cancelBtn ui_button_cancel" type="button" value="取消" />  ','<input class="qui-popup2-okBtn ui_button" type="button" value="确定" />  ','<input class="qui-popup2-loadingBtn  ui_button_load" type="button" value="" />  ',"</div>","</div>","</div>","</div>","</div>"].join("");return t.$ui=e(i),t.$content=t.$ui.find(".qui-popup2-box-content"),t.$box=t.$ui.find(".qui-popup2-box"),t.$title=t.$ui.find(".qui-popup2-box-title"),t.$okBtn=t.$ui.find(".qui-popup2-okBtn"),t.$cancelBtn=t.$ui.find(".qui-popup2-cancelBtn"),t.$loadBtn=t.$ui.find(".qui-popup2-loadingBtn"),t.$closeIcon=t.$ui.find(".qui-popup2-closeIcon"),t.$bottom=t.$ui.find(".qui-popup2-box-bottom"),t.$ui.appendTo(document.body),t.option=this.option,t=i=null,e.extend(this.ui,{setWidth:function(t){this.$box.animate({width:t},300)},setUIDefault:function(t){this.$ui[0].className="qui-popup2",t.exClassName&&this.$ui.addClass(t.exClassName),t.iframeSrc?this.$content.html('<iframe src="'+t.iframeSrc+'"  scrolling="auto" style="height:'+(t.iframeHeight||300)+'px;"  />'):this.$content.html(t.contentHTML||"&nbsp;"),this.$title.html(t.title||"Title"),this.$box.css("width",t.width||this.defaultWidth),this.$title[t.showTitle===!1?"hide":"show"](),this.$okBtn.val(t.okText||"确定"),this.$cancelBtn.val(t.cancelText||"取消"),this.$okBtn[t.showOKBtn===!1?"hide":"show"](),this.$okBtn.removeAttr("data-bn-ipg"),this.$cancelBtn[t.showCancelBtn===!1?"hide":"show"](),this.$cancelBtn.removeAttr("data-bn-ipg"),this.$loadBtn[t.showLoadBtn===!0?"show":"hide"](),this.$loadBtn.removeAttr("data-bn-ipg"),this.$ui.find(".qui-popup2-closeIcon").removeAttr("data-bn-ipg"),this.$closeIcon[t.showCloseIcon===!1?"hide":"show"](),t.showOKBtn===!1&&t.showCancelBtn===!1&&this.$bottom.hide()},show:function(){var t={},i={top:0},n=this;e.support.leadingWhitespace&&(t.opacity=1,i.opacity=1),this.$ui.css("display","block").animate(t,200,function(){n.$box.css("top",-30).animate(i,200,function(){n.option.onShow&&n.option.onShow(),t=i=n=null})})},hide:function(t){var i={top:-30},n={},o=this;o.option&&o.option.onBeforeHide&&o.option.onBeforeHide()===!1||(e.support.leadingWhitespace&&(i.opacity=0,n.opacity=0),this.$box.animate(i,200,function(){o.$ui.animate(n,200,function(){t?o.$ui.hide():o.$ui.remove(),o.option&&o.option.onAfterHide&&o.option.onAfterHide(),i=n=o=null})}))}}),this},show:function(){var t=this;return this.ui.$ui.undelegate("click").delegate(".qui-popup2-okBtn,.qui-popup2-cancelBtn,.qui-popup2-closeIcon","click",function(e){if(this.className.indexOf("qui-popup2-closeIcon")!=-1||this.className.indexOf("qui-popup2-cancelBtn")!=-1){if(t.option.onBeforeCancel&&!t.option.onBeforeCancel(e))return;t.option.onCancel&&t.option.onCancel()}else if(this.className.indexOf("qui-popup2-okBtn")!=-1&&t.option.onOK&&t.option.onOK()===!1)return;t.ui.hide()}),this.ui.show(),this},hide:function(t){return this.ui.hide(t),this},setContent:function(t){return this.ui.$content.html(t),this},getContent:function(){return this.ui.$content[0]},getButtons:function(){return{okBtn:this.ui.$okBtn[0],cancelBtn:this.ui.$cancelBtn[0],loadBtn:this.ui.$loadBtn[0],closeIcon:this.ui.$ui.find(".qui-popup2-closeIcon")[0]}},setOption:function(t){var i=this.ui,n={width:function(){i.setWidth(t.width)},showTitle:function(){i.$title[t.showTitle===!1?"hide":"show"]()},okText:function(){i.$okBtn.val(t.okText)},cancelText:function(){i.$cancelBtn.val(t.cancelText)},showOKBtn:function(){i.$okBtn[t.showOKBtn===!1?"hide":"show"]()},showCancelBtn:function(){i.$cancelBtn[t.showCancelBtn===!1?"hide":"show"]()},showLoadBtn:function(){i.$loadBtn[t.showLoadBtn===!1?"hide":"show"]()},title:function(){i.$title.html(t.title)},exClassName:function(){i.$ui[0].className="qui-popup2 "+t.exClassName},contentHTML:function(){t.iframeSrc||i.$content.html(t.contentHTML)},iframeSrc:function(){i.$content.html('<iframe src="'+t.iframeSrc+'"  scrolling="auto" style="height:'+(t.iframeHeight||300)+'px;" />')},iframeHeight:function(){i.$content.children("iframe").css("height",t.iframeHeight)},showCloseIcon:function(){i.$closeIcon[t.showCloseIcon===!1?"hide":"show"]()}};for(var o in t)this.option[o]=t[o],"function"==e.type(n[o])&&n[o]();i=n=null}},t}),define("old/js/bbs_dlg_common",[],function(){var t=baidu.editor.browser;return{dlgOpt:{showTitle:!1,showCancelBtn:!1,showOKBtn:!1,showCloseIcon:!1},$focus:function(e){setTimeout(function(){if(t.ie){var i=e.createTextRange();i.collapse(!1),i.select()}else e.focus()},0)}}}),define("common/models/basic/js/require-css!old/css/bbs_dlg_common",[],function(){}),define("common/models/basic/js/require-css!old/css/bbs_video",[],function(){}),define("old/js/bbs_video",["web_old_popup2","old/js/bbs_dlg_common","css!old/css/bbs_dlg_common.css","css!old/css/bbs_video.css"],function(t,e){function i(t){this.init(t)}var n=0;return i.prototype={opt:{contentHTML:'<div class="qyEdit_append_pic clearfix"><div class="qyEdit_append_title clearfix"><strong class="text fontYaHei">插入视频</strong><a href="javascript:;" title="关闭" class="close"></a></div><div class="qyEdit_append_video"><div class="input"><input type="text" value="" placeholder="请输入视频网址" class="ui2_input" /><span class="toggleTip"></span></div><div class="tips"><p class="tip">仅支持优酷、腾讯视频、新浪视频</p><p class="error" id="BBSAddVideoError"><span></span>视频网址有错误，请重新输入</p></div></div><div class="qyEdit_append_button clearfix"><a href="javascript:;" class="btn ui_button">插入视频</a><a href="javascript:;" class="ui_button_cancel">取消</a></div></div>',exClassName:"editor_video",width:622},urlMap:{youku:"优酷",youtube:"youtube",sina:"新浪",56:"我乐",pps:"PPS影音",letv:"乐视网",tudou:"土豆",qq:"腾讯",ku6:"酷6",sohu:"搜狐",qyer:"穷游网"},editor:null,init:function(i){return $.extend(this,i||{}),this.popup=new t($.extend(e.dlgOpt,this.opt)),this.dom=this.popup.ui.$content,this},bindEvent:function(){function t(){var t,i=e.dom.find(".ui2_input").val(),o=e.dom.find(".btn");i&&(t=i.match("([a-z1-9]*).com"),o.removeClass("ui_button").addClass("ui_button_disabled"),i=null!=i.match(/^http:\/\//)?i:"http://"+i,e.setStatus("loading"),$.ajax({url:BBS_Url.checkVideo,data:{url:i},success:function(r){o.removeClass("ui_button_disabled").addClass("ui_button");var r=JSON.parse(r);0==r.error_code?(e.setStatus("correct"),r.data.swf&&(e.hide(),setTimeout(function(){var o=$("<div>"+r.data.title+"</div>");e.editor.execCommand("insertvideo",{url:r.data.swf,title:e.urlMap[t[1]]||"",src:i,poster:r.data.pic||"",live:r.data.live||0,videoTitle:o.text()}),$(document).trigger("x-editDomInsert",n)},500))):e.setTipError(!0,r.data.msg)}}))}var e=this;this.dom.off("click input keydown"),this.dom.on("click",".close",function(t){e.hide()}),this.dom.on("click",".ui_button_cancel",function(t){e.hide()}),this.dom.on("input",".ui2_input",function(){$(".qyEdit_append_video .error").css("display","none")}),this.dom.on("keydown",".ui2_input",function(e){13==e.keyCode&&t()}),this.dom.on("click",".btn",function(){n=$(window).scrollTop(),t()})},trim:function(t){return t.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},convert_url:function(t){return t?t=this.trim(t).replace(/v\.youku\.com\/v_show\/id_([\w\-=]+)\.html/i,"player.youku.com/player.php/sid/$1/v.swf").replace(/(www\.)?youtube\.com\/watch\?v=([\w\-]+)/i,"www.youtube.com/v/$2").replace(/youtu.be\/(\w+)$/i,"www.youtube.com/v/$1").replace(/v\.ku6\.com\/.+\/([\w\.]+)\.html.*$/i,"player.ku6.com/refer/$1/v.swf").replace(/www\.56\.com\/u\d+\/v_([\w\-]+)\.html/i,"player.56.com/v_$1.swf").replace(/www.56.com\/w\d+\/play_album\-aid\-\d+_vid\-([^.]+)\.html/i,"player.56.com/v_$1.swf").replace(/v\.pps\.tv\/play_([\w]+)\.html.*$/i,"player.pps.tv/player/sid/$1/v.swf").replace(/www\.letv\.com\/ptv\/vplay\/([\d]+)\.html.*$/i,"i7.imgs.letv.com/player/swfPlayer.swf?id=$1&autoplay=0").replace(/www\.tudou\.com\/programs\/view\/([\w\-]+)\/?/i,"www.tudou.com/v/$1").replace(/v\.qq\.com\/cover\/[\w]+\/[\w]+\/([\w]+)\.html/i,"static.video.qq.com/TPout.swf?vid=$1").replace(/v\.qq\.com\/.+[\?\&]vid=([^&]+).*$/i,"static.video.qq.com/TPout.swf?vid=$1").replace(/my\.tv\.sohu\.com\/[\w]+\/[\d]+\/([\d]+)\.shtml.*$/i,"share.vrs.sohu.com/my/v.swf&id=$1"):""},checkUrl:function(t){var e;return t?(t=this.convert_url(t),e=t.match("([a-z1-9]*).com"),e&&e.length>1?(this.setTipError(!1),t):(this.setTipError(!0),"")):(this.dom.find(".input").removeClass("inputError"),this.dom.find(".tips .error").hide(),this.dom.find(".tips .tip").show(),"")},setStatus:function(t){var e=this.dom.find(".toggleTip");e.removeClass("loading correct"),e.addClass(t).show()},setTipError:function(t,e){var i=this.dom.find(".input"),n=this.dom.find(".tips .error"),o=this.dom.find(".tips .tip"),r=this.dom.find(".toggleTip");t===!0?(i.addClass("inputError"),$("#BBSAddVideoError").html(e?"<span></span>"+e:"<span></span>视频url有错误，请重新输入"),o.hide(),n.show(),r.hide()):(i.removeClass("inputError"),o.show(),n.hide(),r.show())},show:function(){this.popup.show();var t=this.dom.find(".ui2_input");t.val(""),e.$focus(t[0]),this.dom.find(".toggleTip").hide(),this.checkUrl(),this.bindEvent()},hide:function(){this.popup.hide(!0)}},i}),!function(t,e){"use strict";function i(t,e){for(var i,n=[],r=0;r<t.length;++r){if(i=a[t[r]]||o(t[r]),!i)throw"module definition dependecy not found: "+t[r];n.push(i)}e.apply(null,n)}function n(t,n,o){if("string"!=typeof t)throw"invalid module definition, module id must be defined and be a string";if(n===e)throw"invalid module definition, dependencies must be specified";if(o===e)throw"invalid module definition, definition function must be specified";i(n,function(){a[t]=o.apply(null,arguments)})}function o(e){for(var i=t,n=e.split(/[.\/]/),o=0;o<n.length;++o){if(!i[n[o]])return;i=i[n[o]]}return i}function r(i){for(var n=0;n<i.length;n++){for(var o=t,r=i[n],s=r.split(/[.\/]/),l=0;l<s.length-1;++l)o[s[l]]===e&&(o[s[l]]={}),o=o[s[l]];o[s[s.length-1]]=a[r]}}var a={},s="moxie/core/utils/Basic",l="moxie/core/I18n",d="moxie/core/utils/Mime",c="moxie/core/utils/Env",u="moxie/core/utils/Dom",p="moxie/core/Exceptions",f="moxie/core/EventTarget",h="moxie/core/utils/Encode",m="moxie/runtime/Runtime",g="moxie/runtime/RuntimeClient",v="moxie/file/Blob",b="moxie/file/File",x="moxie/file/FileInput",_="moxie/file/FileDrop",y="moxie/runtime/RuntimeTarget",w="moxie/file/FileReader",E="moxie/core/utils/Url",k="moxie/file/FileReaderSync",T="moxie/xhr/FormData",q="moxie/xhr/XMLHttpRequest",S="moxie/runtime/Transporter",R="moxie/image/Image",$="moxie/runtime/html5/Runtime",C="moxie/runtime/html5/file/Blob",I="moxie/core/utils/Events",O="moxie/runtime/html5/file/FileInput",D="moxie/runtime/html5/file/FileDrop",A="moxie/runtime/html5/file/FileReader",j="moxie/runtime/html5/xhr/XMLHttpRequest",N="moxie/runtime/html5/utils/BinaryReader",B="moxie/runtime/html5/image/JPEGHeaders",U="moxie/runtime/html5/image/ExifParser",L="moxie/runtime/html5/image/JPEG",M="moxie/runtime/html5/image/PNG",z="moxie/runtime/html5/image/ImageInfo",F="moxie/runtime/html5/image/MegaPixel",P="moxie/runtime/html5/image/Image",H="moxie/runtime/flash/Runtime",G="moxie/runtime/flash/file/Blob",X="moxie/runtime/flash/file/FileInput",V="moxie/runtime/flash/file/FileReader",W="moxie/runtime/flash/file/FileReaderSync",J="moxie/runtime/flash/xhr/XMLHttpRequest",K="moxie/runtime/flash/runtime/Transporter",Y="moxie/runtime/flash/image/Image",Q="moxie/runtime/silverlight/Runtime",Z="moxie/runtime/silverlight/file/Blob",tt="moxie/runtime/silverlight/file/FileInput",et="moxie/runtime/silverlight/file/FileDrop",it="moxie/runtime/silverlight/file/FileReader",nt="moxie/runtime/silverlight/file/FileReaderSync",ot="moxie/runtime/silverlight/xhr/XMLHttpRequest",rt="moxie/runtime/silverlight/runtime/Transporter",at="moxie/runtime/silverlight/image/Image",st="moxie/runtime/html4/Runtime",lt="moxie/runtime/html4/file/FileInput",dt="moxie/runtime/html4/file/FileReader",ct="moxie/runtime/html4/xhr/XMLHttpRequest",ut="moxie/runtime/html4/image/Image";n(s,[],function(){var t=function(t){var e;return t===e?"undefined":null===t?"null":t.nodeType?"node":{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},e=function(n){var o;return i(arguments,function(r,s){s>0&&i(r,function(i,r){i!==o&&(t(n[r])===t(i)&&~a(t(i),["array","object"])?e(n[r],i):n[r]=i)})}),n},i=function(t,e){var i,n,o,r;if(t){try{i=t.length}catch(a){i=r}if(i===r){for(n in t)if(t.hasOwnProperty(n)&&e(t[n],n)===!1)return}else for(o=0;i>o;o++)if(e(t[o],o)===!1)return}},n=function(e){var i;if(!e||"object"!==t(e))return!0;for(i in e)return!1;return!0},o=function(e,i){function n(o){"function"===t(e[o])&&e[o](function(t){++o<r&&!t?n(o):i(t)})}var o=0,r=e.length;"function"!==t(i)&&(i=function(){}),e&&e.length||i(),n(o)},r=function(t,e){var n=0,o=t.length,r=new Array(o);i(t,function(t,i){t(function(t){if(t)return e(t);var a=[].slice.call(arguments);a.shift(),r[i]=a,n++,n===o&&(r.unshift(null),e.apply(this,r))})})},a=function(t,e){if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i}return-1},s=function(e,i){var n=[];"array"!==t(e)&&(e=[e]),"array"!==t(i)&&(i=[i]);for(var o in e)-1===a(e[o],i)&&n.push(e[o]);return!!n.length&&n},l=function(t,e){var n=[];return i(t,function(t){-1!==a(t,e)&&n.push(t)}),n.length?n:null},d=function(t){var e,i=[];for(e=0;e<t.length;e++)i[e]=t[e];return i},c=function(){var t=0;return function(e){var i,n=(new Date).getTime().toString(32);for(i=0;5>i;i++)n+=Math.floor(65535*Math.random()).toString(32);return(e||"o_")+n+(t++).toString(32)}}(),u=function(t){return t?String.prototype.trim?String.prototype.trim.call(t):t.toString().replace(/^\s*/,"").replace(/\s*$/,""):t},p=function(t){if("string"!=typeof t)return t;var e,i={t:1099511627776,g:1073741824,m:1048576,k:1024};return t=/^([0-9]+)([mgk]?)$/.exec(t.toLowerCase().replace(/[^0-9mkg]/g,"")),e=t[2],t=+t[1],i.hasOwnProperty(e)&&(t*=i[e]),t};return{guid:c,typeOf:t,extend:e,each:i,isEmptyObj:n,inSeries:o,inParallel:r,inArray:a,arrayDiff:s,arrayIntersect:l,toArray:d,trim:u,parseSizeStr:p}}),n(l,[s],function(t){var e={};return{addI18n:function(i){return t.extend(e,i)},translate:function(t){return e[t]||t},_:function(t){return this.translate(t)},sprintf:function(e){var i=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var e=i.shift();return"undefined"!==t.typeOf(e)?e:""})}}}),n(d,[s,l],function(t,e){var i="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",n={mimes:{},extensions:{},addMimeType:function(t){var e,i,n,o=t.split(/,/);for(e=0;e<o.length;e+=2){for(n=o[e+1].split(/ /),i=0;i<n.length;i++)this.mimes[n[i]]=o[e];this.extensions[o[e]]=n}},extList2mimes:function(e,i){var n,o,r,a,s=this,l=[];for(o=0;o<e.length;o++)for(n=e[o].extensions.split(/\s*,\s*/),r=0;r<n.length;r++){if("*"===n[r])return[];if(a=s.mimes[n[r]])-1===t.inArray(a,l)&&l.push(a);else{if(!i||!/^\w+$/.test(n[r]))return[];l.push("."+n[r])}}return l},mimes2exts:function(e){var i=this,n=[];return t.each(e,function(e){if("*"===e)return n=[],!1;var o=e.match(/^(\w+)\/(\*|\w+)$/);o&&("*"===o[2]?t.each(i.extensions,function(t,e){new RegExp("^"+o[1]+"/").test(e)&&[].push.apply(n,i.extensions[e])}):i.extensions[e]&&[].push.apply(n,i.extensions[e]))}),n},mimes2extList:function(i){var n=[],o=[];return"string"===t.typeOf(i)&&(i=t.trim(i).split(/\s*,\s*/)),o=this.mimes2exts(i),n.push({title:e.translate("Files"),extensions:o.length?o.join(","):"*"}),n.mimes=i,n},getFileExtension:function(t){var e=t&&t.match(/\.([^.]+)$/);return e?e[1].toLowerCase():""},getFileMime:function(t){return this.mimes[this.getFileExtension(t)]||""}};return n.addMimeType(i),n}),n(c,[s],function(t){function e(t,e,i){var n=0,o=0,r=0,a={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},s=function(t){return t=(""+t).replace(/[_\-+]/g,"."),t=t.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),t.length?t.split("."):[-8]},l=function(t){return t?isNaN(t)?a[t]||-7:parseInt(t,10):0};for(t=s(t),e=s(e),o=Math.max(t.length,e.length),n=0;o>n;n++)if(t[n]!=e[n]){if(t[n]=l(t[n]),e[n]=l(e[n]),t[n]<e[n]){r=-1;break}if(t[n]>e[n]){r=1;break}}if(!i)return r;switch(i){case">":case"gt":return r>0;case">=":case"ge":return r>=0;case"<=":case"le":return 0>=r;case"==":case"=":case"eq":return 0===r;case"<>":case"!=":case"ne":return 0!==r;case"":case"<":case"lt":return 0>r;default:return null}}var i=function(t){var e="",i="?",n="function",o="undefined",r="object",a="major",s="name",l="version",d={has:function(t,e){return-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()}},c={rgx:function(){for(var e,i,a,s,l,d,c,u=0,p=arguments;u<p.length;u+=2){var f=p[u],h=p[u+1];if(typeof e===o){e={};for(s in h)l=h[s],typeof l===r?e[l[0]]=t:e[l]=t}for(i=a=0;i<f.length;i++)if(d=f[i].exec(this.getUA())){for(s=0;s<h.length;s++)c=d[++a],l=h[s],typeof l===r&&l.length>0?2==l.length?e[l[0]]=typeof l[1]==n?l[1].call(this,c):l[1]:3==l.length?e[l[0]]=typeof l[1]!==n||l[1].exec&&l[1].test?c?c.replace(l[1],l[2]):t:c?l[1].call(this,c,l[2]):t:4==l.length&&(e[l[0]]=c?l[3].call(this,c.replace(l[1],l[2])):t):e[l]=c?c:t;break}if(d)break}return e},str:function(e,n){for(var o in n)if(typeof n[o]===r&&n[o].length>0){for(var a=0;a<n[o].length;a++)if(d.has(n[o][a],e))return o===i?t:o}else if(d.has(n[o],e))return o===i?t:o;return e}},u={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},p={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[s,l,a],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[s,"Opera"],l,a],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[s,l,a],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[s,"IE"],l,a],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[s,"Yandex"],l,a],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[s,/_/g," "],l,a],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[s,l,a],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[s,"Dolphin"],l,a],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[s,"Chrome"],l,a],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[s,"Android Browser"],l,a],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[l,a,[s,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[l,a,s],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[s,[a,c.str,u.browser.oldsafari.major],[l,c.str,u.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[s,l,a],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[s,"Netscape"],l,a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[s,l,a]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[s,l],[/rv\:([\w\.]+).*(gecko)/i],[l,s]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[s,[l,c.str,u.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[s,"Windows"],[l,c.str,u.os.windows.version]],[/\((bb)(10);/i],[[s,"BlackBerry"],l],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[s,l],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[s,"Symbian"],l],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[s,"Firefox OS"],l],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[s,l],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[s,"Chromium OS"],l],[/(sunos)\s?([\w\.]+\d)*/i],[[s,"Solaris"],l],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[s,l],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[s,"iOS"],[l,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[s,[l,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[s,l]]},f=function(t){var i=t||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:e);this.getBrowser=function(){return c.rgx.apply(this,p.browser)},this.getEngine=function(){return c.rgx.apply(this,p.engine)},this.getOS=function(){return c.rgx.apply(this,p.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return i},this.setUA=function(t){return i=t,this},this.setUA(i)};return(new f).getResult()}(),n=function(){var e={define_property:function(){return!1}(),create_canvas:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))}(),return_response_type:function(e){try{if(-1!==t.inArray(e,["","text","document"]))return!0;if(window.XMLHttpRequest){var i=new XMLHttpRequest;if(i.open("get","/"),"responseType"in i)return i.responseType=e,i.responseType===e}}catch(n){}return!1},use_data_uri:function(){var t=new Image;return t.onload=function(){e.use_data_uri=1===t.width&&1===t.height},setTimeout(function(){t.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return e.use_data_uri&&("IE"!==o.browser||o.version>=9)},use_data_uri_of:function(t){return e.use_data_uri&&33e3>t||e.use_data_uri_over32kb()},use_fileinput:function(){var t=document.createElement("input");return t.setAttribute("type","file"),!t.disabled}};return function(i){var n=[].slice.call(arguments);return n.shift(),"function"===t.typeOf(e[i])?e[i].apply(this,n):!!e[i]}}(),o={can:n,browser:i.browser.name,version:parseFloat(i.browser.major),os:i.os.name,osVersion:i.os.version,verComp:e,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return o.OS=o.os,o}),n(u,[c],function(t){var e=function(t){return"string"!=typeof t?t:document.getElementById(t)},i=function(t,e){if(!t.className)return!1;var i=new RegExp("(^|\\s+)"+e+"(\\s+|$)");return i.test(t.className)},n=function(t,e){i(t,e)||(t.className=t.className?t.className.replace(/\s+$/,"")+" "+e:e)},o=function(t,e){if(t.className){var i=new RegExp("(^|\\s+)"+e+"(\\s+|$)");t.className=t.className.replace(i,function(t,e,i){return" "===e&&" "===i?" ":""})}},r=function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null)[e]:void 0},a=function(e,i){function n(t){var e,i,n=0,o=0;return t&&(i=t.getBoundingClientRect(),e="CSS1Compat"===d.compatMode?d.documentElement:d.body,n=i.left+e.scrollLeft,o=i.top+e.scrollTop),{x:n,y:o}}var o,r,a,s=0,l=0,d=document;if(e=e,i=i||d.body,e&&e.getBoundingClientRect&&"IE"===t.browser&&(!d.documentMode||d.documentMode<8))return r=n(e),a=n(i),{x:r.x-a.x,y:r.y-a.y};for(o=e;o&&o!=i&&o.nodeType;)s+=o.offsetLeft||0,l+=o.offsetTop||0,o=o.offsetParent;for(o=e.parentNode;o&&o!=i&&o.nodeType;)s-=o.scrollLeft||0,l-=o.scrollTop||0,o=o.parentNode;return{x:s,y:l}},s=function(t){return{w:t.offsetWidth||t.clientWidth,h:t.offsetHeight||t.clientHeight}};return{get:e,hasClass:i,addClass:n,removeClass:o,getStyle:r,getPos:a,getSize:s}}),n(p,[s],function(t){function e(t,e){var i;for(i in t)if(t[i]===e)return i;return null}return{RuntimeError:function(){function i(t){this.code=t,this.name=e(n,t),this.message=this.name+": RuntimeError "+this.code}var n={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return t.extend(i,n),i.prototype=Error.prototype,i}(),OperationNotAllowedException:function(){function e(t){this.code=t,this.name="OperationNotAllowedException"}return t.extend(e,{NOT_ALLOWED_ERR:1}),e.prototype=Error.prototype,e}(),ImageError:function(){function i(t){this.code=t,this.name=e(n,t),this.message=this.name+": ImageError "+this.code}var n={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return t.extend(i,n),i.prototype=Error.prototype,i}(),FileException:function(){function i(t){this.code=t,this.name=e(n,t),this.message=this.name+": FileException "+this.code}var n={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return t.extend(i,n),i.prototype=Error.prototype,i}(),DOMException:function(){function i(t){this.code=t,this.name=e(n,t),this.message=this.name+": DOMException "+this.code}var n={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return t.extend(i,n),i.prototype=Error.prototype,i}(),EventException:function(){function e(t){this.code=t,this.name="EventException"}return t.extend(e,{UNSPECIFIED_EVENT_TYPE_ERR:0}),e.prototype=Error.prototype,e}()}}),n(f,[p,s],function(t,e){function i(){var i={};e.extend(this,{uid:null,init:function(){this.uid||(this.uid=e.guid("uid_"))},addEventListener:function(t,n,o,r){var a,s=this;return t=e.trim(t),/\s/.test(t)?void e.each(t.split(/\s+/),function(t){s.addEventListener(t,n,o,r)}):(t=t.toLowerCase(),o=parseInt(o,10)||0,a=i[this.uid]&&i[this.uid][t]||[],a.push({fn:n,priority:o,scope:r||this}),i[this.uid]||(i[this.uid]={}),void(i[this.uid][t]=a))},hasEventListener:function(t){return t?!(!i[this.uid]||!i[this.uid][t]):!!i[this.uid]},removeEventListener:function(t,n){t=t.toLowerCase();var o,r=i[this.uid]&&i[this.uid][t];if(r){if(n){for(o=r.length-1;o>=0;o--)if(r[o].fn===n){r.splice(o,1);break}}else r=[];r.length||(delete i[this.uid][t],e.isEmptyObj(i[this.uid])&&delete i[this.uid])}},removeAllEventListeners:function(){i[this.uid]&&delete i[this.uid]},dispatchEvent:function(n){var o,r,a,s,l,d={},c=!0;if("string"!==e.typeOf(n)){if(s=n,"string"!==e.typeOf(s.type))throw new t.EventException(t.EventException.UNSPECIFIED_EVENT_TYPE_ERR);n=s.type,s.total!==l&&s.loaded!==l&&(d.total=s.total,d.loaded=s.loaded),d.async=s.async||!1}if(-1!==n.indexOf("::")?function(t){o=t[0],n=t[1]}(n.split("::")):o=this.uid,n=n.toLowerCase(),r=i[o]&&i[o][n]){r.sort(function(t,e){return e.priority-t.priority}),a=[].slice.call(arguments),a.shift(),d.type=n,a.unshift(d);var u=[];e.each(r,function(t){a[0].target=t.scope,d.async?u.push(function(e){setTimeout(function(){e(t.fn.apply(t.scope,a)===!1)},1)}):u.push(function(e){e(t.fn.apply(t.scope,a)===!1)})}),u.length&&e.inSeries(u,function(t){c=!t})}return c},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(t){var i;"array"!==e.typeOf(t)&&(t=[t]);for(var n=0;n<t.length;n++)i="on"+t[n],"function"===e.typeOf(this[i])?this.addEventListener(t[n],this[i]):"undefined"===e.typeOf(this[i])&&(this[i]=null)}})}return i.instance=new i,i}),n(h,[],function(){var t=function(t){return unescape(encodeURIComponent(t))},e=function(t){return decodeURIComponent(escape(t))},i=function(t,i){if("function"==typeof window.atob)return i?e(window.atob(t)):window.atob(t);var n,o,r,a,s,l,d,c,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p=0,f=0,h="",m=[];if(!t)return t;t+="";do a=u.indexOf(t.charAt(p++)),s=u.indexOf(t.charAt(p++)),l=u.indexOf(t.charAt(p++)),d=u.indexOf(t.charAt(p++)),c=a<<18|s<<12|l<<6|d,n=255&c>>16,o=255&c>>8,r=255&c,m[f++]=64==l?String.fromCharCode(n):64==d?String.fromCharCode(n,o):String.fromCharCode(n,o,r);while(p<t.length);
return h=m.join(""),i?e(h):h},n=function(e,i){if(i&&t(e),"function"==typeof window.btoa)return window.btoa(e);var n,o,r,a,s,l,d,c,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p=0,f=0,h="",m=[];if(!e)return e;do n=e.charCodeAt(p++),o=e.charCodeAt(p++),r=e.charCodeAt(p++),c=n<<16|o<<8|r,a=63&c>>18,s=63&c>>12,l=63&c>>6,d=63&c,m[f++]=u.charAt(a)+u.charAt(s)+u.charAt(l)+u.charAt(d);while(p<e.length);h=m.join("");var g=e.length%3;return(g?h.slice(0,g-3):h)+"===".slice(g||3)};return{utf8_encode:t,utf8_decode:e,atob:i,btoa:n}}),n(m,[s,u,f],function(t,e,i){function n(i,o,a,s,l){var d,c=this,u=t.guid(o+"_"),p=l||"browser";i=i||{},r[u]=this,a=t.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},a),i.preferred_caps&&(p=n.getMode(s,i.preferred_caps,p)),d=function(){var e={};return{exec:function(t,i,n,o){return d[i]&&(e[t]||(e[t]={context:this,instance:new d[i]}),e[t].instance[n])?e[t].instance[n].apply(this,o):void 0},removeInstance:function(t){delete e[t]},removeAllInstances:function(){var i=this;t.each(e,function(e,n){"function"===t.typeOf(e.instance.destroy)&&e.instance.destroy.call(e.context),i.removeInstance(n)})}}}(),t.extend(this,{initialized:!1,uid:u,type:o,mode:n.getMode(s,i.required_caps,p),shimid:u+"_container",clients:0,options:i,can:function(e,i){var o=arguments[2]||a;if("string"===t.typeOf(e)&&"undefined"===t.typeOf(i)&&(e=n.parseCaps(e)),"object"===t.typeOf(e)){for(var r in e)if(!this.can(r,e[r],o))return!1;return!0}return"function"===t.typeOf(o[e])?o[e].call(this,i):i===o[e]},getShimContainer:function(){var i,n=e.get(this.shimid);return n||(i=this.options.container?e.get(this.options.container):document.body,n=document.createElement("div"),n.id=this.shimid,n.className="moxie-shim moxie-shim-"+this.type,t.extend(n.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),i.appendChild(n),i=null),n},getShim:function(){return d},shimExec:function(t,e){var i=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,t,e,i)},exec:function(t,e){var i=[].slice.call(arguments,2);return c[t]&&c[t][e]?c[t][e].apply(this,i):c.shimExec.apply(this,arguments)},destroy:function(){if(c){var t=e.get(this.shimid);t&&t.parentNode.removeChild(t),d&&d.removeAllInstances(),this.unbindAll(),delete r[this.uid],this.uid=null,u=c=d=t=null}}}),this.mode&&i.required_caps&&!this.can(i.required_caps)&&(this.mode=!1)}var o={},r={};return n.order="html5,flash,silverlight,html4",n.getRuntime=function(t){return!!r[t]&&r[t]},n.addConstructor=function(t,e){e.prototype=i.instance,o[t]=e},n.getConstructor=function(t){return o[t]||null},n.getInfo=function(t){var e=n.getRuntime(t);return e?{uid:e.uid,type:e.type,mode:e.mode,can:function(){return e.can.apply(e,arguments)}}:null},n.parseCaps=function(e){var i={};return"string"!==t.typeOf(e)?e||{}:(t.each(e.split(","),function(t){i[t]=!0}),i)},n.can=function(t,e){var i,o,r=n.getConstructor(t);return!!r&&(i=new r({required_caps:e}),o=i.mode,i.destroy(),!!o)},n.thatCan=function(t,e){var i=(e||n.order).split(/\s*,\s*/);for(var o in i)if(n.can(i[o],t))return i[o];return null},n.getMode=function(e,i,n){var o=null;if("undefined"===t.typeOf(n)&&(n="browser"),i&&!t.isEmptyObj(e)){if(t.each(i,function(i,n){if(e.hasOwnProperty(n)){var r=e[n](i);if("string"==typeof r&&(r=[r]),o){if(!(o=t.arrayIntersect(o,r)))return o=!1}else o=r}}),o)return-1!==t.inArray(n,o)?n:o[0];if(o===!1)return!1}return n},n.capTrue=function(){return!0},n.capFalse=function(){return!1},n.capTest=function(t){return function(){return!!t}},n}),n(g,[p,s,m],function(t,e,i){return function n(){var n;e.extend(this,{connectRuntime:function(o){function r(e){var a,l;return e.length?(a=e.shift(),(l=i.getConstructor(a))?(n=new l(o),n.bind("Init",function(){n.initialized=!0,setTimeout(function(){n.clients++,s.trigger("RuntimeInit",n)},1)}),n.bind("Error",function(){n.destroy(),r(e)}),n.mode?void n.init():void n.trigger("Error")):void r(e)):(s.trigger("RuntimeError",new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)),void(n=null))}var a,s=this;if("string"===e.typeOf(o)?a=o:"string"===e.typeOf(o.ruid)&&(a=o.ruid),a){if(n=i.getRuntime(a))return n.clients++,n;throw new t.RuntimeError(t.RuntimeError.NOT_INIT_ERR)}r((o.runtime_order||i.order).split(/\s*,\s*/))},getRuntime:function(){return n&&n.uid?n:(n=null,null)},disconnectRuntime:function(){n&&--n.clients<=0&&(n.destroy(),n=null)}})}}),n(v,[s,h,g],function(t,e,i){function n(r,a){function s(e,i,r){var a,s=o[this.uid];return"string"===t.typeOf(s)&&s.length?(a=new n(null,{type:r,size:i-e}),a.detach(s.substr(e,a.size)),a):null}i.call(this),r&&this.connectRuntime(r),a?"string"===t.typeOf(a)&&(a={data:a}):a={},t.extend(this,{uid:a.uid||t.guid("uid_"),ruid:r,size:a.size||0,type:a.type||"",slice:function(t,e,i){return this.isDetached()?s.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),t,e,i)},getSource:function(){return o[this.uid]?o[this.uid]:null},detach:function(t){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy",o[this.uid]),this.disconnectRuntime(),this.ruid=null),t=t||"";var i=t.match(/^data:([^;]*);base64,/);i&&(this.type=i[1],t=e.atob(t.substring(t.indexOf("base64,")+7))),this.size=t.length,o[this.uid]=t},isDetached:function(){return!this.ruid&&"string"===t.typeOf(o[this.uid])},destroy:function(){this.detach(),delete o[this.uid]}}),a.data?this.detach(a.data):o[this.uid]=a}var o={};return n}),n(b,[s,d,v],function(t,e,i){function n(n,o){var r,a;if(o||(o={}),a=o.type&&""!==o.type?o.type:e.getFileMime(o.name),o.name)r=o.name.replace(/\\/g,"/"),r=r.substr(r.lastIndexOf("/")+1);else{var s=a.split("/")[0];r=t.guid((""!==s?s:"file")+"_"),e.extensions[a]&&(r+="."+e.extensions[a][0])}i.apply(this,arguments),t.extend(this,{type:a||"",name:r||t.guid("file_"),lastModifiedDate:o.lastModifiedDate||(new Date).toLocaleString()})}return n.prototype=i.prototype,n}),n(x,[s,d,u,p,f,l,b,m,g],function(t,e,i,n,o,r,a,s,l){function d(o){var d,u,p,f=this;if(-1!==t.inArray(t.typeOf(o),["string","node"])&&(o={browse_button:o}),u=i.get(o.browse_button),!u)throw new n.DOMException(n.DOMException.NOT_FOUND_ERR);p={accept:[{title:r.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:u.parentNode||document.body},o=t.extend({},p,o),"string"==typeof o.required_caps&&(o.required_caps=s.parseCaps(o.required_caps)),"string"==typeof o.accept&&(o.accept=e.mimes2extList(o.accept)),d=i.get(o.container),d||(d=document.body),"static"===i.getStyle(d,"position")&&(d.style.position="relative"),d=u=null,l.call(f),t.extend(f,{uid:t.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){f.convertEventPropsToHandlers(c),f.bind("RuntimeInit",function(e,n){f.ruid=n.uid,f.shimid=n.shimid,f.bind("Ready",function(){f.trigger("Refresh")},999),f.bind("Change",function(){var e=n.exec.call(f,"FileInput","getFiles");f.files=[],t.each(e,function(t){return 0===t.size||void f.files.push(new a(f.ruid,t))})},999),f.bind("Refresh",function(){var e,r,a,s;a=i.get(o.browse_button),s=i.get(n.shimid),a&&(e=i.getPos(a,i.get(o.container)),r=i.getSize(a),s&&t.extend(s.style,{top:e.y+"px",left:e.x+"px",width:r.w+"px",height:r.h+"px"})),s=a=null}),n.exec.call(f,"FileInput","init",o)}),f.connectRuntime(t.extend({},o,{required_caps:{select_file:!0}}))},disable:function(e){var i=this.getRuntime();i&&i.exec.call(this,"FileInput","disable","undefined"===t.typeOf(e)||e)},refresh:function(){f.trigger("Refresh")},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===t.typeOf(this.files)&&t.each(this.files,function(t){t.destroy()}),this.files=null}})}var c=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return d.prototype=o.instance,d}),n(_,[l,u,p,s,b,g,f,d],function(t,e,i,n,o,r,a,s){function l(i){var a,l=this;"string"==typeof i&&(i={drop_zone:i}),a={accept:[{title:t.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},i="object"==typeof i?n.extend({},a,i):a,i.container=e.get(i.drop_zone)||document.body,"static"===e.getStyle(i.container,"position")&&(i.container.style.position="relative"),"string"==typeof i.accept&&(i.accept=s.mimes2extList(i.accept)),r.call(l),n.extend(l,{uid:n.guid("uid_"),ruid:null,files:null,init:function(){l.convertEventPropsToHandlers(d),l.bind("RuntimeInit",function(t,e){l.ruid=e.uid,l.bind("Drop",function(){var t=e.exec.call(l,"FileDrop","getFiles");l.files=[],n.each(t,function(t){l.files.push(new o(l.ruid,t))})},999),e.exec.call(l,"FileDrop","init",i),l.dispatchEvent("ready")}),l.connectRuntime(i)},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var d=["ready","dragenter","dragleave","drop","error"];return l.prototype=a.instance,l}),n(y,[s,g,f],function(t,e,i){function n(){this.uid=t.guid("uid_"),e.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return n.prototype=i.instance,n}),n(w,[s,h,p,f,v,b,y],function(t,e,i,n,o,r,a){function s(){function n(t,n){function c(t){d.readyState=s.DONE,d.error=t,d.trigger("error"),u()}function u(){r.destroy(),r=null,d.trigger("loadend")}function p(e){r.bind("Error",function(t,e){c(e)}),r.bind("Progress",function(t){d.result=e.exec.call(r,"FileReader","getResult"),d.trigger(t)}),r.bind("Load",function(t){d.readyState=s.DONE,d.result=e.exec.call(r,"FileReader","getResult"),d.trigger(t),u()}),e.exec.call(r,"FileReader","read",t,n)}if(r=new a,this.convertEventPropsToHandlers(l),this.readyState===s.LOADING)return c(new i.DOMException(i.DOMException.INVALID_STATE_ERR));if(this.readyState=s.LOADING,this.trigger("loadstart"),n instanceof o)if(n.isDetached()){var f=n.getSource();switch(t){case"readAsText":case"readAsBinaryString":this.result=f;break;case"readAsDataURL":this.result="data:"+n.type+";base64,"+e.btoa(f)}this.readyState=s.DONE,this.trigger("load"),u()}else p(r.connectRuntime(n.ruid));else c(new i.DOMException(i.DOMException.NOT_FOUND_ERR))}var r,d=this;t.extend(this,{uid:t.guid("uid_"),readyState:s.EMPTY,result:null,error:null,readAsBinaryString:function(t){n.call(this,"readAsBinaryString",t)},readAsDataURL:function(t){n.call(this,"readAsDataURL",t)},readAsText:function(t){n.call(this,"readAsText",t)},abort:function(){this.result=null,-1===t.inArray(this.readyState,[s.EMPTY,s.DONE])&&(this.readyState===s.LOADING&&(this.readyState=s.DONE),r&&r.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),r&&(r.getRuntime().exec.call(this,"FileReader","destroy"),r.disconnectRuntime()),d=r=null}})}var l=["loadstart","progress","load","abort","error","loadend"];return s.EMPTY=0,s.LOADING=1,s.DONE=2,s.prototype=n.instance,s}),n(E,[],function(){var t=function(e,i){for(var n=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],o=n.length,r={http:80,https:443},a={},s=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,l=s.exec(e||"");o--;)l[o]&&(a[n[o]]=l[o]);if(!a.scheme){i&&"string"!=typeof i||(i=t(i||document.location.href)),a.scheme=i.scheme,a.host=i.host,a.port=i.port;var d="";/^[^\/]/.test(a.path)&&(d=i.path,/(\/|\/[^\.]+)$/.test(d)?d+="/":d=d.replace(/\/[^\/]+$/,"/")),a.path=d+(a.path||"")}return a.port||(a.port=r[a.scheme]||80),a.port=parseInt(a.port,10),a.path||(a.path="/"),delete a.source,a},e=function(e){var i={http:80,https:443},n=t(e);return n.scheme+"://"+n.host+(n.port!==i[n.scheme]?":"+n.port:"")+n.path+(n.query?n.query:"")},i=function(e){function i(t){return[t.scheme,t.host,t.port].join("/")}return"string"==typeof e&&(e=t(e)),i(t())===i(e)};return{parseUrl:t,resolveUrl:e,hasSameOrigin:i}}),n(k,[s,g,h],function(t,e,i){return function(){function n(t,e){if(!e.isDetached()){var n=this.connectRuntime(e.ruid).exec.call(this,"FileReaderSync","read",t,e);return this.disconnectRuntime(),n}var o=e.getSource();switch(t){case"readAsBinaryString":return o;case"readAsDataURL":return"data:"+e.type+";base64,"+i.btoa(o);case"readAsText":for(var r="",a=0,s=o.length;s>a;a++)r+=String.fromCharCode(o[a]);return r}}e.call(this),t.extend(this,{uid:t.guid("uid_"),readAsBinaryString:function(t){return n.call(this,"readAsBinaryString",t)},readAsDataURL:function(t){return n.call(this,"readAsDataURL",t)},readAsText:function(t){return n.call(this,"readAsText",t)}})}}),n(T,[p,s,v],function(t,e,i){function n(){var t,n=[];e.extend(this,{append:function(o,r){var a=this,s=e.typeOf(r);r instanceof i?t={name:o,value:r}:"array"===s?(o+="[]",e.each(r,function(t){a.append(o,t)})):"object"===s?e.each(r,function(t,e){a.append(o+"["+e+"]",t)}):"null"===s||"undefined"===s||"number"===s&&isNaN(r)?a.append(o,"false"):n.push({name:o,value:r.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return t&&t.value||null},getBlobName:function(){return t&&t.name||null},each:function(i){e.each(n,function(t){i(t.value,t.name)}),t&&i(t.value,t.name)},destroy:function(){t=null,n=[]}})}return n}),n(q,[s,p,f,h,E,m,y,v,k,T,c,d],function(t,e,i,n,o,r,a,s,l,d,c,u){function p(){this.uid=t.guid("uid_")}function f(){function i(t,e){return q.hasOwnProperty(t)?1===arguments.length?c.can("define_property")?q[t]:T[t]:void(c.can("define_property")?q[t]=e:T[t]=e):void 0}function l(e){function n(){E.destroy(),E=null,s.dispatchEvent("loadend"),s=null}function o(o){E.bind("LoadStart",function(t){i("readyState",f.LOADING),s.dispatchEvent("readystatechange"),s.dispatchEvent(t),D&&s.upload.dispatchEvent(t)}),E.bind("Progress",function(t){i("readyState")!==f.LOADING&&(i("readyState",f.LOADING),s.dispatchEvent("readystatechange")),s.dispatchEvent(t)}),E.bind("UploadProgress",function(t){D&&s.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:t.total,loaded:t.loaded})}),E.bind("Load",function(e){i("readyState",f.DONE),i("status",Number(o.exec.call(E,"XMLHttpRequest","getStatus")||0)),i("statusText",h[i("status")]||""),i("response",o.exec.call(E,"XMLHttpRequest","getResponse",i("responseType"))),~t.inArray(i("responseType"),["text",""])?i("responseText",i("response")):"document"===i("responseType")&&i("responseXML",i("response")),M=o.exec.call(E,"XMLHttpRequest","getAllResponseHeaders"),s.dispatchEvent("readystatechange"),i("status")>0?(D&&s.upload.dispatchEvent(e),s.dispatchEvent(e)):(j=!0,s.dispatchEvent("error")),n()}),E.bind("Abort",function(t){s.dispatchEvent(t),n()}),E.bind("Error",function(t){j=!0,i("readyState",f.DONE),s.dispatchEvent("readystatechange"),A=!0,s.dispatchEvent(t),n()}),o.exec.call(E,"XMLHttpRequest","send",{url:v,method:b,async:S,user:x,password:_,headers:R,mimeType:C,encoding:$,responseType:s.responseType,withCredentials:s.withCredentials,options:L},e)}var s=this;y=(new Date).getTime(),E=new a,"string"==typeof L.required_caps&&(L.required_caps=r.parseCaps(L.required_caps)),L.required_caps=t.extend({},L.required_caps,{return_response_type:s.responseType}),e instanceof d&&(L.required_caps.send_multipart=!0),N||(L.required_caps.do_cors=!0),L.ruid?o(E.connectRuntime(L)):(E.bind("RuntimeInit",function(t,e){o(e)}),E.bind("RuntimeError",function(t,e){s.dispatchEvent("RuntimeError",e)}),E.connectRuntime(L))}function g(){i("responseText",""),i("responseXML",null),i("response",null),i("status",0),i("statusText",""),y=w=null}var v,b,x,_,y,w,E,k,T=this,q={timeout:0,readyState:f.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},S=!0,R={},$=null,C=null,I=!1,O=!1,D=!1,A=!1,j=!1,N=!1,B=null,U=null,L={},M="";t.extend(this,q,{uid:t.guid("uid_"),upload:new p,open:function(r,a,s,l,d){var c;if(!r||!a)throw new e.DOMException(e.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(r)||n.utf8_encode(r)!==r)throw new e.DOMException(e.DOMException.SYNTAX_ERR);if(~t.inArray(r.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(b=r.toUpperCase()),~t.inArray(b,["CONNECT","TRACE","TRACK"]))throw new e.DOMException(e.DOMException.SECURITY_ERR);if(a=n.utf8_encode(a),c=o.parseUrl(a),N=o.hasSameOrigin(c),v=o.resolveUrl(a),(l||d)&&!N)throw new e.DOMException(e.DOMException.INVALID_ACCESS_ERR);if(x=l||c.user,_=d||c.pass,S=s||!0,S===!1&&(i("timeout")||i("withCredentials")||""!==i("responseType")))throw new e.DOMException(e.DOMException.INVALID_ACCESS_ERR);I=!S,O=!1,R={},g.call(this),i("readyState",f.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(o,r){var a=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(i("readyState")!==f.OPENED||O)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(o)||n.utf8_encode(o)!==o)throw new e.DOMException(e.DOMException.SYNTAX_ERR);return o=t.trim(o).toLowerCase(),!~t.inArray(o,a)&&!/^(proxy\-|sec\-)/.test(o)&&(R[o]?R[o]+=", "+r:R[o]=r,!0)},getAllResponseHeaders:function(){return M||""},getResponseHeader:function(e){return e=e.toLowerCase(),j||~t.inArray(e,["set-cookie","set-cookie2"])?null:M&&""!==M&&(k||(k={},t.each(M.split(/\r\n/),function(e){var i=e.split(/:\s+/);2===i.length&&(i[0]=t.trim(i[0]),k[i[0].toLowerCase()]={header:i[0],value:t.trim(i[1])})})),k.hasOwnProperty(e))?k[e].header+": "+k[e].value:null},overrideMimeType:function(n){var o,r;if(~t.inArray(i("readyState"),[f.LOADING,f.DONE]))throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(n=t.trim(n.toLowerCase()),/;/.test(n)&&(o=n.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(n=o[1],o[2]&&(r=o[2])),!u.mimes[n])throw new e.DOMException(e.DOMException.SYNTAX_ERR);B=n,U=r},send:function(i,o){if(L="string"===t.typeOf(o)?{ruid:o}:o?o:{},this.convertEventPropsToHandlers(m),this.upload.convertEventPropsToHandlers(m),this.readyState!==f.OPENED||O)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);if(i instanceof s)L.ruid=i.ruid,C=i.type||"application/octet-stream";else if(i instanceof d){if(i.hasBlob()){var r=i.getBlob();L.ruid=r.ruid,C=r.type||"application/octet-stream"}}else"string"==typeof i&&($="UTF-8",C="text/plain;charset=UTF-8",i=n.utf8_encode(i));this.withCredentials||(this.withCredentials=L.required_caps&&L.required_caps.send_browser_cookies&&!N),D=!I&&this.upload.hasEventListener(),j=!1,A=!i,I||(O=!0),l.call(this,i)},abort:function(){if(j=!0,I=!1,~t.inArray(i("readyState"),[f.UNSENT,f.OPENED,f.DONE]))i("readyState",f.UNSENT);else{if(i("readyState",f.DONE),O=!1,!E)throw new e.DOMException(e.DOMException.INVALID_STATE_ERR);E.getRuntime().exec.call(E,"XMLHttpRequest","abort",A),A=!0}},destroy:function(){E&&("function"===t.typeOf(E.destroy)&&E.destroy(),E=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var h={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};p.prototype=i.instance;var m=["loadstart","progress","abort","error","load","timeout","loadend"];return f.UNSENT=0,f.OPENED=1,f.HEADERS_RECEIVED=2,f.LOADING=3,f.DONE=4,f.prototype=i.instance,f}),n(S,[s,h,g,f],function(t,e,i,n){function o(){function n(){c=u=0,d=this.result=null}function r(e,i){var n=this;l=i,n.bind("TransportingProgress",function(e){u=e.loaded,c>u&&-1===t.inArray(n.state,[o.IDLE,o.DONE])&&a.call(n)},999),n.bind("TransportingComplete",function(){u=c,n.state=o.DONE,d=null,n.result=l.exec.call(n,"Transporter","getAsBlob",e||"")},999),n.state=o.BUSY,n.trigger("TransportingStarted"),a.call(n)}function a(){var t,i=this,n=c-u;p>n&&(p=n),t=e.btoa(d.substr(u,p)),l.exec.call(i,"Transporter","receive",t,c)}var s,l,d,c,u,p;i.call(this),t.extend(this,{uid:t.guid("uid_"),state:o.IDLE,result:null,transport:function(e,i,o){var a=this;if(o=t.extend({chunk_size:204798},o),(s=o.chunk_size%3)&&(o.chunk_size+=3-s),p=o.chunk_size,n.call(this),d=e,c=e.length,"string"===t.typeOf(o)||o.ruid)r.call(a,i,this.connectRuntime(o));else{var l=function(t,e){a.unbind("RuntimeInit",l),r.call(a,i,e)};this.bind("RuntimeInit",l),this.connectRuntime(o)}},abort:function(){var t=this;t.state=o.IDLE,l&&(l.exec.call(t,"Transporter","clear"),t.trigger("TransportingAborted")),n.call(t)},destroy:function(){this.unbindAll(),l=null,this.disconnectRuntime(),n.call(this)}})}return o.IDLE=0,o.BUSY=1,o.DONE=2,o.prototype=n.instance,o}),n(R,[s,u,p,k,q,m,g,S,c,f,v,b,h],function(t,e,i,n,o,r,a,s,l,d,c,u,p){function f(){function n(t){t||(t=this.getRuntime().exec.call(this,"Image","getInfo")),this.size=t.size,this.width=t.width,this.height=t.height,this.type=t.type,this.meta=t.meta,""===this.name&&(this.name=t.name)}function d(e){var n=t.typeOf(e);try{if(e instanceof f){if(!e.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);m.apply(this,arguments)}else if(e instanceof c){if(!~t.inArray(e.type,["image/jpeg","image/png"]))throw new i.ImageError(i.ImageError.WRONG_FORMAT);g.apply(this,arguments)}else if(-1!==t.inArray(n,["blob","file"]))d.call(this,new u(null,e),arguments[1]);else if("string"===n)/^data:[^;]*;base64,/.test(e)?d.call(this,new c(null,{data:e}),arguments[1]):v.apply(this,arguments);else{if("node"!==n||"img"!==e.nodeName.toLowerCase())throw new i.DOMException(i.DOMException.TYPE_MISMATCH_ERR);d.call(this,e.src,arguments[1])}}catch(o){this.trigger("error",o)}}function m(e,i){var n=this.connectRuntime(e.ruid);this.ruid=n.uid,n.exec.call(this,"Image","loadFromImage",e,"undefined"===t.typeOf(i)||i)}function g(e,i){function n(t){o.ruid=t.uid,t.exec.call(o,"Image","loadFromBlob",e)}var o=this;o.name=e.name||"",e.isDetached()?(this.bind("RuntimeInit",function(t,e){n(e)}),i&&"string"==typeof i.required_caps&&(i.required_caps=r.parseCaps(i.required_caps)),this.connectRuntime(t.extend({required_caps:{access_image_binary:!0,resize_image:!0}},i))):n(this.connectRuntime(e.ruid))}function v(t,e){var i,n=this;i=new o,i.open("get",t),i.responseType="blob",i.onprogress=function(t){n.trigger(t)},i.onload=function(){g.call(n,i.response,!0)},i.onerror=function(t){n.trigger(t)},i.onloadend=function(){i.destroy()},i.bind("RuntimeError",function(t,e){n.trigger("RuntimeError",e)}),i.send(null,e)}a.call(this),t.extend(this,{uid:t.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){n.call(this)},999),this.convertEventPropsToHandlers(h),d.apply(this,arguments)},downsize:function(e,n,o,r){try{if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);if(this.width>f.MAX_RESIZE_WIDTH||this.height>f.MAX_RESIZE_HEIGHT)throw new i.ImageError(i.ImageError.MAX_RESOLUTION_ERR);(!e&&!n||"undefined"===t.typeOf(o))&&(o=!1),e=e||this.width,n=n||this.height,r="undefined"===t.typeOf(r)||!!r,this.getRuntime().exec.call(this,"Image","downsize",e,n,o,r)}catch(a){this.trigger("error",a)}},crop:function(t,e,i){this.downsize(t,e,!0,i)},getAsCanvas:function(){if(!l.can("create_canvas"))throw new i.RuntimeError(i.RuntimeError.NOT_SUPPORTED_ERR);var t=this.connectRuntime(this.ruid);return t.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(t,e){if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);return t||(t="image/jpeg"),"image/jpeg"!==t||e||(e=90),this.getRuntime().exec.call(this,"Image","getAsBlob",t,e)},getAsDataURL:function(t,e){if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",t,e)},getAsBinaryString:function(t,e){var i=this.getAsDataURL(t,e);return p.atob(i.substring(i.indexOf("base64,")+7))},embed:function(n){function o(){if(l.can("create_canvas")){var e=r.getAsCanvas();if(e)return n.appendChild(e),e=null,r.destroy(),void h.trigger("embedded")}var o=r.getAsDataURL(a,d);if(!o)throw new i.ImageError(i.ImageError.WRONG_FORMAT);if(l.can("use_data_uri_of",o.length))n.innerHTML='<img src="'+o+'" width="'+r.width+'" height="'+r.height+'" />',r.destroy(),h.trigger("embedded");else{var c=new s;c.bind("TransportingComplete",function(){u=h.connectRuntime(this.result.ruid),h.bind("Embedded",function(){t.extend(u.getShimContainer().style,{top:"0px",left:"0px",width:r.width+"px",height:r.height+"px"}),u=null},999),u.exec.call(h,"ImageView","display",this.result.uid,g,v),r.destroy()}),c.transport(p.atob(o.substring(o.indexOf("base64,")+7)),a,t.extend({},m,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:n}))}}var r,a,d,c,u,h=this,m=arguments[1]||{},g=this.width,v=this.height;try{if(!(n=e.get(n)))throw new i.DOMException(i.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);if(this.width>f.MAX_RESIZE_WIDTH||this.height>f.MAX_RESIZE_HEIGHT)throw new i.ImageError(i.ImageError.MAX_RESOLUTION_ERR);if(a=m.type||this.type||"image/jpeg",d=m.quality||90,c="undefined"!==t.typeOf(m.crop)&&m.crop,m.width)g=m.width,v=m.height||g;else{var b=e.getSize(n);b.w&&b.h&&(g=b.w,v=b.h)}return r=new f,r.bind("Resize",function(){o.call(h)}),r.bind("Load",function(){r.downsize(g,v,c,!1)}),r.clone(this,!1),r}catch(x){this.trigger("error",x)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var h=["progress","load","error","resize","embedded"];return f.MAX_RESIZE_WIDTH=6500,f.MAX_RESIZE_HEIGHT=6500,f.prototype=d.instance,f}),n($,[s,p,m,c],function(t,e,i,n){function o(e){var o=this,s=i.capTest,l=i.capTrue,d=t.extend({access_binary:s(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return o.can("access_binary")&&!!a.Image},display_media:s(n.can("create_canvas")||n.can("use_data_uri_over32kb")),do_cors:s(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:s(function(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&("IE"!==n.browser||n.version>9)}()),filter_by_extension:s(function(){return"Chrome"===n.browser&&n.version>=28||"IE"===n.browser&&n.version>=10}()),return_response_headers:l,return_response_type:function(t){return!("json"!==t||!window.JSON)||n.can("return_response_type",t)},return_status_code:l,report_upload_progress:s(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return o.can("access_binary")&&n.can("create_canvas")},select_file:function(){return n.can("use_fileinput")&&window.File},select_folder:function(){return o.can("select_file")&&"Chrome"===n.browser&&n.version>=21},select_multiple:function(){return!(!o.can("select_file")||"Safari"===n.browser&&"Windows"===n.os||"iOS"===n.os&&n.verComp(n.osVersion,"7.0.4","<"))},send_binary_string:s(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:s(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||o.can("send_binary_string")},slice_blob:s(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return o.can("slice_blob")&&o.can("send_multipart")},summon_file_dialog:s(function(){return"Firefox"===n.browser&&n.version>=4||"Opera"===n.browser&&n.version>=12||"IE"===n.browser&&n.version>=10||!!~t.inArray(n.browser,["Chrome","Safari"])}()),upload_filesize:l},arguments[2]);i.call(this,e,arguments[1]||r,d),t.extend(this,{init:function(){this.trigger("Init")},destroy:function(t){return function(){t.call(o),t=o=null}}(this.destroy)}),t.extend(this.getShim(),a)}var r="html5",a={};return i.addConstructor(r,o),a}),n(C,[$,v],function(t,e){function i(){function t(t,e,i){var n;if(!window.File.prototype.slice)return(n=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?n.call(t,e,i):null;try{return t.slice(),t.slice(e,i)}catch(o){return t.slice(e,i-e)}}this.slice=function(){return new e(this.getRuntime().uid,t.apply(this,arguments))}}return t.Blob=i}),n(I,[s],function(t){function e(){this.returnValue=!1}function i(){this.cancelBubble=!0}var n={},o="moxie_"+t.guid(),r=function(r,a,s,l){var d,c;a=a.toLowerCase(),r.addEventListener?(d=s,r.addEventListener(a,d,!1)):r.attachEvent&&(d=function(){var t=window.event;t.target||(t.target=t.srcElement),t.preventDefault=e,t.stopPropagation=i,s(t)},r.attachEvent("on"+a,d)),r[o]||(r[o]=t.guid()),n.hasOwnProperty(r[o])||(n[r[o]]={}),c=n[r[o]],c.hasOwnProperty(a)||(c[a]=[]),c[a].push({func:d,orig:s,key:l})},a=function(e,i,r){var a,s;if(i=i.toLowerCase(),e[o]&&n[e[o]]&&n[e[o]][i]){a=n[e[o]][i];for(var l=a.length-1;l>=0&&(a[l].orig!==r&&a[l].key!==r||(e.removeEventListener?e.removeEventListener(i,a[l].func,!1):e.detachEvent&&e.detachEvent("on"+i,a[l].func),a[l].orig=null,a[l].func=null,a.splice(l,1),r===s));l--);if(a.length||delete n[e[o]][i],t.isEmptyObj(n[e[o]])){delete n[e[o]];try{delete e[o]}catch(d){e[o]=s}}}},s=function(e,i){e&&e[o]&&t.each(n[e[o]],function(t,n){a(e,n,i)})};return{addEvent:r,removeEvent:a,removeAllEvents:s}}),n(O,[$,s,u,I,d,c],function(t,e,i,n,o,r){function a(){var t,a=[];e.extend(this,{init:function(s){var l,d,c,u,p,f,h=this,m=h.getRuntime();t=s,a=[],c=t.accept.mimes||o.extList2mimes(t.accept,m.can("filter_by_extension")),d=m.getShimContainer(),d.innerHTML='<input id="'+m.uid+'" type="file" style="font-size:999px;opacity:0;"'+(t.multiple&&m.can("select_multiple")?"multiple":"")+(t.directory&&m.can("select_folder")?"webkitdirectory directory":"")+(c?' accept="'+c.join(",")+'"':"")+" />",l=i.get(m.uid),e.extend(l.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),u=i.get(t.browse_button),m.can("summon_file_dialog")&&("static"===i.getStyle(u,"position")&&(u.style.position="relative"),p=parseInt(i.getStyle(u,"z-index"),10)||1,u.style.zIndex=p,d.style.zIndex=p-1,n.addEvent(u,"click",function(t){var e=i.get(m.uid);e&&!e.disabled&&e.click(),t.preventDefault()},h.uid)),f=m.can("summon_file_dialog")?u:d,n.addEvent(f,"mouseover",function(){h.trigger("mouseenter")},h.uid),n.addEvent(f,"mouseout",function(){h.trigger("mouseleave")},h.uid),n.addEvent(f,"mousedown",function(){h.trigger("mousedown")},h.uid),n.addEvent(i.get(t.container),"mouseup",function(){h.trigger("mouseup")},h.uid),l.onchange=function g(){if(a=[],t.directory?e.each(this.files,function(t){"."!==t.name&&a.push(t)}):a=[].slice.call(this.files),"IE"!==r.browser)this.value="";else{var i=this.cloneNode(!0);this.parentNode.replaceChild(i,this),
i.onchange=g}h.trigger("change")},h.trigger({type:"ready",async:!0}),d=null},getFiles:function(){return a},disable:function(t){var e,n=this.getRuntime();(e=i.get(n.uid))&&(e.disabled=!!t)},destroy:function(){var e=this.getRuntime(),o=e.getShim(),r=e.getShimContainer();n.removeAllEvents(r,this.uid),n.removeAllEvents(t&&i.get(t.container),this.uid),n.removeAllEvents(t&&i.get(t.browse_button),this.uid),r&&(r.innerHTML=""),o.removeInstance(this.uid),a=t=r=o=null}})}return t.FileInput=a}),n(D,[$,s,u,I,d],function(t,e,i,n,o){function r(){function t(t){for(var i=[],n=0;n<t.length;n++)[].push.apply(i,t[n].extensions.split(/\s*,\s*/));return-1===e.inArray("*",i)?i:[]}function r(t){var i=o.getFileExtension(t.name);return!i||!p.length||-1!==e.inArray(i,p)}function a(t,i){var n=[];e.each(t,function(t){var e=t.webkitGetAsEntry();if(e)if(e.isFile){var i=t.getAsFile();r(i)&&u.push(i)}else n.push(e)}),n.length?s(n,i):i()}function s(t,i){var n=[];e.each(t,function(t){n.push(function(e){l(t,e)})}),e.inSeries(n,function(){i()})}function l(t,e){t.isFile?t.file(function(t){r(t)&&u.push(t),e()},function(){e()}):t.isDirectory?d(t,e):e()}function d(t,e){function i(t){o.readEntries(function(e){e.length?([].push.apply(n,e),i(t)):t()},t)}var n=[],o=t.createReader();i(function(){s(n,e)})}var c,u=[],p=[];e.extend(this,{init:function(i){var o,s=this;c=i,p=t(c.accept),o=c.container,n.addEvent(o,"dragover",function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="copy"},s.uid),n.addEvent(o,"drop",function(t){t.preventDefault(),t.stopPropagation(),u=[],t.dataTransfer.items&&t.dataTransfer.items[0].webkitGetAsEntry?a(t.dataTransfer.items,function(){s.trigger("drop")}):(e.each(t.dataTransfer.files,function(t){r(t)&&u.push(t)}),s.trigger("drop"))},s.uid),n.addEvent(o,"dragenter",function(t){t.preventDefault(),t.stopPropagation(),s.trigger("dragenter")},s.uid),n.addEvent(o,"dragleave",function(t){t.preventDefault(),t.stopPropagation(),s.trigger("dragleave")},s.uid)},getFiles:function(){return u},destroy:function(){n.removeAllEvents(c&&i.get(c.container),this.uid),u=p=c=null}})}return t.FileDrop=r}),n(A,[$,h,s],function(t,e,i){function n(){function t(t){return e.atob(t.substring(t.indexOf("base64,")+7))}var n,o=!1;i.extend(this,{read:function(t,e){var r=this;n=new window.FileReader,n.addEventListener("progress",function(t){r.trigger(t)}),n.addEventListener("load",function(t){r.trigger(t)}),n.addEventListener("error",function(t){r.trigger(t,n.error)}),n.addEventListener("loadend",function(){n=null}),"function"===i.typeOf(n[t])?(o=!1,n[t](e.getSource())):"readAsBinaryString"===t&&(o=!0,n.readAsDataURL(e.getSource()))},getResult:function(){return n&&n.result?o?t(n.result):n.result:null},abort:function(){n&&n.abort()},destroy:function(){n=null}})}return t.FileReader=n}),n(j,[$,s,d,E,b,v,T,p,c],function(t,e,i,n,o,r,a,s,l){function d(){function t(t,e){var i,n,o=this;i=e.getBlob().getSource(),n=new window.FileReader,n.onload=function(){e.append(e.getBlobName(),new r(null,{type:i.type,data:n.result})),h.send.call(o,t,e)},n.readAsBinaryString(i)}function d(){return!window.XMLHttpRequest||"IE"===l.browser&&l.version<8?function(){for(var t=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(i){}}():new window.XMLHttpRequest}function c(t){var e=t.responseXML,i=t.responseText;return"IE"===l.browser&&i&&e&&!e.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(t.getResponseHeader("Content-Type"))&&(e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.validateOnParse=!1,e.loadXML(i)),e&&("IE"===l.browser&&0!==e.parseError||!e.documentElement||"parsererror"===e.documentElement.tagName)?null:e}function u(t){var e="----moxieboundary"+(new Date).getTime(),i="--",n="\r\n",o="",a=this.getRuntime();if(!a.can("send_binary_string"))throw new s.RuntimeError(s.RuntimeError.NOT_SUPPORTED_ERR);return p.setRequestHeader("Content-Type","multipart/form-data; boundary="+e),t.each(function(t,a){o+=t instanceof r?i+e+n+'Content-Disposition: form-data; name="'+a+'"; filename="'+unescape(encodeURIComponent(t.name||"blob"))+'"'+n+"Content-Type: "+(t.type||"application/octet-stream")+n+n+t.getSource()+n:i+e+n+'Content-Disposition: form-data; name="'+a+'"'+n+n+unescape(encodeURIComponent(t))+n}),o+=i+e+i+n}var p,f,h=this;e.extend(this,{send:function(i,o){var s=this,c="Mozilla"===l.browser&&l.version>=4&&l.version<7,h="Android Browser"===l.browser,m=!1;if(f=i.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),p=d(),p.open(i.method,i.url,i.async,i.user,i.password),o instanceof r)o.isDetached()&&(m=!0),o=o.getSource();else if(o instanceof a){if(o.hasBlob())if(o.getBlob().isDetached())o=u.call(s,o),m=!0;else if((c||h)&&"blob"===e.typeOf(o.getBlob().getSource())&&window.FileReader)return void t.call(s,i,o);if(o instanceof a){var g=new window.FormData;o.each(function(t,e){t instanceof r?g.append(e,t.getSource()):g.append(e,t)}),o=g}}p.upload?(i.withCredentials&&(p.withCredentials=!0),p.addEventListener("load",function(t){s.trigger(t)}),p.addEventListener("error",function(t){s.trigger(t)}),p.addEventListener("progress",function(t){s.trigger(t)}),p.upload.addEventListener("progress",function(t){s.trigger({type:"UploadProgress",loaded:t.loaded,total:t.total})})):p.onreadystatechange=function(){switch(p.readyState){case 1:break;case 2:break;case 3:var t,e;try{n.hasSameOrigin(i.url)&&(t=p.getResponseHeader("Content-Length")||0),p.responseText&&(e=p.responseText.length)}catch(o){t=e=0}s.trigger({type:"progress",lengthComputable:!!t,total:parseInt(t,10),loaded:e});break;case 4:p.onreadystatechange=function(){},0===p.status?s.trigger("error"):s.trigger("load")}},e.isEmptyObj(i.headers)||e.each(i.headers,function(t,e){p.setRequestHeader(e,t)}),""!==i.responseType&&"responseType"in p&&(p.responseType="json"!==i.responseType||l.can("return_response_type","json")?i.responseType:"text"),m?p.sendAsBinary?p.sendAsBinary(o):function(){for(var t=new Uint8Array(o.length),e=0;e<o.length;e++)t[e]=255&o.charCodeAt(e);p.send(t.buffer)}():p.send(o),s.trigger("loadstart")},getStatus:function(){try{if(p)return p.status}catch(t){}return 0},getResponse:function(t){var e=this.getRuntime();try{switch(t){case"blob":var n=new o(e.uid,p.response),r=p.getResponseHeader("Content-Disposition");if(r){var a=r.match(/filename=([\'\"'])([^\1]+)\1/);a&&(f=a[2])}return n.name=f,n.type||(n.type=i.getFileMime(f)),n;case"json":return l.can("return_response_type","json")?p.response:200===p.status&&window.JSON?JSON.parse(p.responseText):null;case"document":return c(p);default:return""!==p.responseText?p.responseText:null}}catch(s){return null}},getAllResponseHeaders:function(){try{return p.getAllResponseHeaders()}catch(t){}return""},abort:function(){p&&p.abort()},destroy:function(){h=f=null}})}return t.XMLHttpRequest=d}),n(N,[],function(){return function(){function t(t,e){var i,n=r?0:-8*(e-1),a=0;for(i=0;e>i;i++)a|=o.charCodeAt(t+i)<<Math.abs(n+8*i);return a}function i(t,e,i){i=3===arguments.length?i:o.length-e-1,o=o.substr(0,e)+t+o.substr(i+e)}function n(t,e,n){var o,a="",s=r?0:-8*(n-1);for(o=0;n>o;o++)a+=String.fromCharCode(255&e>>Math.abs(s+8*o));i(a,t,n)}var o,r=!1;return{II:function(t){return t===e?r:void(r=t)},init:function(t){r=!1,o=t},SEGMENT:function(t,e,n){switch(arguments.length){case 1:return o.substr(t,o.length-t-1);case 2:return o.substr(t,e);case 3:i(n,t,e);break;default:return o}},BYTE:function(e){return t(e,1)},SHORT:function(e){return t(e,2)},LONG:function(i,o){return o===e?t(i,4):void n(i,o,4)},SLONG:function(e){var i=t(e,4);return i>2147483647?i-4294967296:i},STRING:function(e,i){var n="";for(i+=e;i>e;e++)n+=String.fromCharCode(t(e,1));return n}}}}),n(B,[N],function(t){return function e(i){var n,o,r,a=[],s=0;if(n=new t,n.init(i),65496===n.SHORT(0)){for(o=2;o<=i.length;)if(r=n.SHORT(o),r>=65488&&65495>=r)o+=2;else{if(65498===r||65497===r)break;s=n.SHORT(o+2)+2,r>=65505&&65519>=r&&a.push({hex:r,name:"APP"+(15&r),start:o,length:s,segment:n.SEGMENT(o,s)}),o+=s}return n.init(null),{headers:a,restore:function(t){var e,i;for(n.init(t),o=65504==n.SHORT(2)?4+n.SHORT(4):2,i=0,e=a.length;e>i;i++)n.SEGMENT(o,0,a[i].segment),o+=a[i].length;return t=n.SEGMENT(),n.init(null),t},strip:function(t){var i,o,r;for(o=new e(t),i=o.headers,o.purge(),n.init(t),r=i.length;r--;)n.SEGMENT(i[r].start,i[r].length,"");return t=n.SEGMENT(),n.init(null),t},get:function(t){for(var e=[],i=0,n=a.length;n>i;i++)a[i].name===t.toUpperCase()&&e.push(a[i].segment);return e},set:function(t,e){var i,n,o,r=[];for("string"==typeof e?r.push(e):r=e,i=n=0,o=a.length;o>i&&(a[i].name===t.toUpperCase()&&(a[i].segment=r[n],a[i].length=r[n].length,n++),!(n>=r.length));i++);},purge:function(){a=[],n.init(null),n=null}}}}}),n(U,[s,N],function(t,i){return function n(){function n(t,i){var n,o,r,s,l,u,p,f,h=a.SHORT(t),m=[],g={};for(n=0;h>n;n++)if(p=u=t+12*n+2,r=i[a.SHORT(p)],r!==e){switch(s=a.SHORT(p+=2),l=a.LONG(p+=2),p+=4,m=[],s){case 1:case 7:for(l>4&&(p=a.LONG(p)+c.tiffHeader),o=0;l>o;o++)m[o]=a.BYTE(p+o);break;case 2:l>4&&(p=a.LONG(p)+c.tiffHeader),g[r]=a.STRING(p,l-1);continue;case 3:for(l>2&&(p=a.LONG(p)+c.tiffHeader),o=0;l>o;o++)m[o]=a.SHORT(p+2*o);break;case 4:for(l>1&&(p=a.LONG(p)+c.tiffHeader),o=0;l>o;o++)m[o]=a.LONG(p+4*o);break;case 5:for(p=a.LONG(p)+c.tiffHeader,o=0;l>o;o++)m[o]=a.LONG(p+4*o)/a.LONG(p+4*o+4);break;case 9:for(p=a.LONG(p)+c.tiffHeader,o=0;l>o;o++)m[o]=a.SLONG(p+4*o);break;case 10:for(p=a.LONG(p)+c.tiffHeader,o=0;l>o;o++)m[o]=a.SLONG(p+4*o)/a.SLONG(p+4*o+4);break;default:continue}f=1==l?m[0]:m,g[r]=d.hasOwnProperty(r)&&"object"!=typeof f?d[r][f]:f}return g}function o(){var t=c.tiffHeader;return a.II(18761==a.SHORT(t)),42===a.SHORT(t+=2)&&(c.IFD0=c.tiffHeader+a.LONG(t+=2),l=n(c.IFD0,s.tiff),"ExifIFDPointer"in l&&(c.exifIFD=c.tiffHeader+l.ExifIFDPointer,delete l.ExifIFDPointer),"GPSInfoIFDPointer"in l&&(c.gpsIFD=c.tiffHeader+l.GPSInfoIFDPointer,delete l.GPSInfoIFDPointer),!0)}function r(t,e,i){var n,o,r,l=0;if("string"==typeof e){var d=s[t.toLowerCase()];for(var u in d)if(d[u]===e){e=u;break}}n=c[t.toLowerCase()+"IFD"],o=a.SHORT(n);for(var p=0;o>p;p++)if(r=n+12*p+2,a.SHORT(r)==e){l=r+8;break}return!!l&&(a.LONG(l,i),!0)}var a,s,l,d,c={};return a=new i,s={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},d={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(t){return c={tiffHeader:10},!(t===e||!t.length)&&(a.init(t),65505===a.SHORT(0)&&"EXIF\0"===a.STRING(4,5).toUpperCase()&&o())},TIFF:function(){return l},EXIF:function(){var e;if(e=n(c.exifIFD,s.exif),e.ExifVersion&&"array"===t.typeOf(e.ExifVersion)){for(var i=0,o="";i<e.ExifVersion.length;i++)o+=String.fromCharCode(e.ExifVersion[i]);e.ExifVersion=o}return e},GPS:function(){var e;return e=n(c.gpsIFD,s.gps),e.GPSVersionID&&"array"===t.typeOf(e.GPSVersionID)&&(e.GPSVersionID=e.GPSVersionID.join(".")),e},setExif:function(t,e){return("PixelXDimension"===t||"PixelYDimension"===t)&&r("exif",t,e)},getBinary:function(){return a.SEGMENT()},purge:function(){a.init(null),a=l=null,c={}}}}}),n(L,[s,p,B,N,U],function(t,e,i,n,o){function r(r){function a(){for(var t,e,i=0;i<=l.length;){if(t=d.SHORT(i+=2),t>=65472&&65475>=t)return i+=5,{height:d.SHORT(i),width:d.SHORT(i+=2)};e=d.SHORT(i+=2),i+=e-2}return null}function s(){u&&c&&d&&(u.purge(),c.purge(),d.init(null),l=p=c=u=d=null)}var l,d,c,u,p,f;if(l=r,d=new n,d.init(l),65496!==d.SHORT(0))throw new e.ImageError(e.ImageError.WRONG_FORMAT);c=new i(r),u=new o,f=!!u.init(c.get("app1")[0]),p=a.call(this),t.extend(this,{type:"image/jpeg",size:l.length,width:p&&p.width||0,height:p&&p.height||0,setExif:function(e,i){return!!f&&("object"===t.typeOf(e)?t.each(e,function(t,e){u.setExif(e,t)}):u.setExif(e,i),void c.set("app1",u.getBinary()))},writeHeaders:function(){return arguments.length?c.restore(arguments[0]):l=c.restore(l)},stripHeaders:function(t){return c.strip(t)},purge:function(){s.call(this)}}),f&&(this.meta={tiff:u.TIFF(),exif:u.EXIF(),gps:u.GPS()})}return r}),n(M,[p,s,N],function(t,e,i){function n(n){function o(){var t,e;return t=a.call(this,8),"IHDR"==t.type?(e=t.start,{width:l.LONG(e),height:l.LONG(e+=4)}):null}function r(){l&&(l.init(null),s=u=d=c=l=null)}function a(t){var e,i,n,o;return e=l.LONG(t),i=l.STRING(t+=4,4),n=t+=4,o=l.LONG(t+e),{length:e,type:i,start:n,CRC:o}}var s,l,d,c,u;s=n,l=new i,l.init(s),function(){var e=0,i=0,n=[35152,20039,3338,6666];for(i=0;i<n.length;i++,e+=2)if(n[i]!=l.SHORT(e))throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),u=o.call(this),e.extend(this,{type:"image/png",size:s.length,width:u.width,height:u.height,purge:function(){r.call(this)}}),r.call(this)}return n}),n(z,[s,p,L,M],function(t,e,i,n){return function(o){var r,a=[i,n];r=function(){for(var t=0;t<a.length;t++)try{return new a[t](o)}catch(i){}throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),t.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(t){return t},stripHeaders:function(t){return t},purge:function(){}}),t.extend(this,r),this.purge=function(){r.purge(),r=null}}}),n(F,[],function(){function t(t,n,o){var r=t.naturalWidth,a=t.naturalHeight,s=o.width,l=o.height,d=o.x||0,c=o.y||0,u=n.getContext("2d");e(t)&&(r/=2,a/=2);var p=1024,f=document.createElement("canvas");f.width=f.height=p;for(var h=f.getContext("2d"),m=i(t,r,a),g=0;a>g;){for(var v=g+p>a?a-g:p,b=0;r>b;){var x=b+p>r?r-b:p;h.clearRect(0,0,p,p),h.drawImage(t,-b,-g);var _=b*s/r+d<<0,y=Math.ceil(x*s/r),w=g*l/a/m+c<<0,E=Math.ceil(v*l/a/m);u.drawImage(f,0,0,x,v,_,w,y,E),b+=p}g+=p}f=h=null}function e(t){var e=t.naturalWidth,i=t.naturalHeight;if(e*i>1048576){var n=document.createElement("canvas");n.width=n.height=1;var o=n.getContext("2d");return o.drawImage(t,-e+1,0),0===o.getImageData(0,0,1,1).data[3]}return!1}function i(t,e,i){var n=document.createElement("canvas");n.width=1,n.height=i;var o=n.getContext("2d");o.drawImage(t,0,0);for(var r=o.getImageData(0,0,1,i).data,a=0,s=i,l=i;l>a;){var d=r[4*(l-1)+3];0===d?s=l:a=l,l=s+a>>1}n=null;var c=l/i;return 0===c?1:c}return{isSubsampled:e,renderTo:t}}),n(P,[$,s,p,h,b,z,F,d,c],function(t,e,i,n,o,r,a,s,l){function d(){function t(){if(!x&&!v)throw new i.ImageError(i.DOMException.INVALID_STATE_ERR);return x||v}function d(t){return n.atob(t.substring(t.indexOf("base64,")+7))}function c(t,e){return"data:"+(e||"")+";base64,"+n.btoa(t)}function u(t){var e=this;v=new Image,v.onerror=function(){g.call(this),e.trigger("error",new i.ImageError(i.ImageError.WRONG_FORMAT))},v.onload=function(){e.trigger("load")},v.src=/^data:[^;]*;base64,/.test(t)?t:c(t,y.type)}function p(t,e){var n,o=this;return window.FileReader?(n=new FileReader,n.onload=function(){e(this.result)},n.onerror=function(){o.trigger("error",new i.FileException(i.FileException.NOT_READABLE_ERR))},void n.readAsDataURL(t)):e(t.getAsDataURL())}function f(i,n,o,r){var a,s,l,d,c,u,p=this,f=0,g=0;if(k=r,u=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==e.inArray(u,[5,6,7,8])){var v=i;i=n,n=v}return l=t(),s=o?Math.max:Math.min,a=s(i/l.width,n/l.height),a>1&&(!o||r)?void this.trigger("Resize"):(x||(x=document.createElement("canvas")),d=Math.round(l.width*a),c=Math.round(l.height*a),o?(x.width=i,x.height=n,d>i&&(f=Math.round((d-i)/2)),c>n&&(g=Math.round((c-n)/2))):(x.width=d,x.height=c),k||m(x.width,x.height,u),h.call(this,l,x,-f,-g,d,c),this.width=x.width,this.height=x.height,E=!0,void p.trigger("Resize"))}function h(t,e,i,n,o,r){if("iOS"===l.OS)a.renderTo(t,e,{width:o,height:r,x:i,y:n});else{var s=e.getContext("2d");s.drawImage(t,i,n,o,r)}}function m(t,e,i){switch(i){case 5:case 6:case 7:case 8:x.width=e,x.height=t;break;default:x.width=t,x.height=e}var n=x.getContext("2d");switch(i){case 2:n.translate(t,0),n.scale(-1,1);break;case 3:n.translate(t,e),n.rotate(Math.PI);break;case 4:n.translate(0,e),n.scale(1,-1);break;case 5:n.rotate(.5*Math.PI),n.scale(1,-1);break;case 6:n.rotate(.5*Math.PI),n.translate(0,-e);break;case 7:n.rotate(.5*Math.PI),n.translate(t,-e),n.scale(-1,1);break;case 8:n.rotate(-.5*Math.PI),n.translate(-t,0)}}function g(){b&&(b.purge(),b=null),_=v=x=y=null,E=!1}var v,b,x,_,y,w=this,E=!1,k=!0;e.extend(this,{loadFromBlob:function(t){var e=this,n=e.getRuntime(),o=!(arguments.length>1)||arguments[1];if(!n.can("access_binary"))throw new i.RuntimeError(i.RuntimeError.NOT_SUPPORTED_ERR);return y=t,t.isDetached()?(_=t.getSource(),void u.call(this,_)):void p.call(this,t.getSource(),function(t){o&&(_=d(t)),u.call(e,t)})},loadFromImage:function(t,e){this.meta=t.meta,y=new o(null,{name:t.name,size:t.size,type:t.type}),u.call(this,e?_=t.getAsBinaryString():t.getAsDataURL())},getInfo:function(){var e,i=this.getRuntime();return!b&&_&&i.can("access_image_binary")&&(b=new r(_)),e={width:t().width||0,height:t().height||0,type:y.type||s.getFileMime(y.name),size:_&&_.length||y.size||0,name:y.name||"",meta:b&&b.meta||this.meta||{}}},downsize:function(){f.apply(this,arguments)},getAsCanvas:function(){return x&&(x.id=this.uid+"_canvas"),x},getAsBlob:function(t,e){return t!==this.type&&f.call(this,this.width,this.height,!1),new o(null,{name:y.name||"",type:t,data:w.getAsBinaryString.call(this,t,e)})},getAsDataURL:function(t){var e=arguments[1]||90;if(!E)return v.src;if("image/jpeg"!==t)return x.toDataURL("image/png");try{return x.toDataURL("image/jpeg",e/100)}catch(i){return x.toDataURL("image/jpeg")}},getAsBinaryString:function(t,e){if(!E)return _||(_=d(w.getAsDataURL(t,e))),_;if("image/jpeg"!==t)_=d(w.getAsDataURL(t,e));else{var i;e||(e=90);try{i=x.toDataURL("image/jpeg",e/100)}catch(n){i=x.toDataURL("image/jpeg")}_=d(i),b&&(_=b.stripHeaders(_),k&&(b.meta&&b.meta.exif&&b.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),_=b.writeHeaders(_)),b.purge(),b=null)}return E=!1,_},destroy:function(){w=null,g.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return t.Image=d}),n(H,[s,c,u,p,m],function(t,e,i,n,o){function r(){var t;try{t=navigator.plugins["Shockwave Flash"],t=t.description}catch(e){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){t="0.0"}}return t=t.match(/\d+/g),parseFloat(t[0]+"."+t[1])}function a(a){var d,c=this;a=t.extend({swf_url:e.swf_url},a),o.call(this,a,s,{access_binary:function(t){return t&&"browser"===c.mode},access_image_binary:function(t){return t&&"browser"===c.mode},display_media:o.capTrue,do_cors:o.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===c.mode},resize_image:o.capTrue,return_response_headers:!1,return_response_type:function(e){return!("json"!==e||!window.JSON)||(!t.arrayDiff(e,["","text","document"])||"browser"===c.mode)},return_status_code:function(e){return"browser"===c.mode||!t.arrayDiff(e,[200,404])},select_file:o.capTrue,select_multiple:o.capTrue,send_binary_string:function(t){return t&&"browser"===c.mode},send_browser_cookies:function(t){return t&&"browser"===c.mode},send_custom_headers:function(t){return t&&"browser"===c.mode},send_multipart:o.capTrue,slice_blob:o.capTrue,stream_upload:function(t){return t&&"browser"===c.mode},summon_file_dialog:!1,upload_filesize:function(e){return t.parseSizeStr(e)<=2097152||"client"===c.mode},use_http_method:function(e){return!t.arrayDiff(e,["GET","POST"])}},{access_binary:function(t){return t?"browser":"client"},access_image_binary:function(t){return t?"browser":"client"},report_upload_progress:function(t){return t?"browser":"client"},return_response_type:function(e){return t.arrayDiff(e,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(e){return t.arrayDiff(e,[200,404])?"browser":["client","browser"]},send_binary_string:function(t){return t?"browser":"client"},send_browser_cookies:function(t){return t?"browser":"client"},send_custom_headers:function(t){return t?"browser":"client"},stream_upload:function(t){return t?"client":"browser"},upload_filesize:function(e){return t.parseSizeStr(e)>=2097152?"client":"browser"}},"client"),r()<10&&(this.mode=!1),t.extend(this,{getShim:function(){return i.get(this.uid)},shimExec:function(t,e){var i=[].slice.call(arguments,2);return c.getShim().exec(this.uid,t,e,i)},init:function(){var i,o,r;r=this.getShimContainer(),t.extend(r.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),i='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+a.swf_url+'" ',"IE"===e.browser&&(i+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),i+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+e.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===e.browser?(o=document.createElement("div"),r.appendChild(o),o.outerHTML=i,o=r=null):r.innerHTML=i,d=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new n.RuntimeError(n.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(t){return function(){t.call(c),clearTimeout(d),a=d=t=c=null}}(this.destroy)},l)}var s="flash",l={};return o.addConstructor(s,a),l}),n(G,[H,v],function(t,e){var i={slice:function(t,i,n,o){var r=this.getRuntime();return 0>i?i=Math.max(t.size+i,0):i>0&&(i=Math.min(i,t.size)),0>n?n=Math.max(t.size+n,0):n>0&&(n=Math.min(n,t.size)),t=r.shimExec.call(this,"Blob","slice",i,n,o||""),t&&(t=new e(r.uid,t)),t}};return t.Blob=i}),n(X,[H],function(t){var e={init:function(t){this.getRuntime().shimExec.call(this,"FileInput","init",{name:t.name,accept:t.accept,multiple:t.multiple}),this.trigger("ready")}};return t.FileInput=e}),n(V,[H,h],function(t,e){function i(t,i){switch(i){case"readAsText":return e.atob(t,"utf8");case"readAsBinaryString":return e.atob(t);case"readAsDataURL":return t}return null}var n="",o={read:function(t,e){var o=this,r=o.getRuntime();return"readAsDataURL"===t&&(n="data:"+(e.type||"")+";base64,"),o.bind("Progress",function(e,o){o&&(n+=i(o,t))}),r.shimExec.call(this,"FileReader","readAsBase64",e.uid)},getResult:function(){return n},destroy:function(){n=null}};return t.FileReader=o}),n(W,[H,h],function(t,e){function i(t,i){switch(i){case"readAsText":return e.atob(t,"utf8");case"readAsBinaryString":return e.atob(t);case"readAsDataURL":return t}return null}var n={read:function(t,e){var n,o=this.getRuntime();return(n=o.shimExec.call(this,"FileReaderSync","readAsBase64",e.uid))?("readAsDataURL"===t&&(n="data:"+(e.type||"")+";base64,"+n),i(n,t,e.type)):null}};return t.FileReaderSync=n}),n(J,[H,s,v,b,k,T,S],function(t,e,i,n,o,r,a){var s={send:function(t,n){function o(){t.transport=c.mode,c.shimExec.call(d,"XMLHttpRequest","send",t,n)}function s(t,e){c.shimExec.call(d,"XMLHttpRequest","appendBlob",t,e.uid),n=null,o()}function l(t,e){var i=new a;i.bind("TransportingComplete",function(){e(this.result)}),i.transport(t.getSource(),t.type,{ruid:c.uid})}var d=this,c=d.getRuntime();if(e.isEmptyObj(t.headers)||e.each(t.headers,function(t,e){c.shimExec.call(d,"XMLHttpRequest","setRequestHeader",e,t.toString())}),n instanceof r){var u;if(n.each(function(t,e){t instanceof i?u=e:c.shimExec.call(d,"XMLHttpRequest","append",e,t)}),n.hasBlob()){var p=n.getBlob();p.isDetached()?l(p,function(t){p.destroy(),s(u,t)}):s(u,p)}else n=null,o()}else n instanceof i?n.isDetached()?l(n,function(t){n.destroy(),n=t.uid,o()}):(n=n.uid,o()):o()},getResponse:function(t){var i,r,a=this.getRuntime();if(r=a.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(r=new n(a.uid,r),"blob"===t)return r;try{if(i=new o,~e.inArray(t,["","text"]))return i.readAsText(r);if("json"===t&&window.JSON)return JSON.parse(i.readAsText(r))}finally{r.destroy()}}return null},abort:function(t){var e=this.getRuntime();e.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return t.XMLHttpRequest=s}),n(K,[H,v],function(t,e){var i={getAsBlob:function(t){var i=this.getRuntime(),n=i.shimExec.call(this,"Transporter","getAsBlob",t);return n?new e(i.uid,n):null}};return t.Transporter=i}),n(Y,[H,s,S,v,k],function(t,e,i,n,o){var r={loadFromBlob:function(t){function e(t){o.shimExec.call(n,"Image","loadFromBlob",t.uid),n=o=null}var n=this,o=n.getRuntime();if(t.isDetached()){var r=new i;r.bind("TransportingComplete",function(){e(r.result.getSource())}),r.transport(t.getSource(),t.type,{ruid:o.uid})}else e(t.getSource())},loadFromImage:function(t){var e=this.getRuntime();return e.shimExec.call(this,"Image","loadFromImage",t.uid)},getAsBlob:function(t,e){var i=this.getRuntime(),o=i.shimExec.call(this,"Image","getAsBlob",t,e);return o?new n(i.uid,o):null},getAsDataURL:function(){var t,e=this.getRuntime(),i=e.Image.getAsBlob.apply(this,arguments);return i?(t=new o,t.readAsDataURL(i)):null}};return t.Image=r}),n(Q,[s,c,u,p,m],function(t,e,i,n,o){function r(t){var e,i,n,o,r,a=!1,s=null,l=0;try{try{s=new ActiveXObject("AgControl.AgControl"),s.IsVersionSupported(t)&&(a=!0),s=null}catch(d){var c=navigator.plugins["Silverlight Plug-In"];if(c){for(e=c.description,"1.0.30226.2"===e&&(e="2.0.30226.2"),i=e.split(".");i.length>3;)i.pop();for(;i.length<4;)i.push(0);for(n=t.split(".");n.length>4;)n.pop();do o=parseInt(n[l],10),r=parseInt(i[l],10),l++;while(l<n.length&&o===r);r>=o&&!isNaN(o)&&(a=!0)}}}catch(u){a=!1}return a}function a(a){var d,c=this;a=t.extend({xap_url:e.xap_url},a),o.call(this,a,s,{access_binary:o.capTrue,access_image_binary:o.capTrue,display_media:o.capTrue,do_cors:o.capTrue,drag_and_drop:!1,report_upload_progress:o.capTrue,resize_image:o.capTrue,return_response_headers:function(t){return t&&"client"===c.mode},return_response_type:function(t){return"json"!==t||!!window.JSON},return_status_code:function(e){return"client"===c.mode||!t.arrayDiff(e,[200,404])},select_file:o.capTrue,select_multiple:o.capTrue,send_binary_string:o.capTrue,send_browser_cookies:function(t){return t&&"browser"===c.mode},send_custom_headers:function(t){return t&&"client"===c.mode},send_multipart:o.capTrue,slice_blob:o.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:o.capTrue,use_http_method:function(e){return"client"===c.mode||!t.arrayDiff(e,["GET","POST"])}},{return_response_headers:function(t){return t?"client":"browser"},return_status_code:function(e){return t.arrayDiff(e,[200,404])?"client":["client","browser"]},send_browser_cookies:function(t){return t?"browser":"client"},send_custom_headers:function(t){return t?"client":"browser"},use_http_method:function(e){return t.arrayDiff(e,["GET","POST"])?"client":["client","browser"]}}),r("2.0.31005.0")&&"Opera"!==e.browser||(this.mode=!1),t.extend(this,{getShim:function(){return i.get(this.uid).content.Moxie},shimExec:function(t,e){var i=[].slice.call(arguments,2);return c.getShim().exec(this.uid,t,e,i)},init:function(){var t;t=this.getShimContainer(),t.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+a.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+e.global_event_dispatcher+'"/></object>',d=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new n.RuntimeError(n.RuntimeError.NOT_INIT_ERR))},"Windows"!==e.OS?1e4:5e3)},destroy:function(t){return function(){t.call(c),clearTimeout(d),a=d=t=c=null}}(this.destroy)},l)}var s="silverlight",l={};return o.addConstructor(s,a),l}),n(Z,[Q,s,G],function(t,e,i){return t.Blob=e.extend({},i)}),n(tt,[Q],function(t){var e={init:function(t){function e(t){for(var e="",i=0;i<t.length;i++)e+=(""!==e?"|":"")+t[i].title+" | *."+t[i].extensions.replace(/,/g,";*.");return e}this.getRuntime().shimExec.call(this,"FileInput","init",e(t.accept),t.name,t.multiple),this.trigger("ready")}};return t.FileInput=e}),n(et,[Q,u,I],function(t,e,i){var n={init:function(){var t,n=this,o=n.getRuntime();return t=o.getShimContainer(),i.addEvent(t,"dragover",function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="copy"},n.uid),i.addEvent(t,"dragenter",function(t){t.preventDefault();var i=e.get(o.uid).dragEnter(t);i&&t.stopPropagation()},n.uid),i.addEvent(t,"drop",function(t){t.preventDefault();var i=e.get(o.uid).dragDrop(t);i&&t.stopPropagation()},n.uid),o.shimExec.call(this,"FileDrop","init")}};return t.FileDrop=n}),n(it,[Q,s,V],function(t,e,i){return t.FileReader=e.extend({},i)}),n(nt,[Q,s,W],function(t,e,i){return t.FileReaderSync=e.extend({},i)}),n(ot,[Q,s,J],function(t,e,i){return t.XMLHttpRequest=e.extend({},i)}),n(rt,[Q,s,K],function(t,e,i){return t.Transporter=e.extend({},i)}),n(at,[Q,s,Y],function(t,e,i){return t.Image=e.extend({},i,{getInfo:function(){var t=this.getRuntime(),i=["tiff","exif","gps"],n={meta:{}},o=t.shimExec.call(this,"Image","getInfo");return o.meta&&e.each(i,function(t){var e,i,r,a,s=o.meta[t];if(s&&s.keys)for(n.meta[t]={},i=0,r=s.keys.length;r>i;i++)e=s.keys[i],a=s[e],a&&(/^(\d|[1-9]\d+)$/.test(a)?a=parseInt(a,10):/^\d*\.\d+$/.test(a)&&(a=parseFloat(a)),n.meta[t][e]=a)}),n.width=parseInt(o.width,10),n.height=parseInt(o.height,10),n.size=parseInt(o.size,10),n.type=o.type,n.name=o.name,n}})}),n(st,[s,p,m,c],function(t,e,i,n){function o(e){var o=this,s=i.capTest,l=i.capTrue;i.call(this,e,r,{access_binary:s(window.FileReader||window.File&&File.getAsDataURL),
access_image_binary:!1,display_media:s(a.Image&&(n.can("create_canvas")||n.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:s(function(){return"Chrome"===n.browser&&n.version>=28||"IE"===n.browser&&n.version>=10}()),resize_image:function(){return a.Image&&o.can("access_binary")&&n.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(e){return!("json"!==e||!window.JSON)||!!~t.inArray(e,["text","document",""])},return_status_code:function(e){return!t.arrayDiff(e,[200,404])},select_file:function(){return n.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return o.can("select_file")},summon_file_dialog:s(function(){return"Firefox"===n.browser&&n.version>=4||"Opera"===n.browser&&n.version>=12||!!~t.inArray(n.browser,["Chrome","Safari"])}()),upload_filesize:l,use_http_method:function(e){return!t.arrayDiff(e,["GET","POST"])}}),t.extend(this,{init:function(){this.trigger("Init")},destroy:function(t){return function(){t.call(o),t=o=null}}(this.destroy)}),t.extend(this.getShim(),a)}var r="html4",a={};return i.addConstructor(r,o),a}),n(lt,[st,s,u,I,d,c],function(t,e,i,n,o,r){function a(){function t(){var o,c,u,p,f,h,m=this,g=m.getRuntime();h=e.guid("uid_"),o=g.getShimContainer(),a&&(u=i.get(a+"_form"),u&&e.extend(u.style,{top:"100%"})),p=document.createElement("form"),p.setAttribute("id",h+"_form"),p.setAttribute("method","post"),p.setAttribute("enctype","multipart/form-data"),p.setAttribute("encoding","multipart/form-data"),e.extend(p.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),f=document.createElement("input"),f.setAttribute("id",h),f.setAttribute("type","file"),f.setAttribute("name",s.name||"Filedata"),f.setAttribute("accept",d.join(",")),e.extend(f.style,{fontSize:"999px",opacity:0}),p.appendChild(f),o.appendChild(p),e.extend(f.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===r.browser&&r.version<10&&e.extend(f.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),f.onchange=function(){var e;this.value&&(e=this.files?this.files[0]:{name:this.value},l=[e],this.onchange=function(){},t.call(m),m.bind("change",function n(){var t,e=i.get(h),o=i.get(h+"_form");m.unbind("change",n),m.files.length&&e&&o&&(t=m.files[0],e.setAttribute("id",t.uid),o.setAttribute("id",t.uid+"_form"),o.setAttribute("target",t.uid+"_iframe")),e=o=null},998),f=p=null,m.trigger("change"))},g.can("summon_file_dialog")&&(c=i.get(s.browse_button),n.removeEvent(c,"click",m.uid),n.addEvent(c,"click",function(t){f&&!f.disabled&&f.click(),t.preventDefault()},m.uid)),a=h,o=u=c=null}var a,s,l=[],d=[];e.extend(this,{init:function(e){var r,a=this,l=a.getRuntime();s=e,d=e.accept.mimes||o.extList2mimes(e.accept,l.can("filter_by_extension")),r=l.getShimContainer(),function(){var t,o,s;t=i.get(e.browse_button),l.can("summon_file_dialog")&&("static"===i.getStyle(t,"position")&&(t.style.position="relative"),o=parseInt(i.getStyle(t,"z-index"),10)||1,t.style.zIndex=o,r.style.zIndex=o-1),s=l.can("summon_file_dialog")?t:r,n.addEvent(s,"mouseover",function(){a.trigger("mouseenter")},a.uid),n.addEvent(s,"mouseout",function(){a.trigger("mouseleave")},a.uid),n.addEvent(s,"mousedown",function(){a.trigger("mousedown")},a.uid),n.addEvent(i.get(e.container),"mouseup",function(){a.trigger("mouseup")},a.uid),t=null}(),t.call(this),r=null,a.trigger({type:"ready",async:!0})},getFiles:function(){return l},disable:function(t){var e;(e=i.get(a))&&(e.disabled=!!t)},destroy:function(){var t=this.getRuntime(),e=t.getShim(),o=t.getShimContainer();n.removeAllEvents(o,this.uid),n.removeAllEvents(s&&i.get(s.container),this.uid),n.removeAllEvents(s&&i.get(s.browse_button),this.uid),o&&(o.innerHTML=""),e.removeInstance(this.uid),a=l=d=s=o=e=null}})}return t.FileInput=a}),n(dt,[st,A],function(t,e){return t.FileReader=e}),n(ct,[st,s,u,E,p,I,v,T],function(t,e,i,n,o,r,a,s){function l(){function t(t){var e,n,o,a,s=this,l=!1;if(c){if(e=c.id.replace(/_iframe$/,""),n=i.get(e+"_form")){for(o=n.getElementsByTagName("input"),a=o.length;a--;)switch(o[a].getAttribute("type")){case"hidden":o[a].parentNode.removeChild(o[a]);break;case"file":l=!0}o=[],l||n.parentNode.removeChild(n),n=null}setTimeout(function(){r.removeEvent(c,"load",s.uid),c.parentNode&&c.parentNode.removeChild(c);var e=s.getRuntime().getShimContainer();e.children.length||e.parentNode.removeChild(e),e=c=null,t()},1)}}var l,d,c;e.extend(this,{send:function(u,p){function f(){var i=x.getShimContainer()||document.body,o=document.createElement("div");o.innerHTML='<iframe id="'+h+'_iframe" name="'+h+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',c=o.firstChild,i.appendChild(c),r.addEvent(c,"load",function(){var i;try{i=c.contentWindow.document||c.contentDocument||window.frames[c.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(i.title)?l=i.title.replace(/^(\d+).*$/,"$1"):(l=200,d=e.trim(i.body.innerHTML),b.trigger({type:"progress",loaded:d.length,total:d.length}),v&&b.trigger({type:"uploadprogress",loaded:v.size||1025,total:v.size||1025}))}catch(o){if(!n.hasSameOrigin(u.url))return void t.call(b,function(){b.trigger("error")});l=404}t.call(b,function(){b.trigger("load")})},b.uid)}var h,m,g,v,b=this,x=b.getRuntime();if(l=d=null,p instanceof s&&p.hasBlob()){if(v=p.getBlob(),h=v.uid,g=i.get(h),m=i.get(h+"_form"),!m)throw new o.DOMException(o.DOMException.NOT_FOUND_ERR)}else h=e.guid("uid_"),m=document.createElement("form"),m.setAttribute("id",h+"_form"),m.setAttribute("method",u.method),m.setAttribute("enctype","multipart/form-data"),m.setAttribute("encoding","multipart/form-data"),m.setAttribute("target",h+"_iframe"),x.getShimContainer().appendChild(m);p instanceof s&&p.each(function(t,i){if(t instanceof a)g&&g.setAttribute("name",i);else{var n=document.createElement("input");e.extend(n,{type:"hidden",name:i,value:t}),g?m.insertBefore(n,g):m.appendChild(n)}}),m.setAttribute("action",u.url),f(),m.submit(),b.trigger("loadstart")},getStatus:function(){return l},getResponse:function(t){if("json"===t&&"string"===e.typeOf(d)&&window.JSON)try{return JSON.parse(d.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(i){return null}return d},abort:function(){var e=this;c&&c.contentWindow&&(c.contentWindow.stop?c.contentWindow.stop():c.contentWindow.document.execCommand?c.contentWindow.document.execCommand("Stop"):c.src="about:blank"),t.call(this,function(){e.dispatchEvent("abort")})}})}return t.XMLHttpRequest=l}),n(ut,[st,P],function(t,e){return t.Image=e}),r([s,l,d,c,u,p,f,h,m,g,v,b,x,_,y,w,E,k,T,q,S,R,I])}(this),function(){"use strict";var t={},e=moxie.core.utils.Basic.inArray;return function i(n){var o,r;for(o in n)r=typeof n[o],"object"!==r||~e(o,["Exceptions","Env","Mime"])?"function"===r&&(t[o]=n[o]):i(n[o])}(window.moxie),t.Env=window.moxie.core.utils.Env,t.Mime=window.moxie.core.utils.Mime,t.Exceptions=window.moxie.core.Exceptions,window.mOxie=t,window.o||(window.o=t),t}(),function(t,e,i){function n(t){function e(t,e,i){var o={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};o[t]?n[o[t]]=e:i||(n[t]=e)}var i=t.required_features,n={};return"string"==typeof i?a.each(i.split(/\s*,\s*/),function(t){e(t,!0)}):"object"==typeof i?a.each(i,function(t,i){e(i,t)}):i===!0&&(t.multipart||(n.send_binary_string=!0),t.chunk_size>0&&(n.slice_blob=!0),t.resize.enabled&&(n.send_binary_string=!0),a.each(t,function(t,i){e(i,!!t,!0)})),n}var o=t.setTimeout,r={},a={VERSION:"2.1.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:e.mimes,ua:e.ua,typeOf:e.typeOf,extend:e.extend,guid:e.guid,get:function(t){var i,n=[];"array"!==e.typeOf(t)&&(t=[t]);for(var o=t.length;o--;)i=e.get(t[o]),i&&n.push(i);return n.length?n:null},each:e.each,getPos:e.getPos,getSize:e.getSize,xmlEncode:function(t){var e={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},i=/[<>&\"\']/g;return t?(""+t).replace(i,function(t){return e[t]?"&"+e[t]+";":t}):t},toArray:e.toArray,inArray:e.inArray,addI18n:e.addI18n,translate:e.translate,isEmptyObj:e.isEmptyObj,hasClass:e.hasClass,addClass:e.addClass,removeClass:e.removeClass,getStyle:e.getStyle,addEvent:e.addEvent,removeEvent:e.removeEvent,removeAllEvents:e.removeAllEvents,cleanName:function(t){var e,i;for(i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],e=0;e<i.length;e+=2)t=t.replace(i[e],i[e+1]);return t=t.replace(/\s+/g,"_"),t=t.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(t,e){var i="";return a.each(e,function(t,e){i+=(i?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),i&&(t+=(t.indexOf("?")>0?"&":"?")+i),t},formatSize:function(t){function e(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}if(t===i||/\D/.test(t))return a.translate("N/A");var n=Math.pow(1024,4);return t>n?e(t/n,1)+" "+a.translate("tb"):t>(n/=1024)?e(t/n,1)+" "+a.translate("gb"):t>(n/=1024)?e(t/n,1)+" "+a.translate("mb"):t>1024?Math.round(t/1024)+" "+a.translate("kb"):t+" "+a.translate("b")},parseSize:e.parseSizeStr,predictRuntime:function(t,i){var n,o;return n=new a.Uploader(t),o=e.Runtime.thatCan(n.getOption().required_features,i||t.runtimes),n.destroy(),o},addFileFilter:function(t,e){r[t]=e}};a.addFileFilter("mime_types",function(t,e,i){t.length&&!t.regexp.test(e.name)?(this.trigger("Error",{code:a.FILE_EXTENSION_ERROR,message:a.translate("File extension error."),file:e}),i(!1)):i(!0)}),a.addFileFilter("max_file_size",function(t,e,i){var n;t=a.parseSize(t),e.size!==n&&t&&e.size>t?(this.trigger("Error",{code:a.FILE_SIZE_ERROR,message:a.translate("File size error."),file:e}),i(!1)):i(!0)}),a.addFileFilter("prevent_duplicates",function(t,e,i){if(t)for(var n=this.files.length;n--;)if(e.name===this.files[n].name&&e.size===this.files[n].size)return this.trigger("Error",{code:a.FILE_DUPLICATE_ERROR,message:a.translate("Duplicate file error."),file:e}),void i(!1);i(!0)}),a.Uploader=function(t){function s(){var t,e,i=0;if(this.state==a.STARTED){for(e=0;e<C.length;e++)t||C[e].status!=a.QUEUED?i++:(t=C[e],this.trigger("BeforeUpload",t)&&(t.status=a.UPLOADING,this.trigger("UploadFile",t)));i==C.length&&(this.state!==a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",C))}}function l(t){t.percent=t.size>0?Math.ceil(t.loaded/t.size*100):100,d()}function d(){var t,e;for(S.reset(),t=0;t<C.length;t++)e=C[t],e.size!==i?(S.size+=e.origSize,S.loaded+=e.loaded*e.origSize/e.size):S.size=i,e.status==a.DONE?S.uploaded++:e.status==a.FAILED?S.failed++:S.queued++;S.size===i?S.percent=C.length>0?Math.ceil(S.uploaded/C.length*100):0:(S.bytesPerSec=Math.ceil(S.loaded/((+new Date-q||1)/1e3)),S.percent=S.size>0?Math.ceil(S.loaded/S.size*100):0)}function c(){var t=O[0]||D[0];return!!t&&t.getRuntime().uid}function u(t,i){if(t.ruid){var n=e.Runtime.getInfo(t.ruid);if(n)return n.can(i)}return!1}function p(){this.bind("FilesAdded",g),this.bind("CancelUpload",y),this.bind("BeforeUpload",v),this.bind("UploadFile",b),this.bind("UploadProgress",x),this.bind("StateChanged",_),this.bind("QueueChanged",d),this.bind("Error",E),this.bind("FileUploaded",w),this.bind("Destroy",k)}function f(t,i){var n=this,o=0,r=[],s={accept:t.filters.mime_types,runtime_order:t.runtimes,required_caps:t.required_features,preferred_caps:I,swf_url:t.flash_swf_url,xap_url:t.silverlight_xap_url};a.each(t.runtimes.split(/\s*,\s*/),function(e){t[e]&&(s[e]=t[e])}),t.browse_button&&a.each(t.browse_button,function(i){r.push(function(r){var l=new e.FileInput(a.extend({},s,{name:t.file_data_name,multiple:t.multi_selection,container:t.container,browse_button:i}));l.onready=function(){var t=e.Runtime.getInfo(this.ruid);e.extend(n.features,{chunks:t.can("slice_blob"),multipart:t.can("send_multipart"),multi_selection:t.can("select_multiple")}),o++,O.push(this),r()},l.onchange=function(){n.addFile(this.files)},l.bind("mouseenter mouseleave mousedown mouseup",function(n){A||(t.browse_button_hover&&("mouseenter"===n.type?e.addClass(i,t.browse_button_hover):"mouseleave"===n.type&&e.removeClass(i,t.browse_button_hover)),t.browse_button_active&&("mousedown"===n.type?e.addClass(i,t.browse_button_active):"mouseup"===n.type&&e.removeClass(i,t.browse_button_active)))}),l.bind("error runtimeerror",function(){l=null,r()}),l.init()})}),t.drop_element&&a.each(t.drop_element,function(t){r.push(function(i){var r=new e.FileDrop(a.extend({},s,{drop_zone:t}));r.onready=function(){var t=e.Runtime.getInfo(this.ruid);n.features.dragdrop=t.can("drag_and_drop"),o++,D.push(this),i()},r.ondrop=function(){n.addFile(this.files)},r.bind("error runtimeerror",function(){r=null,i()}),r.init()})}),e.inSeries(r,function(){"function"==typeof i&&i(o)})}function h(t,i,n){var o=new e.Image;try{o.onload=function(){o.downsize(i.width,i.height,i.crop,i.preserve_headers)},o.onresize=function(){n(this.getAsBlob(t.type,i.quality)),this.destroy()},o.onerror=function(){n(t)},o.load(t)}catch(r){n(t)}}function m(t,i,o){function r(t,e,i){var n=T[t];switch(t){case"max_file_size":"max_file_size"===t&&(T.max_file_size=T.filters.max_file_size=e);break;case"chunk_size":(e=a.parseSize(e))&&(T[t]=e);break;case"filters":"array"===a.typeOf(e)&&(e={mime_types:e}),i?a.extend(T.filters,e):T.filters=e,e.mime_types&&(T.filters.mime_types.regexp=function(t){var e=[];return a.each(t,function(t){a.each(t.extensions.split(/,/),function(t){/^\s*\*\s*$/.test(t)?e.push("\\.*"):e.push("\\."+t.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+e.join("|")+")$","i")}(T.filters.mime_types));break;case"resize":i?a.extend(T.resize,e,{enabled:!0}):T.resize=e;break;case"prevent_duplicates":T.prevent_duplicates=T.filters.prevent_duplicates=!!e;break;case"browse_button":case"drop_element":e=a.get(e);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":T[t]=e,i||(l=!0);break;default:T[t]=e}i||s.trigger("OptionChanged",t,e,n)}var s=this,l=!1;"object"==typeof t?a.each(t,function(t,e){r(e,t,o)}):r(t,i,o),o?(T.required_features=n(a.extend({},T)),I=n(a.extend({},T,{required_features:!0}))):l&&(s.trigger("Destroy"),f.call(s,T,function(t){t?(s.runtime=e.Runtime.getInfo(c()).type,s.trigger("Init",{runtime:s.runtime}),s.trigger("PostInit")):s.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})}))}function g(t,e){[].push.apply(C,e),t.trigger("QueueChanged"),t.refresh()}function v(t,e){if(T.unique_names){var i=e.name.match(/\.([^.]+)$/),n="part";i&&(n=i[1]),e.target_name=e.id+"."+n}}function b(t,i){function n(){c-- >0?o(r,1e3):(i.loaded=f,t.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:i,response:R.responseText,status:R.status,responseHeaders:R.getAllResponseHeaders()}))}function r(){var u,h,m,g;i.status!=a.DONE&&i.status!=a.FAILED&&t.state!=a.STOPPED&&(m={name:i.target_name||i.name},d&&p.chunks&&s.size>d?(g=Math.min(d,s.size-f),u=s.slice(f,f+g)):(g=s.size,u=s),d&&p.chunks&&(t.settings.send_chunk_number?(m.chunk=Math.ceil(f/d),m.chunks=Math.ceil(s.size/d)):(m.offset=f,m.total=s.size)),R=new e.XMLHttpRequest,R.upload&&(R.upload.onprogress=function(e){i.loaded=Math.min(i.size,f+e.loaded),t.trigger("UploadProgress",i)}),R.onload=function(){return R.status>=400?void n():(c=t.settings.max_retries,g<s.size?(u.destroy(),f+=g,i.loaded=Math.min(f,s.size),t.trigger("ChunkUploaded",i,{offset:i.loaded,total:s.size,response:R.responseText,status:R.status,responseHeaders:R.getAllResponseHeaders()}),"Android Browser"===e.Env.browser&&t.trigger("UploadProgress",i)):i.loaded=i.size,u=h=null,!f||f>=s.size?(i.size!=i.origSize&&(s.destroy(),s=null),t.trigger("UploadProgress",i),i.status=a.DONE,t.trigger("FileUploaded",i,{response:R.responseText,status:R.status,responseHeaders:R.getAllResponseHeaders()})):o(r,1),void 0)},R.onerror=function(){n()},R.onloadend=function(){this.destroy(),R=null},t.settings.multipart&&p.multipart?(m.name=i.target_name||i.name,R.open("post",l,!0),a.each(t.settings.headers,function(t,e){R.setRequestHeader(e,t)}),h=new e.FormData,a.each(a.extend(m,t.settings.multipart_params),function(t,e){h.append(e,t)}),h.append(t.settings.file_data_name,u),R.send(h,{runtime_order:t.settings.runtimes,required_caps:t.settings.required_features,preferred_caps:I,swf_url:t.settings.flash_swf_url,xap_url:t.settings.silverlight_xap_url})):(l=a.buildUrl(t.settings.url,a.extend(m,t.settings.multipart_params)),R.open("post",l,!0),R.setRequestHeader("Content-Type","application/octet-stream"),a.each(t.settings.headers,function(t,e){R.setRequestHeader(e,t)}),R.send(u,{runtime_order:t.settings.runtimes,required_caps:t.settings.required_features,preferred_caps:I,swf_url:t.settings.flash_swf_url,xap_url:t.settings.silverlight_xap_url})))}var s,l=t.settings.url,d=t.settings.chunk_size,c=t.settings.max_retries,p=t.features,f=0;i.loaded&&(f=i.loaded=d*Math.floor(i.loaded/d)),s=i.getSource(),t.settings.resize.enabled&&u(s,"send_binary_string")&&~e.inArray(s.type,["image/jpeg","image/png"])?h.call(this,s,t.settings.resize,function(t){s=t,i.size=t.size,r()}):r()}function x(t,e){l(e)}function _(t){if(t.state==a.STARTED)q=+new Date;else if(t.state==a.STOPPED)for(var e=t.files.length-1;e>=0;e--)t.files[e].status==a.UPLOADING&&(t.files[e].status=a.QUEUED,d())}function y(){R&&R.abort()}function w(t){d(),o(function(){s.call(t)},1)}function E(t,e){e.file&&(e.file.status=a.FAILED,l(e.file),t.state==a.STARTED&&(t.trigger("CancelUpload"),o(function(){s.call(t)},1)))}function k(t){t.stop(),a.each(C,function(t){t.destroy()}),C=[],O.length&&(a.each(O,function(t){t.destroy()}),O=[]),D.length&&(a.each(D,function(t){t.destroy()}),D=[]),I={},A=!1,q=R=null,S.reset()}var T,q,S,R,$=a.guid(),C=[],I={},O=[],D=[],A=!1;T={runtimes:e.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_chunk_number:!0},m.call(this,t,null,!0),S=new a.QueueProgress,a.extend(this,{id:$,uid:$,state:a.STOPPED,features:{},runtime:null,files:C,settings:T,total:S,init:function(){var t=this;return"function"==typeof T.preinit?T.preinit(t):a.each(T.preinit,function(e,i){t.bind(i,e)}),T.browse_button&&T.url?(p.call(this),void f.call(this,T,function(i){"function"==typeof T.init?T.init(t):a.each(T.init,function(e,i){t.bind(i,e)}),i?(t.runtime=e.Runtime.getInfo(c()).type,t.trigger("Init",{runtime:t.runtime}),t.trigger("PostInit")):t.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})})):void this.trigger("Error",{code:a.INIT_ERROR,message:a.translate("Init error.")})},setOption:function(t,e){m.call(this,t,e,!this.runtime)},getOption:function(t){return t?T[t]:T},refresh:function(){O.length&&a.each(O,function(t){t.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=a.STARTED&&(this.state=a.STARTED,this.trigger("StateChanged"),s.call(this))},stop:function(){this.state!=a.STOPPED&&(this.state=a.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){A=arguments[0]===i||arguments[0],O.length&&a.each(O,function(t){t.disable(A)}),this.trigger("DisableBrowse",A)},getFile:function(t){var e;for(e=C.length-1;e>=0;e--)if(C[e].id===t)return C[e]},addFile:function(t,i){function n(t,i){var n=[];e.each(d.settings.filters,function(e,i){r[i]&&n.push(function(n){r[i].call(d,e,t,function(t){n(!t)})})}),e.inSeries(n,i)}function s(t){var r=e.typeOf(t);if(t instanceof e.File){if(!t.ruid&&!t.isDetached()){if(!l)return!1;t.ruid=l,t.connectRuntime(l)}s(new a.File(t))}else t instanceof e.Blob?(s(t.getSource()),t.destroy()):t instanceof a.File?(i&&(t.name=i),u.push(function(e){n(t,function(i){i||(p.push(t),d.trigger("FileFiltered",t)),o(e,1)})})):e.inArray(r,["file","blob"])!==-1?s(new e.File(null,t)):"node"===r&&"filelist"===e.typeOf(t.files)?e.each(t.files,s):"array"===r&&(i=null,e.each(t,s))}var l,d=this,u=[],p=[];l=c(),s(t),u.length&&e.inSeries(u,function(){p.length&&d.trigger("FilesAdded",p)})},removeFile:function(t){for(var e="string"==typeof t?t:t.id,i=C.length-1;i>=0;i--)if(C[i].id===e)return this.splice(i,1)[0]},splice:function(t,e){var n=C.splice(t===i?0:t,e===i?C.length:e),o=!1;return this.state==a.STARTED&&(o=!0,this.stop()),this.trigger("FilesRemoved",n),a.each(n,function(t){t.destroy()}),this.trigger("QueueChanged"),this.refresh(),o&&this.start(),n},bind:function(t,e,i){var n=this;a.Uploader.prototype.bind.call(this,t,function(){var t=[].slice.call(arguments);return t.splice(0,1,n),e.apply(this,t)},0,i)},destroy:function(){this.trigger("Destroy"),T=S=null,this.unbindAll()}})},a.Uploader.prototype=e.EventTarget.instance,a.File=function(){function t(t){a.extend(this,{id:a.guid(),name:t.name||t.fileName,type:t.type||"",size:t.size||t.fileSize,origSize:t.size||t.fileSize,loaded:0,percent:0,status:a.QUEUED,lastModifiedDate:t.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var t=this.getSource().getSource();return e.inArray(e.typeOf(t),["blob","file"])!==-1?t:null},getSource:function(){return i[this.id]?i[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete i[this.id])}}),i[this.id]=t}var i={};return t}(),a.QueueProgress=function(){var t=this;t.size=0,t.loaded=0,t.uploaded=0,t.failed=0,t.queued=0,t.percent=0,t.bytesPerSec=0,t.reset=function(){t.size=t.loaded=t.uploaded=t.failed=t.queued=t.percent=t.bytesPerSec=0}},t.plupload=a}(window,mOxie),define("plupload",function(){}),define("common/models/basic/js/require-css!old/css/bbs_attach",[],function(){}),define("old/js/bbs_attach",["web_old_popup2","old/js/bbs_dlg_common","plupload","css!old/css/bbs_dlg_common.css","css!old/css/bbs_attach.css"],function(Popup,BbsUtils){function Attach(t){this.init(t)}return Attach.prototype={opt:{contentHTML:'<div class="qyEdit_append_pic clearfix"><div class="qyEdit_append_title clearfix"><strong class="text fontYaHei">插入附件</strong><a href="javascript:;" title="关闭" class="close"></a></div><div class="qyEdit_append_affix"><div class="input" id="selContainerWrap"><div class="upload" id="selContainer"><span class="default" id="selBtn">从电脑中选择文件上传</span></div><span class="toggleTip"></span></div><div class="tips"><p class="error"><span></span>仅支持不超过20MB大小的文件</p><p>支持单个不超过20MB的pdf格式文件上传</p></div></div><div class="qyEdit_append_button clearfix"><a href="javascript:;" class="btn ui_button_disabled">插入附件</a><a href="javascript:;" class="ui_button_cancel">取消</a></div></div>',exClassName:"editor_file",width:620},GStatus:!1,GFile:null,init:function(t){return $.extend(this,t||{}),this.popup=new Popup($.extend(BbsUtils.dlgOpt,this.opt)),this.dom=this.popup.ui.$content.find(".qyEdit_append_pic"),this},initUploader:function(){var me=this;$.ajax({url:BBS_Url.getHashAttach,async:!1,success:function(t){t=JSON.parse(t),0==t.error_code&&(me.GKey=t.data.key)}}).done(function(){me.uploader&&me.uploader.destroy()&(me.uploader=null),me.uploader=new plupload.Uploader({runtimes:"html5,html4,flash",browse_button:me.dom.find("#selContainer").get(0),container:me.dom.find("#selContainerWrap").get(0),flash_swf_url:"/qcross/static/models/basic/js/plupload/Moxie.swf",max_file_size:"20mb",multipart:!0,multi_selection:!1,url:BBS_Url.uploadAttach,filters:[{title:"Pdf files",extensions:"pdf"}],init:{BeforeUpload:function(t,e,i){me.uploader.setOption({multipart_params:{hash:me.GKey,file:e.name}}),me.GStatus=!0},FilesAdded:function(t,e){me.uploader.start()},UploadProgress:function(t,e){me.dom.find(".toggleTip").removeClass("correct").addClass("loading")},FileUploaded:function(up,file,resp){var res="function"==typeof JSON.parse?JSON.parse(resp.response):eval("("+resp.response+")"),fT=file;fT.key=res.data.key,me.GFile=fT,me.dom.find(".toggleTip").removeClass("loading").addClass("correct"),me.GFile&&me.setName(),me.GStatus=!1,up.destroy()},UploadComplete:function(t,e){},Error:function(t,e){var i="";if(e)switch(e.code){case-100:case-200:i="网络错误";break;case-300:case-400:i="无法打开文件";break;case-600:i="单个文件必须小于20M";break;case-601:i="文件扩展名不正确"}t.trigger("UploadError",e,i),requirejs(["web_old_tip"],function(t){t.tip({text:i,type:"error"})}),me.dom.find(".toggleTip").removeClass("loading"),me.dom.find(".btn").removeClass("ui_button").addClass("ui_button_disabled")}}}),me.uploader.init()})},setName:function(t){var e=this.dom.find(".btn");this.dom.find("#selBtn").html(this.GFile.name),e.removeClass("ui_button_disabled").addClass("ui_button")},bindEvent:function(){var t=this;this.dom.off("click"),this.dom.on("click",".close",function(e){t.hide(),t.uploader&&t.uploader.destroy()}),this.dom.on("click",".ui_button_cancel",function(e){t.hide(),t.uploader&&t.uploader.destroy()}),this.dom.on("click",".btn",function(){t.GFile&&0==t.GStatus&&(t.editor.execCommand("insertfile",t.GFile),t.hide(),$(document).trigger("x-editDomInsert"))}),this.initUploader()},show:function(){this.popup.show(),this.bindEvent(),this.dom.find(".toggleTip").removeClass("correct loading"),this.dom.find("#selBtn").html("从电脑中选择文件上传")},hide:function(){this.popup.hide(!0)}},Attach}),define("common/models/basic/js/require-css!old/css/bbs_createalbum",[],function(){}),define("old/js/bbs_createalbum",["web_old_popup2","old/js/bbs_dlg_common","css!old/css/bbs_dlg_common.css","css!old/css/bbs_createalbum.css"],function(t,e){function i(t){this.init(t)}return i.prototype={opt:{contentHTML:'<div class="qyEdit_append_pic clearfix"><div class="qyEdit_append_title clearfix"><strong class="text fontYaHei">创建新相册</strong><a href="javascript:;" title="关闭" class="close"></a></div><div class="qyEdit_append_video"><div class="input"><input type="text" value="" placeholder="相册名称" class="ui2_input" /></div><div class="tips"><p class="error"><span></span>相册名称不能超过15个汉字</p></div></div><div class="qyEdit_append_button clearfix"><a href="javascript:;" class="btn ui_button_disabled">创建相册</a><a href="javascript:;" class="ui_button_cancel">取消</a></div></div>',exClassName:"editor_createAlbum",width:622},editor:null,init:function(e){return $.extend(this,e||{}),this.popup=new t($.extend(e,this.opt)),this.dom=$("."+this.opt.exClassName),this},setTipError:function(t){var e=this.dom.find(".qyEdit_append_video"),i=this.dom.find(".btn");1==t?(e.addClass("showError"),i.removeClass("ui_button").addClass("ui_button_disabled")):(e.removeClass("showError"),i.removeClass("ui_button_disabled").addClass("ui_button"))},bindEvent:function(){var t=this;this.dom.off("click input"),this.dom.on("click",".close",function(e){t.hide()}),this.dom.on("click",".ui_button_cancel",function(e){t.hide()}),this.dom.on("input",".ui2_input",function(){var e=$(this).val();e.length>0&&e.length<=15?t.setTipError(!1):0==e.length?t.setTipError(!1):t.setTipError(!0)}),this.dom.on("click",".btn",function(){var e=$(this);e.hasClass("ui_button")&&$.ajax({url:BBS_Url.opensession,method:"get",async:!1,success:function(e){t.create()}})})},create:function(){var t=this,e=this.dom.find(".ui2_input").val();$.ajax({url:BBS_Url.singleCreateAlbum,method:"post",async:!1,data:{name:e},success:function(i){var n=JSON.parse(i);0==n.error_code&&requirejs(["web_old_tip"],function(i){i.tip({text:n.data.msg}),t.hide(),$(t).trigger("createalbumsuccess",{id:n.data.id,name:e,url:n.data.url})})}})},resetIpt:function(){var t=this.dom.find(".ui2_input");t.val(""),e.$focus(t[0])},show:function(){this.popup.show(),this.resetIpt(),this.bindEvent()},hide:function(){this.popup.hide(!0)}},i}),define("common/models/basic/js/require-css!old/css/loading",[],function(){}),define("old/js/loading",["css!old/css/loading.css"],function(){function t(t){this.init(t)}return t.prototype={parent:null,status:!1,init:function(t){$.extend(this,t)},getHtml:function(){return'<div class="loading"><img src="//static.qyer.com/models/basic/images/loading-32.gif"></div>'},render:function(t){this.dom=$(this.getHtml()),t.append(this.dom),this.status=!0},show:function(t){this.dom.show()},hide:function(){this.dom.hide()}},t}),define("old/js/bbs_lift",[],function(){function t(t){this.init(t)}return t.prototype={data:[],dom:null,editor:null,init:function(t){return $.extend(this,t),this},getHtml:function(){return'<div class="lift_cont fontSong"><div class="lift_head"><h3>帖子电梯</h3><span class="reload animateRotate"></span></div><div class="lift_body">'+this.getDataHtml()+"</div></div>"},getDataHtml:function(){var t=[];if(this.data.length){for(var e,i=0;e=this.data[i++];)if(e.mainTitle&&t.push('<h4><span data-alt="'+e.alt+'">'+e.mainTitle+"</span></h4>"),e.subTitle.length>0){t.push("<ul>");for(var n,o=0;n=e.subTitle[o++];)t.push('<li><span data-alt="'+n.alt+'">'+n.title+"</span></li>");t.push("</ul>")}}else t.push("<span style='color:#c0c0c0'>选中文字设置标题1或标题2后，会自动生成目录电梯</span>");return t.join("")},bindEvent:function(){var t=this;this.dom.on("click",".reload",function(){t.reload()}),this.dom.on("click","span",function(){var e=$(this).attr("data-alt");$(t).trigger("scrollview",e)})},reload:function(){var t,e=this;e.loadData(),t=$(e.getHtml()),e.dom&&(e.dom.replaceWith(t),e.dom=t,e.bindEvent())},loadData:function(){for(var t,e,i=this.editor.document.body.childNodes,n=[],o=0;e=i[o++];)1==/h1/i.test(e.tagName)&&($(e).prop("id",o),t={mainTitle:$(e).text(),alt:o,subTitle:[]},n.push(t)),1==/h2/i.test(e.tagName)&&($(e).prop("id",o),n.length<1&&(t={mainTitle:"",subTitle:[]},n.push(t)),t=n[n.length-1],t.subTitle.push({title:$(e).text(),alt:o}));this.data=n},getDom:function(){var t=this;return this.dom?(this.reload(),setTimeout(function(){t.dom.find(".reload").removeClass("animateRotate")},500),this.dom):(this.loadData(),this.dom=$(this.getHtml()),this.bindEvent(),setTimeout(function(){t.dom.find(".reload").removeClass("animateRotate")},500),this.dom)}},t}),define("old/js/bbs_emotion",[],function(){function t(t){this.init(t)}return t.prototype={baseUrl:"//static.qyer.com/models/project/bbs/css/images/face/",maxNum:30,dom:null,editor:null,init:function(t){return $.extend(this,t),this},getDataHtml:function(){for(var t,e=[],i=0;i<this.maxNum;i++)t=-26*i+"px",e.push("<span style='background-position:0 "+t+";' data-num='"+i+"'></span>");return e.join("")},getHtml:function(){return'<div class="emotion_cont clearfix">'+this.getDataHtml()+"</div>"},bindEvent:function(){var t=this;this.dom.on("click","span",function(e){var i=$(this).attr("data-num"),n={type:"emotion",src:t.baseUrl+"face"+i+".png"};n._src=n.src,t.editor.execCommand("insertimage",n),$(document).trigger("x-editDomInsert")})},getDom:function(){return this.dom=$(this.getHtml()),this.bindEvent(),this.dom}},t}),define("common/models/basic/js/require-css!web_old_slidconfirm",[],function(){}),define("web_old_slidconfirm",["css!web_old_slidconfirm"],function(){function t(t){i.find(".qui-slidConfirm-text").html(t.text||"确定要继续吗？");var n,o=e(t.target),r=o.offset(),a=r.left-i.width()/2+o.width()/2;n=t.down?r.top+o.height():r.top-i.height()-o.height()-8,0>n&&(n=0),i.css({left:a,top:n}),o=r=a=n=null}var e=jQuery,i=null;!function(){var t=['<div class="qui-slidConfirm" style="display:none">','<div class="qui-slidConfirm-title">','<span class="qui-slidConfirm-text">你确认要删除吗</span>',"</div>",'<div class="qui-slidConfirm-bottom">','<input type="button" class="qui-slidConfirm-cancelBtn ui_button_cancel" value="取消" /> ','<input type="button" class="qui-slidConfirm-okBtn ui_button" value="确定" /> ',"</div>","</div>"].join("");i=e(t),i.appendTo(document.body);
}();var n={confirm:function(n){return t(n),i.undelegate("click").delegate(".qui-slidConfirm-cancelBtn,.qui-slidConfirm-okBtn","click",function(){-1!=this.className.indexOf("qui-slidConfirm-cancelBtn")?n.onCancel&&n.onCancel():-1!=this.className.indexOf("qui-slidConfirm-okBtn")&&n.onOK&&n.onOK(),i.slideUp(300)}).slideDown(300,function(){e(document).one("click",function(t){var e=t.target||t.srcElement;-1==e.className.indexOf("qui-slidConfirm-")&&(i.hide(),n.onCancel&&n.onCancel())})}),this}};return n}),define("common/models/basic/js/require-css!web_old_select",[],function(){}),define("web_old_select",["css!web_old_select"],function(){function t(t,e){for(var i=[],n=e;n<t.length;n++)i.push(t[n]);return i}function e(t){this.$obj=t.$obj,this.$title=this.$obj.find(".titles > .title-text"),this.$content=this.$obj.find(".contents"),this.option=t.option,this.selectIndex=0,this.setUI(),this.bindEvent(),this.setDefaultValue()}var i=jQuery;e.prototype={$obj:null,$title:null,$content:null,option:null,selectIndex:null,_disable:!1,setUI:function(){var t=this.$obj.find(".titles"),e=this.$obj.attr("data-ui-width");e=e?e:t.outerWidth(),e=parseInt(e,10),0>=e&&(e=100),e-=2,t.css("width",e),this.$obj.css("width",t.outerWidth());var i=this.$obj.attr("data-ui-height");i&&(this.$obj.css("height",i),this.$obj.find(".titles").css("line-height",i),this.$content.css("top",i)),e=this.$obj.attr("data-ui-menuWidth"),e=e?e:t.outerWidth(),e=parseInt(e,10),e-=2,this.$content.css("width",e),e=i=t=null},bindEvent:function(){var t=this,e=200;this.$obj.delegate(".titles","click",function(n){t._disable||(window.__currentSelect__&&window.__currentSelect__!=t&&window.__currentSelect__.$content.slideUp(e),window.__currentSelect__=t,n.stopPropagation(),t.$content.is(":hidden")?(t.$content.slideDown(e),i(document).one("click",function(){t.$content.slideUp(e)})):t.$content.slideUp(e))}),this.$obj.delegate(".contents > ul > li ","click",function(){t.$content.slideUp(e);var n=i(this);if(t.option&&t.option.onBeforeChange){var o=t.option.onBeforeChange.call(t.$obj[0],n[0]);if(o===!1)return}t.selectIndex=n.index();var r=n.attr("data-value");t.$obj.attr("data-value",r),t.$title.html(n.find("a").html()),t.option&&t.option.onChange&&t.option.onChange.call(t.$obj[0],n[0]),n=r=null})},setDefaultValue:function(){var t=i.trim(this.$obj.attr("data-dafaultValue"));if(t){var e=this.$content.find('ul > li[data-value="'+t+'"] ');e.length&&(this.selectIndex=e.index(),this.$title.html(e.text())),e=null}t=null},getSelectItem:function(){return this.$content.find("ul > li:eq("+this.selectIndex+") ")[0]},setSelectIndex:function(t){this.selectIndex=t;var e=this.$content.find("ul > li:eq("+t+") > a ").html();this.$title.html(e),e=null},getSelectIndex:function(){return this.selectIndex},setOption:function(t,e){this.option[t]=e},setValue:function(t){var e=this.$content.find('ul > li[data-value="'+t+'"]');this.selectIndex=e.index(),this.$title.html(e.children("a").html()),e=null},disable:function(){this._disable=!0,this.$obj.addClass("qui-select-disable")},enable:function(){this._disable=!1,this.$obj.removeClass("qui-select-disable")},setTitle:function(t){this.$title.html(t)}},i.fn.extend({qyerSelect:function(n){var o={getSelectItem:function(t){return t.data("_qyerSelect").getSelectItem()},getValue:function(t){return t.data("_qyerSelect").getSelectItem().getAttribute("data-value")},setValue:function(t,e){return t.data("_qyerSelect").setValue(e)},setSelectIndex:function(t,e){return t.data("_qyerSelect").setSelectIndex(e),t},setOption:function(t,e,i){return t.data("_qyerSelect").setOption(e,i),t},getSelectIndex:function(t){return t.data("_qyerSelect").getSelectIndex()},disable:function(t){return t.data("_qyerSelect").disable()},enable:function(t){return t.data("_qyerSelect").enable()},setTitle:function(t,e){return t.data("_qyerSelect").setTitle(e)}},r=i.type(n);if("object"==r||"undefined"==r){var a;return i.each(this,function(t,o){a=i(o),a.data("_qyerSelect")||a.data("_qyerSelect",new e({$obj:a,option:n?n:{}}))}),a=null,this}if("string"==r){var a,s=arguments,l=[];return i.each(this,function(e,r){if(a=i(r),o[n]){var d=t(s,1);d.unshift(a),l.push(o[n].apply(o,d)),d=null}}),a=s=null,l.length?1==l.length?l[0]:l:this}}})}),define("common/models/basic/js/require-css!old/css/tools",[],function(){}),!function(global){function createCookie(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var o="; expires="+n.toGMTString();document.cookie=t+"="+e+o+"; path=/"}function readCookie(t){for(var e=t+"=",i=document.cookie.split(";"),n=0,o=i.length;n<o;n++){for(var r=i[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(e))return r.substring(e.length,r.length)}return null}function QiniuJsSDK(){function log(t,e){for(var i="[qiniu-js-sdk]["+t+"]",n=i,o=0;o<e.length;o++)n+="string"==typeof e[o]?" "+e[o]:" "+that.stringifyJSON(e[o]);that.detectIEVersion()?console.log(n):(e.unshift(i),console.log.apply(console,e)),document.getElementById("qiniu-js-sdk-log")&&(document.getElementById("qiniu-js-sdk-log").innerHTML+="<p>"+n+"</p>")}function makeLogFunc(t){var e=t.toLowerCase();logger[e]=function(){if(window.console&&window.console.log&&logger.level>=logger[t]){var i=Array.prototype.slice.call(arguments);log(e,i)}}}var that=this;this.detectIEVersion=function(){for(var t=4,e=document.createElement("div"),i=e.getElementsByTagName("i");e.innerHTML="<!--[if gt IE "+t+"]><i></i><![endif]-->",i[0];)t++;return t>4&&t};var logger={MUTE:0,FATA:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,level:0};for(var property in logger)logger.hasOwnProperty(property)&&"number"==typeof logger[property]&&!logger.hasOwnProperty(property.toLowerCase())&&makeLogFunc(property);var qiniuUploadUrl;qiniuUploadUrl="https:"===window.location.protocol?"https://up.qbox.me":"http://upload.qiniu.com";var qiniuUploadUrls=["http://upload.qiniu.com","http://up.qiniu.com"],qiniuUpHosts={http:["http://upload.qiniu.com","http://up.qiniu.com"],https:["https://up.qbox.me"]},changeUrlTimes=0;this.resetUploadUrl=function(){var t="https:"===window.location.protocol?qiniuUpHosts.https:qiniuUpHosts.http,e=changeUrlTimes%t.length;qiniuUploadUrl=t[e],changeUrlTimes++,logger.debug("resetUploadUrl: "+qiniuUploadUrl)},this.isImage=function(t){return t=t.split(/[?#]/)[0],/\.(png|jpg|jpeg|gif|bmp)$/i.test(t)},this.getFileExtension=function(t){var e,i=t.split(".");return e=1===i.length||""===i[0]&&2===i.length?"":i.pop().toLowerCase()},this.utf8_encode=function(t){if(null===t||"undefined"==typeof t)return"";var e,i,n=t+"",o="",r=0;e=i=0,r=n.length;for(var a=0;a<r;a++){var s=n.charCodeAt(a),l=null;if(s<128)i++;else if(s>127&&s<2048)l=String.fromCharCode(s>>6|192,63&s|128);else if(63488&s^!0)l=String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128);else{if(64512&s^!0)throw new RangeError("Unmatched trail surrogate at "+a);var d=n.charCodeAt(++a);if(64512&d^!0)throw new RangeError("Unmatched lead surrogate at "+(a-1));s=((1023&s)<<10)+(1023&d)+65536,l=String.fromCharCode(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}null!==l&&(i>e&&(o+=n.slice(e,i)),o+=l,e=i=a+1)}return i>e&&(o+=n.slice(e,r)),o},this.base64_decode=function(t){var e,i,n,o,r,a,s,l,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,u=0,p="",f=[];if(!t)return t;t+="";do o=d.indexOf(t.charAt(c++)),r=d.indexOf(t.charAt(c++)),a=d.indexOf(t.charAt(c++)),s=d.indexOf(t.charAt(c++)),l=o<<18|r<<12|a<<6|s,e=l>>16&255,i=l>>8&255,n=255&l,64===a?f[u++]=String.fromCharCode(e):64===s?f[u++]=String.fromCharCode(e,i):f[u++]=String.fromCharCode(e,i,n);while(c<t.length);return p=f.join("")},this.base64_encode=function(t){var e,i,n,o,r,a,s,l,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,u=0,p="",f=[];if(!t)return t;t=this.utf8_encode(t+"");do e=t.charCodeAt(c++),i=t.charCodeAt(c++),n=t.charCodeAt(c++),l=e<<16|i<<8|n,o=l>>18&63,r=l>>12&63,a=l>>6&63,s=63&l,f[u++]=d.charAt(o)+d.charAt(r)+d.charAt(a)+d.charAt(s);while(c<t.length);switch(p=f.join(""),t.length%3){case 1:p=p.slice(0,-2)+"==";break;case 2:p=p.slice(0,-1)+"="}return p},this.URLSafeBase64Encode=function(t){return t=this.base64_encode(t),t.replace(/\//g,"_").replace(/\+/g,"-")},this.URLSafeBase64Decode=function(t){return t=t.replace(/_/g,"/").replace(/-/g,"+"),this.base64_decode(t)},this.createAjax=function(t){var e={};return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},this.parseJSON=function(data){if(window.JSON&&window.JSON.parse)return window.JSON.parse(data);var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,text=String(data);return rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),eval("("+text+")")},this.stringifyJSON=function(t){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(t);switch(typeof t){case"string":return'"'+t.replace(/(["\\])/g,"\\$1")+'"';case"array":return"["+t.map(that.stringifyJSON).join(",")+"]";case"object":if(t instanceof Array){for(var e=[],i=t.length,n=0;n<i;n++)e.push(that.stringifyJSON(t[n]));return"["+e.join(",")+"]"}if(null===t)return"null";var o=[];for(var r in t)t.hasOwnProperty(r)&&o.push(that.stringifyJSON(r)+":"+that.stringifyJSON(t[r]));return"{"+o.join(",")+"}";case"number":return t;case!1:return t;case"boolean":return t}},this.trim=function(t){return null===t?"":t.replace(/^\s+|\s+$/g,"")},this.uploader=function(t){var e=function(){var e,i,n,o=that.detectIEVersion(),r="Safari"===mOxie.Env.browser&&mOxie.Env.version<=5&&"Windows"===mOxie.Env.os&&"7"===mOxie.Env.osVersion||"Safari"===mOxie.Env.browser&&"iOS"===mOxie.Env.os&&"7"===mOxie.Env.osVersion;o&&o<9&&t.chunk_size&&t.runtimes.indexOf("flash")>=0?t.chunk_size=0:r?t.chunk_size=0:(e=20,i=4<<e,n=plupload.parseSize(t.chunk_size),n>i&&(t.chunk_size=i))},i=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];0===n.indexOf("-H")?e.push(n.split(" ")[2]):e.push(n)}return e},n=function(t){var e=t.split(":"),i=e[0],n=that.parseJSON(that.URLSafeBase64Decode(e[2]));return n.ak=i,n.scope.indexOf(":")>=0?(n.bucket=n.scope.split(":")[0],n.key=n.scope.split(":")[1]):n.bucket=n.scope,n},o=function(e){var o=n(e),r=window.location.protocol+"//uc.qbox.me/v1/query?ak="+o.ak+"&bucket="+o.bucket;logger.debug("putPolicy: ",o),logger.debug("get uphosts from: ",r);var a,s=that.detectIEVersion();s&&s<=9?(a=new mOxie.XMLHttpRequest,mOxie.Env.swf_url=t.flash_swf_url):a=that.createAjax(),a.open("GET",r,!0);var l=function(){if(logger.debug("ajax.readyState: ",a.readyState),4===a.readyState)if(logger.debug("ajax.status: ",a.status),a.status<400){var t=that.parseJSON(a.responseText);qiniuUpHosts.http=i(t.http.up),qiniuUpHosts.https=i(t.https.up),logger.debug("get new uphosts: ",qiniuUpHosts),that.resetUploadUrl()}else logger.error("get uphosts error: ",a.responseText)};s&&s<=9?a.bind("readystatechange",l):a.onreadystatechange=l,a.send()},r=function(e){return!that.token||t.uptoken_url&&that.tokenInfo.isExpired()?a(e):that.token},a=function(e){if(t.uptoken)that.token=t.uptoken;else if(t.uptoken_url){logger.debug("get uptoken from: ",that.uptoken_url);var i=that.createAjax();if(i.open("GET",that.uptoken_url,!1),i.setRequestHeader("If-Modified-Since","0"),i.send(),200===i.status){var n=that.parseJSON(i.responseText);that.token=n.uptoken;var r=that.token.split(":"),a=that.parseJSON(that.URLSafeBase64Decode(r[2]));that.tokenMap||(that.tokenMap={});var s=function(t){return Math.ceil(t.getTime()/1e3)},l=s(new Date(i.getResponseHeader("date"))),d=s(new Date);that.tokenInfo={serverDelay:d-l,deadline:a.deadline,isExpired:function(){var t=this.deadline-s(new Date)+this.serverDelay;return t<600}},logger.debug("get new uptoken: ",that.token),logger.debug("get token info: ",that.tokenInfo)}else logger.error("get uptoken error: ",i.responseText)}else t.uptoken_func?(logger.debug("get uptoken from uptoken_func"),that.token=t.uptoken_func(e),logger.debug("get new uptoken: ",that.token)):logger.error("one of [uptoken, uptoken_url, uptoken_func] settings in options is required!");return that.token&&o(that.token),that.token},s=function(e,i,n){var o="",r=!1;if(!t.save_key)if(r=e.getOption&&e.getOption("unique_names"),r=r||e.settings&&e.settings.unique_names){var a=that.getFileExtension(i.name);o=a?i.id+"."+a:i.id}else o="function"==typeof n?n(e,i):i.name;return o};if(t.log_level&&(logger.level=t.log_level),!t.domain)throw"domain setting in options is required!";if(!t.browse_button)throw"browse_button setting in options is required!";if(!t.uptoken&&!t.uptoken_url&&!t.uptoken_func)throw"one of [uptoken, uptoken_url, uptoken_func] settings in options is required!";logger.debug("init uploader start"),logger.debug("environment: ",mOxie.Env),logger.debug("userAgent: ",navigator.userAgent);var l={},d=t.init&&t.init.Error,c=t.init&&t.init.FileUploaded;t.init.Error=function(){},t.init.FileUploaded=function(){},that.uptoken_url=t.uptoken_url,that.token="",that.key_handler="function"==typeof t.init.Key?t.init.Key:"",this.domain=t.domain;var u="",p={isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""};e(),logger.debug("invoke reset_chunk_size()"),logger.debug("op.chunk_size: ",t.chunk_size);var f={url:qiniuUploadUrl,multipart_params:{token:""}},h=that.detectIEVersion();h&&h<=9&&(f.multipart_params.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),plupload.extend(l,t,f),logger.debug("option: ",l);var m=new plupload.Uploader(l);logger.debug("new plupload.Uploader(option)"),m.bind("Init",function(e,i){logger.debug("Init event activated"),t.get_new_uptoken||a(null)}),logger.debug("bind Init event"),m.bind("FilesAdded",function(t,e){logger.debug("FilesAdded event activated");var i=t.getOption&&t.getOption("auto_start");i=i||t.settings&&t.settings.auto_start,logger.debug("auto_start: ",i),logger.debug("files: ",e);var n=function(){return"ios"===mOxie.Env.OS.toLowerCase()};if(n())for(var o=0;o<e.length;o++){var r=e[o],a=that.getFileExtension(r.name);r.name=r.id+"."+a}i&&setTimeout(function(){t.start(),logger.debug("invoke up.start()")},0),t.refresh()}),logger.debug("bind FilesAdded event"),m.bind("BeforeUpload",function(e,i){logger.debug("BeforeUpload event activated"),i.speed=i.speed||0,u="",t.get_new_uptoken&&a(i);var n=function(e,i,n){p.startTime=(new Date).getTime();var r;r=t.save_key?{token:that.token}:{key:s(e,i,n),token:that.token};var a=that.detectIEVersion();a&&a<=9&&(r.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),logger.debug("directUpload multipart_params_obj: ",r);var l=t.x_vars;if(void 0!==l&&"object"==typeof l)for(var d in l)l.hasOwnProperty(d)&&("function"==typeof l[d]?r["x:"+d]=l[d](e,i):"object"!=typeof l[d]&&(r["x:"+d]=l[d]));e.setOption({url:qiniuUploadUrl,multipart:!0,chunk_size:o()?t.max_file_size:void 0,multipart_params:r})},o=function(){var t=navigator.userAgent.toLowerCase();return!(!t.match(/MicroMessenger/i)&&"QQBrowser"!==mOxie.Env.browser&&!t.match(/V1_AND_SQ/i)||"android"!==mOxie.Env.OS.toLowerCase())},l=e.getOption&&e.getOption("chunk_size");if(l=l||e.settings&&e.settings.chunk_size,logger.debug("uploader.runtime: ",m.runtime),logger.debug("chunk_size: ",l),"html5"!==m.runtime&&"flash"!==m.runtime||!l)logger.debug("directUpload because uploader.runtime !== 'html5' || uploader.runtime !== 'flash' || !chunk_size"),n(e,i,that.key_handler);else if(i.size<l||o())logger.debug("directUpload because file.size < chunk_size || is_android_weixin_or_qq()"),n(e,i,that.key_handler);else{var d=localStorage.getItem(i.name),c=l;if(d){d=that.parseJSON(d);var f=(new Date).getTime(),h=d.time||0,g=864e5;f-h<g&&100!==d.percent&&i.size===d.total?(i.percent=d.percent,i.loaded=d.offset,u=d.ctx,p.isResumeUpload=!0,p.resumeFilesize=d.offset,d.offset+c>i.size&&(c=i.size-d.offset)):localStorage.removeItem(i.name)}p.startTime=(new Date).getTime();var v={},b=that.detectIEVersion();b&&b<=9&&(v.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),e.setOption({url:qiniuUploadUrl+"/mkblk/"+c,multipart:!1,chunk_size:l,required_features:"chunks",headers:{Authorization:"UpToken "+r(i)},multipart_params:v})}}),logger.debug("bind BeforeUpload event"),m.bind("UploadProgress",function(t,e){logger.trace("UploadProgress event activated"),p.currentTime=(new Date).getTime();var i=p.currentTime-p.startTime,n=e.loaded||0;p.isResumeUpload&&(n=e.loaded-p.resumeFilesize),e.speed=(n/i*1e3).toFixed(0)||0}),logger.debug("bind UploadProgress event"),m.bind("ChunkUploaded",function(t,e,i){logger.debug("ChunkUploaded event activated"),logger.debug("file: ",e),logger.debug("info: ",i);var n=that.parseJSON(i.response);logger.debug("res: ",n),u=u?u+","+n.ctx:n.ctx;var o=i.total-i.offset,a=t.getOption&&t.getOption("chunk_size");a=a||t.settings&&t.settings.chunk_size,o<a&&(t.setOption({url:qiniuUploadUrl+"/mkblk/"+o}),logger.debug("up.setOption url: ",qiniuUploadUrl+"/mkblk/"+o)),t.setOption({headers:{Authorization:"UpToken "+r(e)}}),localStorage.setItem(e.name,that.stringifyJSON({ctx:u,percent:e.percent,total:i.total,offset:i.offset,time:(new Date).getTime()}))}),logger.debug("bind ChunkUploaded event");var g=qiniuUploadUrls.length,v=function(t){return g-- >0?(setTimeout(function(){that.resetUploadUrl(),t.status=plupload.QUEUED,m.stop(),m.start()},0),!0):(g=qiniuUploadUrls.length,!1)};return m.bind("Error",function(t){return function(e,i){logger.error("Error event activated"),logger.error("err: ",i);var n="",o=i.file;if(o){switch(i.code){case plupload.FAILED:n="上传失败。请稍后再试。";break;case plupload.FILE_SIZE_ERROR:var r=e.getOption&&e.getOption("max_file_size");r=r||e.settings&&e.settings.max_file_size,n="浏览器最大可上传"+r+"。更大文件请使用命令行工具。";break;case plupload.FILE_EXTENSION_ERROR:n="文件验证失败。请稍后重试。";break;case plupload.HTTP_ERROR:if(""===i.response){if(n=i.message||"未知网络错误。",!v(o))return;break}var a=that.parseJSON(i.response),s=a.error;switch(i.status){case 400:n="请求报文格式错误。";break;case 401:n="客户端认证授权失败。请重试或提交反馈。";break;case 405:n="客户端请求错误。请重试或提交反馈。";break;case 579:n="资源上传成功，但回调失败。";break;case 599:if(n="网络连接异常。请重试或提交反馈。",!v(o))return;break;case 614:n="文件已存在。";try{a=that.parseJSON(a.error),s=a.error||"file exists"}catch(l){s=a.error||"file exists"}break;case 631:n="指定空间不存在。";break;case 701:n="上传数据块校验出错。请重试或提交反馈。";break;default:if(n="未知错误。",!v(o))return}n=n+"("+i.status+"："+s+")";break;case plupload.SECURITY_ERROR:n="安全配置错误。请联系网站管理员。";break;case plupload.GENERIC_ERROR:n="上传失败。请稍后再试。";break;case plupload.IO_ERROR:n="上传失败。请稍后再试。";break;case plupload.INIT_ERROR:n="网站配置错误。请联系网站管理员。",m.destroy();break;default:if(n=i.message+i.details,!v(o))return}t&&t(e,i,n)}e.refresh()}}(d)),logger.debug("bind Error event"),m.bind("FileUploaded",function(e){return function(i,n,o){logger.debug("FileUploaded event activated"),logger.debug("file: ",n),logger.debug("info: ",o);var r=function(i,n,o){if(t.downtoken_url){var r=that.createAjax();r.open("POST",t.downtoken_url,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var t;try{t=that.parseJSON(r.responseText)}catch(a){throw"invalid json format"}var s={};plupload.extend(s,that.parseJSON(o),t),e&&e(i,n,that.stringifyJSON(s))}else m.trigger("Error",{status:r.status,response:r.responseText,file:n,code:plupload.HTTP_ERROR})},r.send("key="+that.parseJSON(o).key+"&domain="+t.domain)}else e&&e(i,n,o)},a=that.parseJSON(o.response);if(u=u?u:a.ctx,logger.debug("ctx: ",u),u){var l="";logger.debug("save_key: ",t.save_key),t.save_key||(l=s(i,n,that.key_handler),l=l?"/key/"+that.URLSafeBase64Encode(l):"");var d="/fname/"+that.URLSafeBase64Encode(n.name);logger.debug("op.x_vars: ",t.x_vars);var c=t.x_vars,p="",f="";if(void 0!==c&&"object"==typeof c)for(var h in c)c.hasOwnProperty(h)&&("function"==typeof c[h]?p=that.URLSafeBase64Encode(c[h](i,n)):"object"!=typeof c[h]&&(p=that.URLSafeBase64Encode(c[h])),f+="/x:"+h+"/"+p);var g,v=qiniuUploadUrl+"/mkfile/"+n.size+l+d+f,b=that.detectIEVersion();b&&b<=9?(g=new mOxie.XMLHttpRequest,mOxie.Env.swf_url=t.flash_swf_url):g=that.createAjax(),g.open("POST",v,!0),g.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),g.setRequestHeader("Authorization","UpToken "+that.token);var x=function(){if(logger.debug("ajax.readyState: ",g.readyState),4===g.readyState){localStorage.removeItem(n.name);var t;200===g.status?(t=g.responseText,logger.debug("mkfile is success: ",t),r(i,n,t)):(t={status:g.status,response:g.responseText,file:n,code:-200},logger.debug("mkfile is error: ",t),m.trigger("Error",t))}};b&&b<=9?g.bind("readystatechange",x):g.onreadystatechange=x,g.send(u),logger.debug("mkfile: ",v)}else r(i,n,o.response)}}(c)),logger.debug("bind FileUploaded event"),m.init(),logger.debug("invoke uploader.init()"),logger.debug("init uploader end"),m},this.getUrl=function(t){if(!t)return!1;t=encodeURI(t);var e=this.domain;return"/"!==e.slice(e.length-1)&&(e+="/"),e+t},this.imageView2=function(t,e){var i=t.mode||"",n=t.w||"",o=t.h||"",r=t.q||"",a=t.format||"";if(!i)return!1;if(!n&&!o)return!1;var s="imageView2/"+i;return s+=n?"/w/"+n:"",s+=o?"/h/"+o:"",s+=r?"/q/"+r:"",s+=a?"/format/"+a:"",e&&(s=this.getUrl(e)+"?"+s),s},this.imageMogr2=function(t,e){var i=t["auto-orient"]||"",n=t.thumbnail||"",o=t.strip||"",r=t.gravity||"",a=t.crop||"",s=t.quality||"",l=t.rotate||"",d=t.format||"",c=t.blur||"",u="imageMogr2";return u+=i?"/auto-orient":"",u+=n?"/thumbnail/"+n:"",u+=o?"/strip":"",u+=r?"/gravity/"+r:"",u+=s?"/quality/"+s:"",u+=a?"/crop/"+a:"",u+=l?"/rotate/"+l:"",u+=d?"/format/"+d:"",u+=c?"/blur/"+c:"",e&&(u=this.getUrl(e)+"?"+u),u},this.watermark=function(t,e){var i=t.mode;if(!i)return!1;var n="watermark/"+i;if(1===i){var o=t.image||"";if(!o)return!1;n+=o?"/image/"+this.URLSafeBase64Encode(o):""}else{if(2!==i)return!1;var r=t.text?t.text:"",a=t.font?t.font:"",s=t.fontsize?t.fontsize:"",l=t.fill?t.fill:"";if(!r)return!1;n+=r?"/text/"+this.URLSafeBase64Encode(r):"",n+=a?"/font/"+this.URLSafeBase64Encode(a):"",n+=s?"/fontsize/"+s:"",n+=l?"/fill/"+this.URLSafeBase64Encode(l):""}var d=t.dissolve||"",c=t.gravity||"",u=t.dx||"",p=t.dy||"";return n+=d?"/dissolve/"+d:"",n+=c?"/gravity/"+c:"",n+=u?"/dx/"+u:"",n+=p?"/dy/"+p:"",e&&(n=this.getUrl(e)+"?"+n),n},this.imageInfo=function(t){if(!t)return!1;var e,i=this.getUrl(t)+"?imageInfo",n=this.createAjax(),o=this;return n.open("GET",i,!1),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(e=o.parseJSON(n.responseText))},n.send(),e},this.exif=function(t){if(!t)return!1;var e,i=this.getUrl(t)+"?exif",n=this.createAjax(),o=this;return n.open("GET",i,!1),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(e=o.parseJSON(n.responseText))},n.send(),e},this.get=function(t,e){return!(!e||!t)&&("exif"===t?this.exif(e):"imageInfo"===t&&this.imageInfo(e))},this.pipeline=function(t,e){var i,n,o="[object Array]"===Object.prototype.toString.call(t),r="";if(o){for(var a=0,s=t.length;a<s;a++){if(i=t[a],!i.fop)return!1;switch(i.fop){case"watermark":r+=this.watermark(i)+"|";break;case"imageView2":r+=this.imageView2(i)+"|";break;case"imageMogr2":r+=this.imageMogr2(i)+"|";break;default:n=!0}if(n)return!1}if(e){r=this.getUrl(e)+"?"+r;var l=r.length;"|"===r.slice(l-1)&&(r=r.slice(0,l-1))}return r}return!1}}window.localStorage||(window.localStorage={setItem:function(t,e){createCookie(t,e,30)},getItem:function(t){return readCookie(t)},removeItem:function(t){createCookie(t,"",-1)}});var Qiniu=new QiniuJsSDK;global.Qiniu=Qiniu,global.QiniuJsSDK=QiniuJsSDK}(window),define("web_qui_quiupload_qiniu",function(){}),define("web_qui_quiupload",["plupload","web_qui_quiupload_qiniu"],function(){"use strict";function t(t){this.upopt={browse_button:"",container:"",dragdrop:!1,drop_element:"",max_file_size:"100mb",runtimes:"html5,flash,html4",flash_swf_url:"/qcross/static/models/basic/js/plupload/Moxie.swf",multi_selection:!0,chunk_size:"4mb",max_retries:3,qyer_token_url:"/qcross/www/api.php?action=getAlbumToken",domain:"//pic.qyer.com/",auto_start:!0,token_format:function(t){return t.data.tk=t.data.token,t},init:{FilesAdded:function(t,e){},BeforeUpload:function(t,e){},UploadProgress:function(t,e){},UploadComplete:function(){},FileUploaded:function(t,e,i){},Key:function(t,e){var i,n=[];return n.push(window.QYER.uid),n.push((new Date).getTime()),n.push(parseInt(1e4*Math.random())),i=n.join(""),e.key=i,i},Error:function(t,e,i){var n="";if(e)switch(e.code){case-100:n="Silverlight加载失败";break;case-300:case-400:n="无法打开文件";break;case-600:n="图片必须小于"+t.getOption("max_file_size");break;case-601:n="文件扩展名不正确";break;default:n="未知错误"}t.trigger("UploadError",e,n)}}},this.init(t)}return t.prototype={init:function(t){this.upopt=$.extend(!0,this.upopt,t||{}),this._getUpToken()},_getUpToken:function(){var t=this;$.getJSON(t.upopt.qyer_token_url,function(e){if(0!==e.error_code)throw new Error(e.data);t.upopt.uptoken=e.data.token||e.data.tk,e.data.domain&&t.upopt.domain==e.data.domain,t.uploader=Qiniu.uploader(t.upopt),$(t).trigger("uploadready")})}},t}),define("old/js/senior_tool",["web_old_popup2","old/js/bbs_video","old/js/bbs_attach","old/js/bbs_createalbum","old/js/loading","old/js/bbs_lift","old/js/bbs_emotion","web_old_slidconfirm","web_old_select","css!old/css/tools.css"],function(t,e,i,n,o,r,a,s){function l(t){this.init(t)}function d(t){this.init(t)}function c(t){this.init(t)}function u(t){this.init(t)}function p(t){this.init(t)}function f(t){this.init(t)}function h(t){this.init(t)}var m=(baidu.editor.browser,baidu.editor.utils,function(t,e,i,n){var o=t[0],r=function(t){o.onload=o.onerror=o.onabort=null,t&&t.apply(null,arguments)};o.onload=r(i),o.onerror=o.onabort=r(n),o.src=e}),g=function(t){var e="/photo.php?action=remove";$.post(e,{id:[t]})},v={baseImgUrl:"//static.qyer.com/models/project/bbs/images/",images:[{title:"调整字体样式",url:"edit-1.gif",desc:"选中文字后可进行加粗、调整颜色"},{title:"给选中文字添加超链接",desc:"选中文字后可为其添加或移除超链接",url:"link-2.gif"},{title:"利用标题添加帖子目录",url:"title-3.gif",desc:"选中文字设置标题1或标题2样式后，会自动生成目录电梯。浏览时，可通过目录快速定位至感兴趣的内容"},{title:"通过穷游相册给帖子插入图片",url:"photo-4.gif",desc:"先将旅行照片上传到穷游相册并关联拍摄地点，点击相册中的照片可将照片插入到编辑器的光标处"},{title:"未发布的内容会自动保存草稿",url:"save-5.gif",desc:"亦可点击“保存草稿”来手动保存草稿"},{title:"设置帖子发布信息让帖子更多的穷游er看见",url:"information-6.gif",desc:"可通过设置帖子所属版面和帖子标签让更多穷游er看到你的大作"},{title:"",url:"egg-7.png",desc:""}],body:$("body"),index:0,wrapClass:"pub-threadhelp-wrap",slide:function(){var t=$("."+this.wrapClass);return t.find(".pub-gifwrap").eq(this.index).fadeIn(300).siblings().fadeOut(300),t.find(".x-footer a").eq(this.index).addClass("active").siblings().removeClass("active"),this},bindEvent:function(){var t=this,e=$("."+this.wrapClass);return e.on("click",".xcd i,.x-footer a",function(){this.className.match(/\b(xright)\b/)?t.index=t.index===t.images.length-1?0:t.index+1:this.className.match(/\b(xleft)\b/)?t.index=0===t.index?t.images.length-1:t.index-1:t.index=$(this).index(),t.slide()}),e.find(".x-header a").on("click",function(){e.slideUp(200)}),this},domInit:function(){for(var t,e=$("<div class='"+this.wrapClass+"'><div class='x-header'><a href='javascript:void(0);'></a><p></p></div><div class='x-content'><span class='xcd xfl'><i class='xleft'></i></span><div class='xcimages'></div><span class='xcd xfr'><i class='xright'></i></span></div><div class='x-footer'></div></div>"),i=this.images.length,n=[],o=0;t=this.images[o++];)n.push("<div class='pub-gifwrap'><img src='"+(this.baseImgUrl+t.url)+"' alt=''/><div class='x-pubdesc-wrap'><span class='x-pubnum'>"+o+"</span><div class='x-pubdesc"+o+"'><p class='x-pubdesc-title'>"+t.title+"</p><p class='x-pubdesc-content'>"+t.desc+"</p></div></div></div>");e.find(".xcimages").append(n.join("")).find(".pub-gifwrap").eq(4).css("top","-48px").find(".x-pubnum").css("margin-top","-130px"),e.find(".pub-gifwrap").eq(5).css("top","-60px").find(".x-pubnum").css("margin-top","-108px"),e.find(".pub-gifwrap").eq(6).css("top","30px").find(".x-pubdesc-wrap").css("display","none");for(var r=[],a=e.find(".x-footer"),o=i;o--;)r.push("<a href='javascript:void(0);'></a>");return a.append(r.join("")),this.body.append(e),this},init:function(){return this.domInit().bindEvent().slide(),$("."+this.wrapClass)}},b=v.init().hide();return l.prototype={dom:null,status:"",domain:null,init:function(t){$.extend(this,t)},getHtml:function(){return'<li><img width="100" height="100" alt="" onerror="javascript:this.src=\'//static.qyer.com/images/place/no/poi_150_150.jpg\'"/><div class="loading"><span><em style="width:0%;"></em></span></div><div class="delete" title="删除">删除</div><div class="rotate"><span class="left" title="向左旋转">向左旋转</span><span class="right" title="向右旋转">向右旋转</span></div></li>'},bindEvent:function(){var t=this;this.dom.on("mouseenter mouseleave",function(e){"complete"==t.status&&("mouseenter"==e.type?t.dom.find(".delete").show():t.dom.find(".delete").hide())}),this.dom.on("click",".delete",function(){t.dom.remove(),$(t).trigger("filedestroy")})},setRotate:function(t){this.dom.find(".loading em").css({width:parseInt(.8*t)+"%"})},setStatus:function(t){switch(this.status=t,this.status){case"loading":break;case"error":break;case"complete":var e=this.url,i=e+"/120",n=this,o=n.dom.find("img");n.dom.find(".delete"),n.dom.find(".loading");m(o,i,function(){setTimeout(function(){n.dom.find(".loading").hide(),n.dom.find(".delete").hide(),n.dom.find("img").attr({"data-src":e})},200)})}},getDom:function(){return this.dom?this.dom:(this.dom=$(this.getHtml()),this.bindEvent(),this.dom)}},d.prototype={opt:{contentHTML:'<div class="qyEdit_append_pic clearfix"><div class="qyEdit_append_title clearfix"><strong class="text fontYaHei">上传图片到相册</strong><a href="javascript:;" class="minimize hvr"><em class="tip">最小化</em></a></div><div class="qyEdit_append_wrap"><div class="qyEdit_append_list clearfix"><ul></ul></div></div><div class="qyEdit_append_button clearfix"><p class="tips">已上传：<span class="num"></span>张</p><div class="cancel"><a href="javascript:;" class="btn btn_upload_cancel ui_button_cancel">取消上传</a></div><div class="complete" style="display: none;"><div class="fr button"><a href="javascript:;" class="btn btn_upload_complete ui_button">完成</a></div><div class="checkBox clearfix"><label class="clearfix"><input class="cbox" name="checkbox" type="checkbox"><p>关联目的地</p></label></div></div></div></div>',exClassName:"editor_uploadImage",width:622},editor:null,fileMap:{},curnum:0,init:function(e){return $.extend(this,e||{}),this.popup=new t($.extend(e,this.opt)),this.dom=this.popup.ui.$content.find(".qyEdit_append_pic"),this.MinimizeBar=new f,this.minimizeTipShow(),this},bindEvent:function(){var t=this;this.dom.off("click input"),this.dom.on("click",".close,.btn_upload_cancel",function(e){var i=this,n="您还有 "+t.leftCount()+"张图片正在上传中。";t.isComplete()?t.hide():s.confirm({down:!0,text:n,target:i,onOK:function(){for(var e in t.fileMap)$(t.fileMap[e]).trigger("filedestroy");t.hide()}})}),this.dom.on("click",".minimize",function(){t.popup.ui.$box.animate({top:30,opacity:0},200,function(){t.popup.ui.$ui.hide()}),t.MinimizeBar.show()}),$(t.MinimizeBar).on("reduction",function(){t.popup.ui.$ui.show(),t.popup.ui.$box.animate({top:0,opacity:1},200)}),this.dom.on("click",".btn_upload_complete",function(){var e,i,n=$(this);n.hasClass("ui_button")&&(t.hide(),e=t.dom.find(".cbox"),t.isComplete()&&e.prop("checked")===!0&&(i=_.map(t.fileMap,function(t,e){return{id:t.photo_id,key:t.key,src:t.url}}),$(t).trigger("showconcatpoi",i)))}),this.dom.on("click",".minimize_tip > em",function(){t.minimizeTipClose()})},minimizeTipShow:function(){if(localStorage&&null==localStorage.getItem("popup_minimize_tip")){var t='<span class="minimize_tip">点击最小化，边传图边写帖子吧~<em>&times;</em></span>';this.dom.find(".qyEdit_append_title").append(t).find(".minimize").removeClass("hvr")}},minimizeTipClose:function(){this.dom.find(".minimize").addClass("hvr").end().find(".minimize_tip").remove(),localStorage&&localStorage.setItem("popup_minimize_tip","1")},totalCount:function(){return _.size(this.fileMap)},doneCount:function(){return _.size(_.filter(_.pluck(this.fileMap,"status"),function(t){
return"complete"===t}))},leftCount:function(){return this.totalCount()-this.doneCount()},isComplete:function(){return this.doneCount()===this.totalCount()},getAllNum:function(){var t=0;this.curnum=0;for(var e in this.fileMap)this.fileMap[e]&&("complete"==this.fileMap[e].status&&(this.curnum+=1),t++);return this.allnum=t,this.curnum+"/"+t},getFileForId:function(t){return this.fileMap[t]},setFileRotate:function(t,e){var i=this.getFileForId(t);i&&i.setRotate(e)},setFileStatus:function(t,e){var i=this.getFileForId(t.id);i&&($.extend(i,t),i.setStatus(e),this.curnum++,this.setUpNum())},setFileError:function(t,e){requirejs(["web_old_tip"],function(t){t.tip({text:e,type:"error"})})},setUploadComplete:function(){this.dom.find(".complete").show().end().find(".cancel").hide(),this.MinimizeBar.uploadComplete()},bindFileEvent:function(t){var e=this;$(t).on("filedestroy",function(){delete e.fileMap[this.id],$(e).trigger("removeupfile",this.id),g(this.photo_id),e.setUpNum(),void 0!=typeof e.allnum&&0==e.allnum&&(e.popup.hide(!0),$(".uploadPanel").hide())})},loadFiles:function(t,e){var i;this.curnum=0,this.fileMap={};for(var n,o=0;n=e[o++];)i=new l(n),i.domain=t,this.bindFileEvent(i),this.fileMap[n.id]=i;this.renderFiles()},renderFiles:function(){this.dom.find(".qyEdit_append_list ul").html("");for(var t in this.fileMap)this.dom.find(".qyEdit_append_list ul").append(this.fileMap[t].getDom())},setUpNum:function(){var t=this.getAllNum();this.dom.find(".tips .num").html(t),this.MinimizeBar.uploadProgress(this.curnum,this.totalCount())},uploadProgress:function(t){this.setFileRotate(t.id,t.percent)},show:function(){this.dom.find(".cbox").get("0").checked=!0,this.popup.show(),this.bindEvent()},hide:function(){this.popup.hide(!0),$(this).trigger("savealbumphoto")}},c.prototype={dom:null,domain:null,init:function(t){$.extend(this,t)},getHtml:function(){var t="string"==typeof this.url?this.url.replace("300x300",""):"";return'<li data-pid="'+this.id+'"><div class="x-ischecked unchecked" data-pid="'+this.id+'"></div><img width="100" height="100" alt="" src="'+t+'/120" onerror="javascript:this.src=\'//static.qyer.com/images/place/no/poi_150_150.jpg\'"><span class="status"></span><span class="place"><span style="position:relative;"><strong>'+(this.description||"")+'</strong><span class="con-des"></span></span></span></li>'},bindEvent:function(){var t=this;this.dom.on("click",function(e){var i=e||window.event;$(i.tareget||i.srcElement);t.dom.find(".x-ischecked").toggleClass("checked").toggleClass("unchecked"),t.dom.find(".status").toggle(),$(t).trigger("imgclick")}),this.dom.on("mouseenter",function(){!t.dom.find(".hasChecked").hasClass("checked")&&t.dom.find(".hasChecked").addClass("unchecked")}).on("mouseleave",function(){t.dom.find(".hasChecked").removeClass("unchecked")})},getDom:function(){return this.dom?this.dom:(this.dom=$(this.getHtml()),this.bindEvent(),this.dom)}},u.prototype={opt:{contentHTML:'<div class="qyEdit_append_pic clearfix"><div class="qyEdit_append_title clearfix"><strong class="text fontYaHei">关联目的地</strong><span class="x-contact-tips">点击选中要关联的图片</span><p class="place" id="contactPlaceCon"><i class="x-ao-dest x-ao-pos1"></i><input type="text" placeholder="添加目的地" value="" class="x-ui-input" /><span class="tText" style="display:none"><em class="x-ao-dest x-ao-pos2"></em>目的地名称须在20汉字以内</span></p><a href="javascript:;" title="关闭" class="close"></a></div><div class="qyEdit_append_wrap"><div class="qyEdit_append_list clearfix"><ul></ul></div></div><div class="qyEdit_append_button clearfix"><div class="fr button"><a href="javascript:;" class="ui_button">完成</a></div><div class="x-btl-wrap"><input type="checkbox" id="checkedXAll"/><label for="checkedXAll">全选</label>已关联至:&nbsp;&nbsp;<span id="checkedXNum">0</span>/<span id="allPhotoListLen"></span></div></div></div>',exClassName:"editor_concatpoi",width:622},photoList:[],allcount:0,init:function(e){return $.extend(this,e||{}),this.popup=new t($.extend(e,this.opt)),this.dom=this.popup.ui.$content.find(".qyEdit_append_pic"),this},disabledFlag:!0,bindEvent:function(t){var e=this;this.dom.off("click"),requirejs(["web_old_inputautocomplete"],function(){e.dom.find(".x-ui-input").qyerAutocomplete({parent:$(".place"),onSearch:function(){var t=$(this).val();$.ajax({url:BBS_Url.searchphotopoi,type:"post",data:{keyword:t},success:function(i){var n,o,r=JSON.parse(i),a=r.data,s=[];if(a&&a.length>0){o=new RegExp(t,"ig"),s.push('<ul class="qui-inputAutocomplete-ul">');for(var l,d=0;l=a[d++];)n='<li data-pid="'+l.id+'" data-placetype="'+l.place_type+'" data-allname="'+l.cn_name+"&nbsp;&nbsp;"+l.last+'"><span class="poiname">'+l.cn_name.replace(o,'<a class="kw">'+t+"</a>")+'</span><span class="poiname">'+l.en_name.replace(o,'<a class="kw">'+t+"</a>")+'</span><span class="country">'+l.last+"</span></li>",s.push(n);s.push("</ul>"),e.dom.find(".x-ui-input").qyerAutocomplete("pushHTML",s.join(""))}else e.dom.find(".x-ui-input").qyerAutocomplete("pushHTML","")}})},onSelect:function(t){var i=$(t).attr("data-pid");e.pid=i,e.disabledFlag=!1;var n=$(".qyEdit_append_list .checked");$.each(n,function(i,n){$(n).removeClass("checked").removeClass("unchecked").addClass("hasChecked").attr("data-placeid",$(t).attr("data-pid")).attr("data-placetype",$(t).attr("data-placetype")).attr("title",$(t).attr("data-allname")).parent().find(".con-des").empty().html($(t).attr("data-allname")).parent().parent().fadeIn(),$(".x-ui-input").val("").blur(),e.selectedUpdateNum(),e.placeShow(),$("#checkedXAll")[0].checked=!1})}})}),this.dom.on("focus",".x-ui-input",function(){$(this).removeAttr("readonly").val("")}).on("blur",".x-ui-input",function(){$(this).attr("readonly","readonly"),e.disabledFlag?this.value="":e.disabledFlag=!0}),this.dom.on("click",".close",function(t){e.hide()}),this.dom.on("click",".ui_button_cancel",function(t){e.hide()}),this.dom.on("click",".ui_button",function(){var t=e.dom.find("[data-placeid]"),i=[];$.each(t,function(t,e){var n=$(e);i[t]={photoid:n.attr("data-pid"),type:n.attr("data-placetype"),placeid:n.attr("data-placeid")}}),i.length?$.ajax({url:BBS_Url.editPhotoPlace,type:"post",data:{photo:i},success:function(t){var i=JSON.parse(t);0==i.error_code?e.hide():requirejs(["web_old_tip"],function(t){t.tip({text:i.data.msg,type:"error"})})}}):e.hide()}),e.checkedXAll()},bindFileEvent:function(t){var e=this;$(t).on("imgclick",function(){e.togglePoi()})},getPhotos:function(t){var e=this,i=[];e.photoList=[];for(var n=0;n<t.length;n++)i.push(t[n].id);$.ajax({url:BBS_Url.getNewPhoto,data:{photoids:i.join(",")},success:function(t){var i,n=JSON.parse(t);if(0==n.error_code){e.allcount=n.data.count;for(var o,r=0;o=n.data.res[r++];)i=new c(o),e.bindFileEvent(i),e.photoList.push(i);e.renderHtml()}}})},getSelPohots:function(){var t=[],e=[];return this.dom.find("li").each(function(i,n){var o=$(n);o.find(".x-ischecked").hasClass("hasChecked")&&(t.push(o.attr("data-pid")),e.push(o.attr("data-xpid")))}),{phids:t.join(","),plids:e.join(",")}},togglePoi:function(){this.selectedUpdateNum(),this.placeShow()},placeShow:function(){$(".qyEdit_append_list .checked").length?$(".x-contact-tips").css("display","none").next().fadeIn(300):$(".x-contact-tips").fadeIn(300).next().css("display","none")},selectedUpdateNum:function(){$("#checkedXNum").html($(".qyEdit_append_list").find(".x-ischecked.hasChecked").length)},checkedXAll:function(){var t=$(".x-btl-wrap"),e=this;$("#checkedXAll").on("click",function(){var i=$(".qyEdit_append_list").find(".x-ischecked");t.find(":checked").length?i.addClass("checked").removeClass("unchecked"):(i.removeClass("checked"),!i.hasClass("hasChecked")&&i.addClass("unchecked")),e.selectedUpdateNum(),e.placeShow()})},renderHtml:function(){var t=this.dom.find(".qyEdit_append_list ul");t.html("");for(var e,i=0;e=this.photoList[i++];)t.append(e.getDom());$("#allPhotoListLen").html(this.photoList.length)},reset:function(){this.dom.find(".x-ui-input").val("");var t=this.dom.find(".qyEdit_append_list ul");t.html("")},show:function(){this.reset(),this.popup.show(),this.bindEvent()},hide:function(){this.popup.hide(!0)}},p.prototype={editor:null,dom:null,parms:{type:"json",page:1,size:20},defOpt:{showTitle:!1,showCancelBtn:!1,showOKBtn:!1,showCloseIcon:!1},editorui:baidu.editor.ui,init:function(t){$.extend(this,t||{})},getHtml:function(){return'<div class="image_cont clearfix"><div class="qui-select" id="photolist"   data-ui-width="133" ><strong class="titles" ><span class="title-text">相册加载中...</span></strong><div style="display: none;" class="contents"></div></div><div class="buttons" id="addPhotoWrap"><span class="uploadPanel"></span><a href="javascript:;" class="ui_button" id="addPhoto"><span class="add"></span>添加图片到本相册</a></div><div class="lists" style="max-height:'+this.getMaxHeight()+'px"><ul class="clearfix"></ul></div><div class="scrollTip"></div></div>'},getMaxHeight:function(){var t=$(".tool_right").length?$(".tool_right"):$(".senior_dlg_tools"),e=0,i=$(window).height();return e="absolute"===t.css("position")?i-(((t.offset()||{}).top||0)+60+100):i-(+t.css("top").replace("px","")+60+100)},getPhotoList:function(){var t=this;0==this.Load.status&&this.Load.render(this.dom.find(".lists")),this.Load.show(),$.ajax({url:BBS_Url.getMyAlbumList,method:"post",success:function(e){var e=JSON.parse(e);if(0==e.error_code){for(var i,n=e.data||[],o=[],r=0;r<n.length;r++)i=n[r],0==r&&(t.dom.find("#photolist").find(".title-text").text(i.name),t.parms.album=i.id,t.loadPhotos()),o.push('<li data-value="'+i.id+'"><a href="javascript:;">'+$("<div/>").html(i.name).text()+"</a></li>");o.push('<li data-value="-1"><a href="javascript:;" style="color:#02b052">+<span style="margin-left:3px;">创建新相册<span></a></li>'),t.dom.find("#photolist").find(".contents").html("<ul>"+o.join("")+"</ul>")}else t.dom.find("#photolist").find(".title-text").text("相册加载失败")}})},loadNext:function(){this.parms.page=this.parms.page+1,this.loadPhotos(!0)},loadPhotos:function(t){var e=this,i=t||!1;e.parms.timer=(new Date).getTime(),$.ajax({url:BBS_Url.getAlbumPhotoPage,method:"get",data:e.parms,success:function(t){if(t=JSON.parse(t),0==t.error_code){var n=t.data.res||[],o=[];if(e.Load.hide(),i===!1){e.dom.find(".lists ul").html("");for(var r=0;r<t.data.count-0;r++){n&&"undefined"==typeof n[r]&&(n[r]={url:"",id:""});var a="string"==typeof n[r].url?n[r].url.replace("300x300",""):"";o.push('<li data-src="'+a+'" data-pid="'+n[r].id+'" '+(n[r].size?'data-size="'+n[r].size+'"':"")+'><img title="点击图片插入到编辑器中" src="'+(a?a+"/120x120":"")+'" onerror="javascript:this.src=\'//static.qyer.com/images/place/no/poi_150_150.jpg\'" width="100" height="100" alt="" /></li>')}$(o.join("")).prependTo(e.dom.find(".lists ul"))}else{var s=e.dom.find(".lists ul li");n=n.reverse();var l=0,d=0;e.parms.page>s.length/e.parms.size?(l=s.length-1,d=s.length%e.parms.size):(l=e.parms.page*e.parms.size-1,d=e.parms.size);for(var r=l,c=0;(r>e.parms.size,c<d)&&s[r];r--,c++)n[c]&&n[c].size&&$(s[r]).attr("data-size",n[c].size),$(s[r]).attr("data-src",n[c].url).attr("data-pid",n[c].id),$(s[r]).find("img").attr("src",n[c].url+"/120x120")}e.parms.page<t.data.count/e.parms.size&&e.loadNext()}}})},bindEvent:function(){var t=this;t.editor.upImage={},requirejs(["web_qui_quiupload"],function(e){var i=[],n={},o="/photo.php?action=getUploadPhotoId&count=<%= count %>&album_id=<%= album_id %>",r=function(t){var e=n[t.id]||{};return e},a=function(t,e){var n=_.template(o)({count:t,album_id:e});return $.getJSON(n).then(function(t){return i=t.data})};t.upload=new e({browse_button:"addPhoto",container:"addPhotoWrap",filters:[{extensions:"jpg,jpeg,png"}],max_file_size:"20mb",multi_selection:!0,auto_start:!1,qyer_token_url:"/photo.php?action=token",token_format:function(t){return t.data.tk=t.data.token,t.data.domain="//pic.qyer.com",t},x_vars:{photo_id:function(t,e){return r(e).id.toString()},credit_jy:function(t,e){return((r(e).credit||{}).credit_jy||0).toString()},credit_qb:function(t,e){return((r(e).credit||{}).credit_qb||0).toString()},style:function(t,e){return"120x120"}},init:{FilesAdded:function(e,i){t.UploadImageDlg.dom.find(".qyEdit_append_list ul").html("<li style='font-size:14px'>图片加载中...</li>"),t.UploadImageDlg.show(),t.UploadImageDlg.albumid=t.parms.album,t.UploadImageDlg.MinimizeBar.uploadReady(),t.dom.find(".uploadPanel").show(),a(i.length,t.parms.album).then(function(o){_.each(o,function(t,e){n[i[e].id]=t,i[e].key=t.key,i[e].photo_id=t.id,i[e].url=t.url}),t.UploadImageDlg.dom.find(".qyEdit_append_list ul").html(""),t.UploadImageDlg.dom.find(".complete").hide(),t.UploadImageDlg.dom.find(".cancel").show(),t.UploadImageDlg.loadFiles(e.getOption("domain"),i)}).then(function(){t.UploadImageDlg.setUpNum(),e.start()})},BeforeUpload:function(t,e){e.timer=+new Date;var i={source:"bbs",label:"photoUploadStart",uid:window.QYER.uid,fileId:e.photo_id,fileSize:e.origSize,url:encodeURIComponent(e.url),time:e.timer,uploadTime:0};$.get("/qcross/photo/trace/tc",i)},UploadComplete:function(){t.UploadImageDlg&&t.UploadImageDlg.setUploadComplete()},UploadProgress:function(e,i){t.UploadImageDlg&&t.UploadImageDlg.setFileRotate(i.id,i.percent)},FileUploaded:function(e,i,n){t.UploadImageDlg&&t.UploadImageDlg.setFileStatus(i,"complete");var o={source:"bbs",label:"photoUploadEnd",uid:window.QYER.uid,fileId:i.photo_id,fileSize:i.origSize,url:encodeURIComponent(i.url),time:+new Date,uploadTime:new Date-i.timer};$.get("/qcross/photo/trace/tc",o)},Error:function(e,i,n){t.UploadImageDlg&&t.UploadImageDlg.setFileError(i,n)},Key:function(t,e){return r(e).key}}})}),$(t.UploadImageDlg).on("showconcatpoi",function(e){t.ConcatPoi.show();for(var i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);t.ConcatPoi.getPhotos(i)}),$(this.UploadImageDlg).on("savealbumphoto",function(){t.parms.page=1,t.loadPhotos(),t.dom.find(".uploadPanel").hide()});var e=88,i=t.dom.find(".scrollTip");t.dom.find(".lists").on("scroll",function(){var n=$(this).scrollTop(),o=(t.parms.size/2*e*t.parms.page,parseInt(n/880));t.timer&&clearTimeout(t.timer),i.html(o*t.parms.size+1+"-"+(o+1)*t.parms.size),i.show(),t.timer=setTimeout(function(){i.hide()},3e3)}),$(window).on("scroll",function(){t.dom.find(".lists").css("max-height",t.getMaxHeight())})},bindImgEvent:function(){var t=this;t.dom.find("#photolist").data("_qyerSelect",null),t.dom.find("#photolist").qyerSelect({onBeforeChange:function(e){var i=$(e).attr("data-value");return"-1"==i?(t.createDialog||(t.createDialog=new n(t.defOpt),$(t.createDialog).on("createalbumsuccess",function(e){t.reset()})),t.createDialog.show(),!1):(t.parms.album=i,t.parms.page=1,t.loadPhotos(),void 0)}}),t.dom.on("click",".lists li",function(){var e=$(this),i=e.attr("data-size"),n=e.attr("data-pid"),o="/680x";return i&&(i=i.split(","),i.shift()<680&&(o="")),n?(t.editor.execCommand("insertimage",{src:e.attr("data-src")+o,_src:e.attr("data-src"),floatStyle:"left",id:n}),void $(document).trigger("x-editDomInsert")):void requirejs(["web_old_tip"],function(t){t.tip({text:"图片还未加载完成,请稍后在操作",type:"error"})})})},reset:function(){this.getPhotoList(),this.loadPhotos()},getDom:function(){var t=this;return this.dom||(this.dom=$(this.getHtml()),this.Load=new o,this.UploadImageDlg=new d(this.defOpt),$(this.UploadImageDlg).on("removeupfile",function(e,i){t.upload.uploader.removeFile(i)}),this.ConcatPoi=new u(this.defOpt),this.getPhotoList(),this.bindEvent()),this.bindImgEvent(),this.dom}},f.prototype={dom:null,init:function(t){$.extend(this,t),$("body").append(this.getDom()),this.bindEvent()},getDom:function(){return this.dom||(this.dom=$(this.getHtml())),this.dom},getHtml:function(){return'<div class="fixed_minimizebar"><div class="wrap"><p class="text">图片加载中...</p><a class="back btn-reduction" href="javascript:;"></a></div><span class="progress"></span></div>'},show:function(){$("body").css("padding-bottom",50),this.dom.fadeIn(300)},hide:function(){$("body").css("padding-bottom",0),this.dom.fadeOut(300)},bindEvent:function(){var t=this;this.dom.on("click",".btn-reduction",function(){t.hide(),$(t).trigger("reduction")})},uploadReady:function(){this.dom.removeClass("complete").hide().find(".text").html("图片加载中...").end().find(".progress").show().css({width:0})},uploadProgress:function(t,e){if(t>=e)this.uploadComplete();else{var i=[t,e].join("/");this.dom.find(".text").html('图片上传中：<em class="num">'+i+"</em>"),this.dom.find(".progress").css({width:t/e*100+"%"})}},uploadComplete:function(){this.dom.addClass("complete").find(".text").html("上传完成，请查看").end().find(".progress").hide()}},h.prototype={models:{},openModel:null,selClass:"selected",editor:null,editorui:baidu.editor.ui,target:"",defOpt:{showTitle:!1,showCancelBtn:!1,showOKBtn:!1,showCloseIcon:!1},init:function(t){$.extend(this,t),this.models.emotion=new a,this.models.lift=new r,this.models.image=new p,this.models.video=new e(this.defOpt),this.models.attach=new i(this.defOpt);for(var n in this.models)this.models[n].editor=this.editor;this.dom=$(this.target),this.render(),this.bindEvent()},bindEvent:function(){var t=this;this.tools.on("click",".tools-inner-wrap",function(){var e=$(this).attr("data-mode");switch(e){case"emotion":case"lift":case"image":t.selectTool(this),t.content.html(""),t.content.append(t.models[e].getDom(t.content));break;case"video":case"attach":t.models[e].editor=t.editor,t.models[e].show();break;case"help":b.slideToggle()}return!1}),this.isShowLift&&t.tools.find("[data-mode=lift]").trigger("click"),setInterval(function(){t.models.lift.reload()},6e4),$(this.models.lift).on("scrollview",function(e,i){var n=t.editor.document.getElementById(i);n&&domUtils.scrollToView(n,t.editor.window,50)})},getHtml:function(){return'<div class="tools clearfix"><div class="tools-inner-wrap" data-mode="lift"><span class="lift"><i></i></span><div class="x-tool-wrap"><div class="x-tool-left"></div><div class="x-tool-xtm">帖子电梯</div><div class="x-tool-right"></div></div></div><div class="tools-inner-wrap" data-mode="emotion"><span class="faces"><i></i></span><div class="x-tool-wrap"><div class="x-tool-left"></div><div class="x-tool-xtm">插入表情</div><div class="x-tool-right"></div></div></div><div class="tools-inner-wrap" data-mode="image"><span class="insertimage"><i></i></span><div class="x-tool-wrap"><div class="x-tool-left"></div><div class="x-tool-xtm">插入图片</div><div class="x-tool-right"></div></div></div><div class="tools-inner-wrap" data-mode="video"><span class="insertvideo"></span><div class="x-tool-wrap"><div class="x-tool-left"></div><div class="x-tool-xtm">插入视频</div><div class="x-tool-right"></div></div></div><div class="tools-inner-wrap" data-mode="attach"><span class="insertattach"></span><div class="x-tool-wrap"><div class="x-tool-left"></div><div class="x-tool-xtm">插入附件</div><div class="x-tool-right"></div></div></div><div class="tools-inner-wrap" data-mode="help"><span class="help"></span><div class="x-tool-wrap"><div class="x-tool-left"></div><div class="x-tool-xtm">发帖帮助</div><div class="x-tool-right"></div></div></div></div><div class="tool_content"></div>'},selectTool:function(t){this.tools.find(".tools-inner-wrap").removeClass(this.selClass),$(t).addClass(this.selClass)},render:function(){this.dom.html(this.getHtml()),this.tools=this.dom.find(".tools"),this.content=this.dom.find(".tool_content")}},h}),define("old/js/bbs_title",[],function(){({init:function(){this.dom=$(".title"),this.ipt=this.dom.find("textarea"),this.tip=this.dom.find(".info"),this.tempTad=$(".template-textarea"),this.placeholderspan=$(".thread-title-placeholder"),this.tempTad.width(this.ipt.width()),this.bindEvent()},setTipError:function(t){1==t?this.tip.show():this.tip.hide()},bindEvent:function(){var t=this;t.placeholderspan.on("click",function(){t.ipt.focus()}),this.ipt.on("blur",function(){var e=this.value;return 0==e.length?void t.placeholderspan.css("display","block"):e.length>60?void t.setTipError(!0):void 0}).on("keydown",function(e){var i=e.which||e.keyCode||e.charCode;if(t.placeholderspan.css("display","none"),13===i)return e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1}).on("keyup",function(e){var i=(e.which||e.keyCode||e.charCode,this.value);!$.trim(i)&&t.placeholderspan.css("display","block"),i.length>60?t.setTipError(!0):t.setTipError(!1),t.tempTad.html(i),$(this).height(t.tempTad.height()||"40")})}}).init(),$.trim($("#threadTitle").val())&&$(".thread-title-placeholder").css("display","none")}),define("assets/issue/components",["assets/issue/constant"],function(t){var e=function(){},i=t.uid?'<a class="lookmore" href="//www.qyer.com/u/'+t.uid+'/travel#draft" target="_blank">查看全部草稿</a>':"",n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.exClassName,o=void 0===n?"x-draft-popup":n,r=t.title,a=void 0===r?"你有一份草稿"+i:r,s=t.name,l=void 0===s?"":s,d=t.date,c=void 0===d?"":d,u=t.okText,p=void 0===u?"继续写草稿":u,f=t.width,h=void 0===f?"478":f,m=t.cancelText,g=void 0===m?"删除草稿写新帖":m,v=t.showCloseIcon,b=void 0!==v&&v,x=t.contentSubstr,_=void 0===x?"":x,y=t.contentHTML,w=void 0===y?"<h3 class='x-draftp-title'>["+l+"]"+c+"</h3><p class='x-draftp-content'>"+_+"</p>":y,E=t.onBeforeHide,k=void 0===E?e:E,T=t.onOK,q=void 0===T?e:T,S=t.onCancel,R=void 0===S?e:S;requirejs(["web_old_popup"],function(t){t.show({exClassName:o,title:a,name:l,date:c,okText:p,width:h,cancelText:g,showCloseIcon:b,contentHTML:w,onBeforeHide:k,onOK:q,onCancel:R})})},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.title,n=void 0===i?"确认删除":i,o=t.text,r=void 0===o?"确定要永久删除这份草稿吗？":o,a=t.exClassName,s=void 0===a?"x-draft-confirm":a,l=t.okText,d=void 0===l?"确认删除":l,c=t.onOK,u=void 0===c?e:c,p=t.onCancel,f=void 0===p?e:p;requirejs(["web_old_confirm"],function(t){t.confirm({title:n,text:r,exClassName:s,okText:d,onOK:u,onCancel:f})})},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.text,i=void 0===e?"请登录":e,n=t.type,o=void 0===n?"warning":n,r=t.timer,a=void 0===r?2e3:r;require(["web_old_tip"],function(t){t.tip({text:i,type:o,timer:a})})},a=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.parent,o=i.onSearch,r=void 0===o?e:o,a=i.onSelect,s=void 0===a?e:a;requirejs(["web_old_inputautocomplete"],function(){t.qyerAutocomplete({parent:n,onSearch:r,onSelect:s})})},s=function(){var t=$.Deferred();return requirejs(["common/models/common/component/planItinerary/dataAPI"],function(e){t.resolve(e)}),t.promise()},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{disableCell:{traffic:!0}},e=t.action,i=void 0===e?"guidance":e,n=t.topicType,o=t.disableCell,r=t.tid,a=t.planid,s=$.Deferred();return requirejs(["common/models/common/component/planItinerary/index"],function(t){var e={action:i,topicType:n,disableCell:o};r&&(e.tid=r),a&&(e.planid=a),t.init(e),s.resolve()}),s.promise()},d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.text,i=void 0===e?"正在发布中，请稍候...":e,n=$.Deferred();return requirejs(["web_old_loading"],function(t){t.show({text:i}),n.resolve(t)}),n.promise()},c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".tool_right",i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=$.Deferred();return t?requirejs(["old/js/senior_tool"],function(o){return n.resolve(new o({target:e,editor:t,isShowLift:i}))}):n.reject(),n.promise()},u=function(){requirejs(["old/js/bbs_title"])};return{loadPopup:n,loadConfirm:o,loadTip:r,loadSearch:a,Plan:s,loadPlan:l,loading:d,loadToolContent:c,loadTitle:u}}),define("assets/issue/util",[],function(){var t=function(){return(new Date).getTime()},e=function(t){return t.replace(/<\/?[^>]*>/g,"").replace(/[ | ]*\n/g,"\n").replace(/\n[\s| | ]*\r/g,"\n").replace(/&nbsp;/gi,"")},i=function(t,e){return function(){for(var i=arguments.length,n=Array(i),o=0;o<i;o++)n[o]=arguments[o];return t.apply(e,n)}},n=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event,i="visible",n="hidden",o={focus:i,focusin:i,focusout:n,pageshow:i,pagehide:n};t.type in o?document.body.className=o[t.type]:document.body.className=this[e]?"hidden":"visible",~document.body.className.indexOf("hidden")?$(document).trigger("winunactived"):$(document).trigger("winactived")}var e="hidden";e in document?document.addEventListener("visibilitychange",t):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",t):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",t):(e="msHidden")in document?document.addEventListener("msvisibilitychange",t):"onfocusin"in document?document.onfocusin=document.onfocusout=t:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=t},o=function(t){var e="";"number"==typeof+t&&(t=new Date((+t)));var i=function(t){return t>9?t:"0"+t};if("[object Date]"===Object.prototype.toString.call(t)){var n=t.getMonth()+1,o=t.getDate(),r=t.getHours(),a=t.getMinutes();e=t.getFullYear()+"-"+i(n)+"-"+i(o)+" "+i(r)+":"+i(a)}return e},r=function(t,e,i){var n=i,o=0;for(null==n&&(n=t[0],o=1);o<t.length;o++)n=e(n,t[o],o);return n},a=function(t,e){return r(t,function(t,i,n){return t.push(e(i,n)),t},[])},s=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return!0;return!1},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"name",e=arguments[1],i=[],n={},o=!0,r=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var d=s.value;n[d[t]]||(i.push(d),n[d[t]]=!0)}}catch(c){r=!0,a=c}finally{try{!o&&l["return"]&&l["return"]()}finally{if(r)throw a}}return i},d=function(t){if("function"==typeof Set)return[].concat(_toConsumableArray(new Set(t)));var e={},i=[],n=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value;e[l]||(i.push(l),e[l]=!0)}}catch(d){o=!0,r=d}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw r}}return i};return{now:t,removeHtmlTag:e,bind:i,windowActive:n,dateParse:o,reduce:r,map:a,includes:s,distinctJson:l,distinctAry:d}});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();define("assets/issue/draft/draft",["assets/issue/components","assets/issue/util"],function(t,e){var i=function(){function i(){_classCallCheck(this,i),this.isSaveProcess=!1,this.hasDraftUnsave=!1,this.loadDraftTime=0,this.loadDraftCount=3,this.token="",this.ue=null,this.saveDraftStatus="保存中",this.beforeunloadstart=!1}return _createClass(i,[{key:"writeContent",value:function(t){var e=this;if(this.ue){this.ue.setOpt("isSubmit",!1),$(".editHolder").hide(),this.ue.setContent(t);var i=setTimeout(function(){e.ue.fireEvent("contentChange"),clearTimeout(i)},500)}}},{key:"resumeEditDraft",value:function(t){var e=t&&$("<div/>").html(t.subject).text();i.loadTitle(e,$(".thread-title-placeholder"),$("#threadTitle"),$(".template-textarea")),t.plan_id&&i.loadPlan(t.plan_id),i.loadTag(t.tag),$.trim(t.content)&&this.writeContent(t.content),i.updateLift()}},{key:"getDraft",value:function(){return(new $.Deferred).promise()}},{key:"read",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.okText,n=void 0===e?"继续写草稿":e,o=t.cancelText,r=void 0===o?"删除草稿写新帖":o,a=t.count,s=void 0===a?3:a,l=t.statusDom,d=void 0===l?$(".qy_issue_mask .text"):l,c=t.deleteHandler,u=void 0===c?function(){}:c;this.loadDraftCount=s,this.statusDom=d,i.loadDraft(n,r,u,d,this)}},{key:"saveDraft",value:function(t){return $.Deferred().promise()}},{key:"save",value:function(n){var o=this,r=$.Deferred(),a=!1,s=function(t,e){o.saveDraftStatus=t,o.hasDraftUnsave=!!e,n.html(o.saveDraftStatus),a?o.clearDraftTimer():o.saveDraftTimer(n),o.isSaveProcess=!1};if(!this.ue||!this.ue.getContent()){var l=this.ue?"帖子还没有内容哟，请您书写帖子吧":"编辑器未加载完成";return s(l),r.reject(l),r.promise()}return this.saveDraftStatus="保存中",n.html(this.saveDraftStatus),this.isSaveProcess?r.reject():(this.isSaveProcess=!0,this.saveDraft().done(function(n){var l=$.parseJSON(n),d="",c=!0;if("ok"===l.result)r.resolve(),c=!1,d="保存成功",o.toolContent&&o.toolContent.models.lift.reload(),l.data&&l.data.token&&(o.token=l.data.token),o.saveLastTime=e.dateParse(new Date);else if(d="保存失败",r.reject(d,l),412===+l.error_code){a=!0;var u=e.dateParse(l.data.t?l.data.t+"000":""),p=o.saveLastTime?"<p>当前页面的内容最后保存于 "+o.saveLastTime+"</p>":"",f={title:"发现了一份更新的草稿",exClassName:"loadnew-draft-confirm",okText:"替换草稿",onCancel:function(){$(".x-draft-popup").show()}};i.loadPopup({title:"发现了一份更新的草稿",okText:"载入最新的草稿",cancelText:"将当前页面内容保存为最新草稿",contentHTML:'<div class="qpbc">'+p+"<p>我们发现最新的一份草稿保存于 "+u+' <a class="detail-draft" target="_blank" href="'+window.location.href+'&lookDetail">查看详情</a></p><p class="new-content">'+(l.data.c&&l.data.c.content)+"</p></div>",draft:o,data:l.data,okHandler:function(){t.loadConfirm($.extend({text:"载入您于"+u+"保存的草稿？ </br>当前页面上编辑的内容将被替换且无法恢复。",onOK:function(){i.loadDraftWithoutPopup(o)}},f))},cancelHandler:function(){t.loadConfirm($.extend({text:"将保存当前页面的内容作为最新的草稿？ </br>您于"+u+"保存的草稿将被替换且无法恢复。",onOK:function(){o.token=l.data.token,o.save(o.statusDom)}},f))}})}else 401===+l.error_code&&t.loadTip();s(d,c)}).fail(function(t){r.reject(t),s("保存失败",!0)})),r.promise()}},{key:"saveDraftTimer",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e4,n=new Date((new Date).getTime()+i),o=n.getHours(),r=n.getMinutes(),a=(o<10?"0"+o:o)+":"+(r<10?"0"+r:r),s=setTimeout(function(){e.saveDraftStatus="保存于"+a,t.html(e.saveDraftStatus),clearTimeout(s)},1e3);this.saveDraftTime=setTimeout(function(){e.save(t)},i)}},{key:"clearDraftTimer",value:function(){return clearTimeout(this.saveDraftTime),this}},{key:"saveSync",value:function(){return this.saveDraft(1)}},{key:"deleteDraft",value:function(){return $.Deferred().promise()}},{key:"draftDelete",value:function(){var t=this;this.deleteDraft().done(function(e){t.getDraft().done(function(e){var i=$.parseJSON(e);t.token=i.data&&i.data.token})})}},{key:"saveManu",value:function(t){return this.clearDraftTimer(),this.save(t)}},{key:"bindEvent",value:function(t,e){var i=this;t.on("click",function(){i.saveManu(i.statusDom)}),e&&e.length>0&&e.on("click",".btn",function(){var t=e.find(".sts");t.fadeIn(300),i.saveManu(i.statusDom).done(function(){t.html("保存成功").fadeOut(1e3,function(){history.go(-1)})}).fail(function(){t.html("保存失败")})})}},{key:"beforeunload",value:function(){var t=this;window.onbeforeunload=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event,i={result:"ok"};if(t.beforeunloadstart&&t.ue&&t.ue.getContent()&&t.saveSync(t.body()).done(function(t){return i=$.parseJSON(t)}),"ok"!==i.result){var n="您有未保存的草稿！";return e&&(e.returnValue=n),n}}}},{key:"body",value:function(){return{}}},{key:"setPlan",value:function(t){this.plan=t}},{key:"setUe",value:function(t){this.ue=t}},{key:"setSection",value:function(t){this.section=t}},{key:"setToolContent",value:function(t){this.toolContent=t}},{key:"multipleWin",value:function(){}}],[{key:"loadPopup",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.title,r=n.contentHTML,a=n.okText,s=void 0===a?"继续写草稿":a,l=n.cancelText,d=void 0===l?"删除草稿写新帖":l,c=n.deleteHandler,u=n.okHandler,p=void 0===u?function(){v.beforeunloadstart=!0,v.resumeEditDraft(g.c)}:u,f=n.cancelHandler,h=void 0===f?function(){i.cancelEditDraft(c,v)}:f,m=n.data,g=void 0===m?{}:m,v=n.draft,b="",x="";g.c&&(b=g.c.subject?g.c.subject:"未命名草稿",x=e.removeHtmlTag(g.c.content),x=x?"..."+x.substring(x.length-100):"");var _='<span class="savetime">最后保存于 '+(g.date||"")+"</span>";t.loadPopup({title:o,okText:s,cancelText:d,name:b,date:_,contentHTML:r,contentSubstr:x,onBeforeHide:function(){return $(".x-draft-popup").hide(),!1},onOK:p,onCancel:h})}},{key:"loadDraftWithoutPopup",value:function(t){t.getDraft().done(function(e){var i=$.parseJSON(e);"ok"===i.result&&(t.token=i.data.token,t.hasDraftUnsave=!1,t.saveDraftTimer(t.statusDom),i.data&&i.data.t&&(t.beforeunloadstart=!0,t.resumeEditDraft(i.data.c)))});
}},{key:"loadDraft",value:function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];var r=n[0],a=n[1],s=n[2],l=n[3],d=n[4],c=!0;window.location.href.match(/lookDetail/)&&(c=!1),c?(d.loadDraftTime+=1,d.getDraft().done(function(e){var o=$.parseJSON(e);"ok"===o.result?(d.token=o.data.token,d.hasDraftUnsave=!1,d.saveDraftTimer(l),o.data&&o.data.t?i.loadPopup({okText:r,cancelText:a,data:o.data,deleteHandler:s,draft:d}):d.beforeunloadstart=!0):401===+o.error_code?t.loadTip():d.loadDraftTime<d.loadDraftCount&&i.loadDraft.apply(i,n)}).fail(function(t){})):i.loadDraftWithoutPopup(d)}},{key:"cancelEditDraft",value:function(e,i){t.loadConfirm({onOK:function(){i.draftDelete(),e(),i.beforeunloadstart=!0},onCancel:function(){$(".x-draft-popup").show()}})}},{key:"loadTitle",value:function(t,e,i,n){""!==t?e.css("display","none"):e.css("display","block"),i.val(t),n.html(t),i.height(n.height()||40)}},{key:"loadPlan",value:function(t){requirejs(["common/models/common/component/planItinerary/index"],function(e){e.init({action:"edit",planid:t,disableCell:{traffic:!0}}),$(".x-issue-planLoad").hide(),$(".qy_issue_showHide").show()})}},{key:"loadTag",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(t.length>0){var e="";$.each(t,function(t,i){e=e+'<a href="javascript:;" class="tag js_cmd" data-cmd="delTag">'+$("<div/>").html(i).text()+"</a>"}),$("#js_tagContainer").html(e).css("display","block")}}},{key:"updateLift",value:function(){$("[data-mode=lift]").length&&$("[data-mode=lift]").hasClass("selected")&&$("[data-mode=lift]").trigger("click")}}]),i}();return{Draft:i}});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();define("assets/issue/draft/editDraft",["assets/issue/draft/draft","assets/issue/util"],function(t,e){var i=function(t){function i(t){_classCallCheck(this,i);var e=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.pid=t,e}return _inherits(i,t),_createClass(i,[{key:"getDraft",value:function(){return $.get("/draft/load-modify?pid="+this.pid+"&"+e.now())}},{key:"saveDraft",value:function(t){return $.ajax({type:"POST",url:"/draft/save-modify?pid="+this.pid,data:this.body(),async:!t})}},{key:"deleteDraft",value:function(){return $.post("/draft/remove-modify",{pid:this.pid})}},{key:"body",value:function(){if(!this.ue)return{};var t=this.plan&&this.plan.getPlanID();this.ue.options.isSubmit=!1;var e=$(".main-tags .selected").map(function(){return $(this).text()}).toArray(),i={subject:$.trim($("#threadTitle").val()),content:this.ue.getContent().replace(/\&nbsp\;/gi," "),tag:$("#js_tagContainer > a").map(function(){return $(this).text()}).toArray().concat(e),plan_id:t};return{token:this.token,mode:"W",data:i}}}]),i}(t.Draft);return{EditDraft:i}});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();define("assets/issue/draft/pubDraft",["assets/issue/draft/draft","assets/issue/util"],function(t,e){var i=function(t){function i(t,e){_classCallCheck(this,i);var n=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return n.fid=t,n.type=e,n}return _inherits(i,t),_createClass(i,[{key:"getDraft",value:function(){return $.get("/draft/load-new?type="+this.type+"&fid="+this.fid+"&"+e.now())}},{key:"saveDraft",value:function(t){return $.ajax({type:"POST",url:"/draft/save-new?type="+this.type+"&fid="+this.fid,data:this.body(),async:!t})}},{key:"deleteDraft",value:function(){return $.post("/draft/remove-new",{type:this.type,fid:this.fid})}},{key:"body",value:function(){if(!this.ue)return{};var t=this.plan&&this.plan.getPlanID(),e=[],i=$("#js_blockContainer").find("p.show-forward-banner"),n=this.section&&this.section.getCheckedFid();n&&e.push(n);for(var o=0,r=i.length;o<r;o++)i.eq(o).attr("data-forward-fid")&&e.push(i.eq(o).attr("data-forward-fid"));this.ue.options.isSubmit=!1;var a={subject:$.trim($("#threadTitle").val()),content:this.ue.getContent().replace(/\&nbsp\;/gi," "),tag:$("#js_tagContainer > a").map(function(){return $(this).text()}).toArray(),plan_id:t};return{token:this.token,mode:"W",data:a}}}]),i}(t.Draft);return{PubDraft:i}});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();define("assets/issue/draft/replyDraft",["assets/issue/draft/draft","assets/issue/util"],function(t,e){var i=t.Draft,n=function(t){function n(t){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.tid=t,e}return _inherits(n,t),_createClass(n,[{key:"resumeEditDraft",value:function(t){t&&t.content&&$.trim(t.content)&&this.writeContent(t.content),i.updateLift()}},{key:"getDraft",value:function(){return $.get("/draft/load-reply?tid="+this.tid+"&"+e.now())}},{key:"saveDraft",value:function(t){return $.ajax({type:"POST",url:"/draft/save-reply?tid="+this.tid,data:this.body(),async:!t})}},{key:"deleteDraft",value:function(){return $.post("/draft/remove-reply",{tid:this.tid})}},{key:"body",value:function(){if(!this.ue)return{};this.ue.options.isSubmit=!1;var t={content:this.ue.getContent().replace(/\&nbsp\;/gi," ")};return{token:this.token,mode:"W",data:t}}}]),n}(i);return{ReplyDraft:n}});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();define("assets/issue/draft/threadDraft",["assets/issue/draft/draftFactory","assets/issue/draft/editDraft","assets/issue/draft/pubDraft","assets/issue/draft/replyDraft","assets/issue/constant"],function(t,e,i,n,o){var r=function(t){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,t),_createClass(r,[{key:"genDraft",value:function(t){var r=window.location.href.match(/pid=(\d+)&?.*$/),a=r?r[1]:0,s=null;switch(t){case"edit":s=new e.EditDraft(a);break;case"pub":s=new i.PubDraft(o.fid,o.threadType);break;case"reply":s=new n.ReplyDraft(o.tid);break;default:s=new i.PubDraft(o.fid,o.threadType)}return s}}]),r}(t.DraftFactory);return{ThreadDraft:r}}),define("assets/issue/ajax",[],function(){var t="",e=window.devicePixelRatio;return e&&(t=e>1?"":"&icon=60"),{getForm:function(t){return $.get("/forum.php?action=typeToForum&type="+t)},makeTag:function(t){return $.post("qcross/bbs/thread.php?action=maketag",{title:t})},searchTag:function(t){return $.post("/qcross/ask/ajax.php?action=TopicMenu",t)},tagPreload:function(t){return $.post("/thread.php?action=maketag",t)},issueThread:function(t){return $.post("/thread-new",t)},threadEdit:function(t){return $.post("/thread-edit",t)},getTagsByFid:function(e){return $.get("/forum.php?action=tagGroup&fid="+e+t)}}}),define("assets/issue/tag",["assets/issue/util","assets/issue/ajax","assets/issue/components"],function(t,e,i){var n=$("#js_tagContainer"),o=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=i.autoTagOneFlag,r=void 0===o||o,a=i.threadType,s=i.ue;if(r){r=!1;var l=$.trim(t.removeHtmlTag($("#threadTitle").val()+s.getContent()));$(".autotag-title").hide(),n.css("display","block"),l.length>100&&(1===+a||2===+a)&&($(".autotag-load").show(),n.css("display","none"),e.makeTag(l).done(function(t){$(".autotag-load").hide(),n.css("display","block");var e=$.parseJSON(t);if("ok"===e.result&&e.data){$(".autotag-title").show();var i="";e.data.length&&$.each(e.data.slice(0,5),function(t,e){i+="<a href='javascript:;' class='tag js_cmd autotag-cell' data-cmd='delTag'>"+e+"</a>"}),n.prepend(i)}}))}},r=$("#js_searchTag");i.loadSearch(r,{parent:document.getElementById("js_searchTagContainer"),onSearch:function(){e.searchTag({keyword:$("<div/>").html(r.val()).text()}).done(function(t){var e=$.parseJSON(t);if(e.data.item.length){var i=['<ul class="qui-inputAutocomplete-ul">'];$.each(e.data.item,function(t,e){t<10&&i.push('<li data-id="'+t+'">'+$("<div/>").html(e).text()+"</li>")}),i.push("</ul>"),i=i.join(""),r.qyerAutocomplete("pushHTML",i),$("#js_searchTagContainer").find("li:first").attr("data-select","true")}else r.qyerAutocomplete("pushHTML",'<div class="qui-inputAutocomplete-noResult" > 没有找到任何结果</div>')})},onSelect:function(t){if(n.css("display","block"),$("#js_tagContainer > a").length<10){var e=$(t),o=e.hasClass("qyer_inputAutocomplete_creat")?e.find("span").html():e.html(),a=!n.find("a").filter(function(){return $(this).html()===o}).length;if(e.hasClass("qyer_inputAutocomplete_creat")){var s=e.find("span").html();a&&$.trim(s)&&n.append('<a href="javascript:;" class="tag js_cmd" data-key="'+$(t).attr("data-id")+'" data-cmd="delTag">'+s+"</a>")}else if($.trim($(t).text())){var l='<a href="javascript:;" class="tag js_cmd" data-key="'+$(t).attr("data-id")+'" data-cmd="delTag">'+$(t).text()+"</a>";a&&n.append(l),this.value=""}}else i.loadTip({text:"最多添加10个标签",type:"warning"});r.val("")}});var a=function(o){var r=$("#tagTipLoad"),a=$(".tipTagExamp");a.css("display","none"),e.tagPreload({title:t.removeHtmlTag($("#threadTitle").val())+t.removeHtmlTag(o.getContent().replace(/\&nbsp\;/gi," "))}).done(function(t){var e=$.parseJSON(t);if("ok"===e.result){var o=[];e.data&&e.data.length&&a.css("display","inline")&&$.each(e.data.slice(0,10),function(t,e){o[t]="<a href='javascript:;'>"+e+"</a>"}),r.empty().append(o.join(""))}r.on("click","a",function(){var t=$(this),e=t.index();n.css("display","block");var o=!n.find("a").filter(function(){return $(this).html()===t.html()}).length;n.find("a").length<10?o&&n.append("<a href='javascript:;' class='tag js_cmd' data-cmd='delTag' data-ta-index='"+e+"'>"+t.text()+"</a>"):i.loadTip({text:"最多添加10个标签",type:"warning"})})})},s={type:"group","情侣":"couple","亲子":"parentchild","家庭":"family","朋友":"friends","独自旅行":"travel"},l={type:"theme","动漫":"cartoon","购物":"shopping","美食":"cate","摄影":"shoot","赏樱":"sakuragari","米其林":"michelin","温泉":"hotspring"},d={group:"适合人群",theme:"主题"},c='<span class="item _type_" data-tagid="_id_"><span class="ico" _style_></span><span class="des" title="_des_">_des_</span></span>',u=$(".main-tags"),p=u.find(".wrap"),f=$(".fitgroup"),h=$(".alltheme"),m=function g(i){if(g.fid!==i){g.fid=i;var n=function(t,e){for(var i,n="",o=t.length,r="theme"===e.type?'style="background: url(_url_) no-repeat center"':"",a=0;i=t[a++];){var s=e[i.name]||"";a===o&&(s+=" last"),n+=c.replace(/_id_/,i.id).replace(/_type_/,s).replace(/_style_/,r.replace(/_url_/,i.icon)).replace(/_des_/g,i.name)}return n};return e.getTagsByFid(i).then(function(e){if("ok"===e.result)if(e.data){var i=t.distinctJson("name",e.data[d.theme]),o=t.distinctJson("name",e.data[d.group]);p.empty(),o&&f.html(n(o,s)),i&&h.html(n(i,l)),u.fadeIn(800)}else u.fadeOut(800);return e})}};return u.on("click",".item",function(t){$(this).data("tagid");$(this).hasClass("selected")?$(this).removeClass("selected"):this.parentNode.className.match(/fitgroup/)?$(this).addClass("selected").siblings().removeClass("selected"):$(this).addClass("selected")}),{autoTagOnce:o,preLoadTag:a,getTagsByFid:m}}),define("assets/issue/section",["assets/issue/ajax","assets/issue/constant","assets/issue/tag"],function(t,e,i){var n=$("#pubForceBanner"),o=$("#supMainModule"),r=$("#subMainSelect"),a=0;n.empty().html("<span class='x-c63 x-fz14'>正在获取主版块...</span>");var s=e.fid;+s&&i.getTagsByFid(+s),t.getForm(e.threadType).done(function(t){var e=$.parseJSON(t),l="";if("ok"===e.result){var d=e.data;if(d.main&&d.main.force)n.html(d.main.force.name).attr("data-main-fid",d.main.force.id),!d.forward||$.isEmptyObject(d.forward.list)&&!d.forward.force||$(".pTransmit").css("display","block"),a=d.main.force.id;else{var c=d.main.list;n.empty().html("<a id='selectMainModule' href='javascript:;' class='x-c10b041'>添加帖子所属版面</a><span id='selectMainValueArea' style='display:none;cursor:pointer;'><span></span><a style='margin-left:20px;color:#10b041' href='javascript:;'>修改</a></span>");var u=!0,p=[],f=[];if($.each(c,function(t,e){t="穷游兴趣小组"===t?"兴趣小组":t,p.push("<li><a href='javascript:;'>"+t+"</a></li>"),f.push("<ul class='popup_list_ul clearfix'>");for(var i=0,n=e.length;i<n;i++)f.push('<li><label><input class="js_cmd" type="radio" name="mainBanner" data-sub-fid="'+e[i].id+'" data-sub-fname="'+e[i].name+'"><span>'+e[i].name+"</span></label></li>"),s===+e[i].id&&(l=e[i].name);f.push("</ul>")}),o.empty().append(p.join("")).find("li").eq(0).addClass("active"),r.empty().append(f.join("")).find("ul").eq(0).css("display","block"),l){$("#selectMainValueArea").css("display","block").prev().css("display","none").end().find("span").html(l);var h=r.find("[data-sub-fid="+s+"]").attr("checked","checked").parents(".popup_list_ul").index();a=s,n.attr("data-main-index",h),!d.forward||$.isEmptyObject(d.forward.list)&&!d.forward.force||$(".pTransmit").css("display","block")}var m=$("#mainBannerSelect");n.on("click",function(t){var e=$(this);if(u){u=!1,m.slideDown();var i=e.attr("data-main-index");void 0!==i&&(o.find("li").eq(i).addClass("active").siblings().removeClass("active"),r.find("ul").eq(i).css("display","block").siblings().css("display","none"))}else m.slideUp(),u=!0;window.event?window.event.cancelBubble=!0:t.stopPropagation()}),o.delegate("li","mouseenter",function(){$(this).addClass("active").siblings().removeClass("active"),r.find("ul").eq($(this).index()).css("display","block").siblings().css("display","none")}),$(document).on("click",function(t){var e=window.event||t,o=$(e.target||e.srcElement);if(o.closest("#mainBannerSelect").length){if("mainBanner"===o.attr("name")){var r=$("#selectMainValueArea");r.css("display","block").prev().css("display","none"),r.find("span").html(o.attr("data-sub-fname")),a=o.attr("data-sub-fid"),i.getTagsByFid(+a),m.slideUp(),u=!0,!d.forward||$.isEmptyObject(d.forward.list)&&!d.forward.force||$(".pTransmit").css("display","block"),n.attr("data-main-index",o.parents(".popup_list_ul").index())}}else m.slideUp(),u=!0})}var g=$("#js_blockContainer"),v=d.forward_limit,b=[],x=[],_=0;if(d.forward&&d.forward.force&&(_=d.forward.force.id,v-=1,g.append("<div class='show-forward-banner' data-forward-fid="+d.forward.force.id+">"+d.forward.force.name+"</div>")),(!d.forward||d.forward&&$.isEmptyObject(d.forward.list)&&!d.forward.force)&&$(".pTransmit").css("display","none"),d.forward&&!$.isEmptyObject(d.forward.list)){var y=-1,w=!0;$.each(d.forward.list,function(t,e){y+=1,t="穷游兴趣小组"===t?"兴趣小组":t,b.push('<li><a href="javascript:;">'+t+"</a></li>"),x.push('<ul class="popup_list_ul clearfix">');for(var i=0,n=e.length;i<n;i++)x.push('<li><label><input type="checkbox" class="checkbox-forward" value='+e[i].id+" data-forward-name="+e[i].name+" data-forward-index="+y+"><span>"+e[i].name+"</span></label></li>");x.push("</ul>")});var E=$("#js_menuUL"),k=$("#js_popup_list"),T=$("#js_qy_issue_block_list"),q=$("#js_showBlockList");E.empty().append(b.join("")),k.empty().append(x.join("")),$(".pTransmit").on("click",".show-forward-banner",function(t){w?(w=!1,T.slideDown()):(T.slideUp(),w=!0);var e=$(this).attr("data-forward-index")||0;E.find("li").eq(e).addClass("active").siblings().removeClass("active"),k.find("ul").eq(e).css("display","block").siblings().css("display","none"),window.event?window.event.cancelBubble=!0:t.stopPropagation()}),E.delegate("li","mouseenter",function(){$(this).addClass("active").siblings().removeClass("active"),k.find("ul").eq($(this).index()).css("display","block").siblings().css("display","none")}),g.css({display:"inline-block","*display":"inline","*zoom":1});var S=$("<a href='javascript:;' style='float:right;display:none;' class='show-forward-banner'>修改</a>");g.append(S),$(document).on("click",function(t){var e=window.event||t,i=$(e.target||e.srcElement);if(i.closest("#js_qy_issue_block_list").length){if(i.hasClass("checkbox-forward"))if(k.find("input:checked").length>=v?k.find("input[type=checkbox]").not(":checked").attr("disabled","disabled"):k.find("input[type=checkbox]").removeAttr("disabled"),k.find("input:checked").length?(q.parent().css("display","none"),S.css("display","block")):(S.css("display","none"),q.parent().css("display","block")),i.is(":checked"))g.find("a:first").attr("data-forward-fid",i.val()).attr("data-forward-index",i.attr("data-forward-index")).attr("data-forward-name",i.attr("data-forward-name")),g.append("<p style='cursor:pointer;margin-right:20px;display:inline-block;' class='show-forward-banner' data-forward-fid="+i.val()+" data-forward-index="+i.attr("data-forward-index")+" data-forward-name="+i.attr("data-forward-name")+">"+i.attr("data-forward-name")+"</p>");else for(var n=g.find("p"),o=n.length;o--;)if(n.eq(o).attr("data-forward-name")===i.attr("data-forward-name")){n.eq(o).remove();break}}else T.slideUp(),w=!0})}}});var l=function(){return a};return{getCheckedFid:l}}),define("assets/issue/toolFixed",[],function(){return{disTop:51,toolOrgRight:function(){return{fl:+($(".qy_issue_travel_content").offset().left||0).toFixed()+$(".qy_issue_travel_content").width()+2}},init:function(t){this.dom=$(".tool_right"),this.initOffset(),this.bindEvent(t)},initOffset:function(){this.offset=this.dom.offset()},bindEvent:function(t){var e=this,i=$(window);$(".tool_right").on("mousedown","img",function(t){t.preventDefault()}),i.on("scroll",function(){var n=($(".qy_issue_travel_content").offset()||{}).top||0,o={position:"absolute",top:0,left:""};"edit"===t&&(n+=40),i.scrollTop()>n-e.disTop-40?"fixed"!==e.dom.css("position")&&e.dom.css({position:"fixed",left:e.toolOrgRight().fl,top:e.disTop+40+"px"}):"absolute"!==e.dom.css("position")&&e.dom.css(o)})}}}),define("web_ct_submitBeforeValidCode",["web_old_popup2","web_old_tip"],function(t,e){var i=window.__needVerifyImage||0;return function(n){1==i?new t({title:"请输入验证码",contentHTML:function(){return['<input id="js_valid_code_input" type="text" placeholder="请输入验证码" style="border:solid 1px rgb(204, 204, 204); padding:3px; border-radius:3px; margin-left:10px; vertical-align:8px;" />','<img id="js_valid_code_img" src="/ajax.php?action=captcha" onclick=\'this.src="/ajax.php?action=captcha&timer="+((new Date()).getTime())+(window.QYER&&window.QYER.uid?("&uid="+window.QYER.uid):"")\' />'].join("")}(),onOK:function(){var t=document.getElementById("js_valid_code_input").value;return t?void(n&&n.call(null,t)):(e.tip({text:"请输入验证码",type:"warning"}),!1)}}).show():n&&n(null,!1)}}),define("assets/issue/issuePopup",["assets/issue/components","assets/issue/tag","assets/issue/constant","assets/issue/ajax","assets/issue/section","assets/issue/util","web_ct_submitBeforeValidCode"],function(t,e,i,n,o,r,a){var s=$(".x-filter-blur"),l=$(".qy_issue_wrap"),d=null,c=null,u=null,p=function(t){return d=t},f=function(t){return c=t},h=function(t){return u=t},m={getData:function(t,e){var i=t.checkedFid,n=t.draft,o=t.type,a=t.plan_id,s=[],l=$("#js_blockContainer").find("p.show-forward-banner");i&&s.push(i);for(var d=0,c=l.length;d<c;d++)l.eq(d).attr("data-forward-fid")&&s.push(l.eq(d).attr("data-forward-fid"));e&&(e.options.isSubmit=!0);var u=$(".main-tags .selected").map(function(){return $(this).text()}).toArray().concat($("#js_tagContainer > a").map(function(){return $(this).text()}).toArray());return{subject:$.trim($("#threadTitle").val()),content:e&&e.getContent().replace(/\&nbsp\;/gi," "),tag:r.distinctAry(u),device:1,fid:s||[],attachment:$(document.getElementById("ueditor_0").contentWindow.document).find(".qyer_attach").map(function(t,e){return $(e).attr("data-key")||$(e).attr("data-id")}).toArray(),draft:n,type:o,plan_id:a}},showSubmitPopup:function(n,o){var r=$.trim($("#threadTitle").val());return r?r&&r.length>60?(t.loadTip({text:"标题超出字数限制。",type:"error"}),!1):d.getContent()?(e.autoTagOnce({threadType:i.threadType,ue:d}),s.addClass("x-pub-blur"),e.preLoadTag(d),$("#js_qy_issue_popup").show(),l.css("opacity","0.9"),void $("body").css("overflow","hidden")):(t.loadTip({text:"请您编辑帖子内容。",type:"warning"}),!1):(t.loadTip({text:"请您输入帖子标题。",type:"warning"}),!1)},hideSubmitPopup:function(t,e){$("#js_qy_issue_popup").hide(),l.css("opacity",1),$("body").css("overflow","auto"),s.removeClass("x-pub-blur")},delTag:function(t,e){e.remove(),!$("#js_tagContainer > .autotag-cell").length&&$(".autotag-title").hide(),!$("#js_tagContainer > a").length&&$("#js_tagContainer").css("display","none")},popupClick:function(t){var e=t.target||t.srcElement;if("js_qy_issue_block_list"!=e.id){var i=document.getElementById("js_qy_issue_block_list").contains(e);i||$("#js_qy_issue_block_list").slideUp()}},publish:function(e,r){var s=this;a(function(e){var r=t.loading();$("body .qui-loading").css("z-index","2000");var a=setTimeout(function(){c&&c.clearDraftTimer();var l=s.getData({checkedFid:o.getCheckedFid(),draft:c.token,type:i.threadType,plan_id:u&&u.getPlanID()},d);e&&(l.valid_code=e),n.issueThread(l).done(function(e){var i=$.parseJSON(e);if(r.done(function(t){return t.hide()}),"ok"===i.result){if(window.onbeforeunload=null,i.data)if(i.data.badword&&i.data.badword.length){t.loadTip({text:"提交成功，但你发布的内容需要接受X光检查。不要担心，正常内容会马上通过。请不要重复发布哟~",time:2e3});var n=setTimeout(function(){i.data.url&&(window.location.href=i.data.url),clearTimeout(n)},2e3)}else i.data.url&&(window.location.href=i.data.url)}else t.loadTip({text:i.data,type:"error"}),c&&c.save($(".qy_issue_mask .text"))}).fail(function(e){gTip.tip({text:pubNotemod.parse(e).data,type:"error"}),t.loadTip({text:$.parseJSON(e).data,type:"error"}),c&&c.save($(".qy_issue_mask .text"))}),clearTimeout(a)},300)})}};return $(document).on("click",".js_cmd",function(t){var e=$(this),i=e.attr("data-cmd");m[i]&&m[i](t,e)}),$("#js_qy_issue_popup").click(function(t){return m.popupClick(t)}),{setUe:p,setDraft:f,setPlan:h}}),$(function(){requirejs(["assets/issue/constant","assets/issue/editor","assets/issue/draft/threadDraft","assets/issue/section","assets/issue/tag","assets/issue/components","assets/issue/toolFixed","assets/issue/issuePopup"],function(t,e,i,n,o,r,a,s){$("body").css("overflow","auto");var l=null,d=$(".qy_issue_plan");$(".x-issue-planLoad").on("click",function(){var e=$(this);r.loadPlan({topicType:t.threadType,disableCell:{traffic:!0}}).done(function(){e.hide(),$(".qy_issue_showHide").css("display","block")})});var c=1===+t.threadType||3===+t.threadType;c?d.css("display","block"):d.css("display","none"),r.loadTitle(),a.init();var u=(new i.ThreadDraft).loadDraft({delayRead:!0});s.setDraft(u),r.Plan().done(function(t){s.setPlan(t),u.setPlan(t)});var p=e({saveSceneHandler:function(){$(".saveBtns .save").trigger("click")}}).done(function(){var t=$(".editHolder"),e=$(document.getElementById("ueditor_0").contentWindow.document.body);e.focus(),t.on("click",function(){e.focus()}),e.on("keydown",function(e){t.hide()}).on("keyup",function(i){var n=UE.getEditor("senior_editor").getContent();n&&e.text()||/<img.*\/?>/.test(n)||t.show()})});p.done(function(t){l=t,s.setUe(t),u.setUe(t),u.setSection(n),u.read(),r.loadToolContent(t).done(function(t){return u.setToolContent(t)}),r.loadToolContent(t)}),$(".editHolder").css({width:"600px",height:$(window).height()-$(".editHolder").offset().top}),$(document).on("x-editDomInsert",function(){$(".editHolder").hide()})})}),define("assets/issue/index",function(){}),function(t){var e=document,i="appendChild",n="styleSheet",o=e.createElement("style");o.type="text/css",e.getElementsByTagName("head")[0][i](o),o[n]?o[n].cssText=t:o[i](e.createTextNode(t))}(".qui-popup{position:fixed;top:0;left:0;width:100%;height:100%;background-image:url(//static.qyer.com/models/common/images/bg_255_255_255_0.7.png);z-index:1000;overflow-y:auto;opacity:0}.qui-popup>div{display:table;height:100%;margin:0 auto}.qui-popup-dt{display:table-cell;vertical-align:middle}.qui-popup-box{margin:0 auto;background-color:#fff;position:relative;-webkit-box-shadow:0 0 6px #aaa;-moz-box-shadow:0 0 6px #aaa;box-shadow:0 0 6px #aaa;border:1px solid #ccc;opacity:0}.qui-popup-cancelBtn,.qui-popup-loadingBtn,.qui-popup-okBtn{vertical-align:middle;margin-left:10px}.qui-popup-box-title{height:60px;line-height:60px;font-size:18px;font-weight:700;padding-left:20px}.qui-popup-box-content{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0 20px}.qui-popup-box-content>iframe{width:100%;border:none}.qui-popup-box-bottom{text-align:right;height:70px;line-height:70px;padding-right:20px}.qui-popup-closeIcon{position:absolute;right:10px;top:10px;cursor:pointer;background-image:url(//static.qyer.com/models/common/ui/popup/ico.png);height:32px;width:32px;background-repeat:no-repeat;background-position:0 0;border-radius:5px}.qui-popup-closeIcon:hover{background-position:0 -38px}.qui-popup-loadingBtn{display:none}.qui-confirm{position:fixed;top:0;left:0;width:100%;height:100%;background-image:url(//static.qyer.com/models/common/images/bg_255_255_255_0.7.png);z-index:1200;display:none;opacity:0}.qui-confirm-box,.qui-confirm-box-content{position:relative}.qui-confirm>div{display:table-cell;vertical-align:middle}.qui-confirm-box{margin:0 auto;width:300px;top:-50px;opacity:0;overflow:hidden;box-shadow:0 0 6px #aaa;border:1px solid #ccc;background-color:#fff}.qui-confirm-box-title{height:30px;color:#666;line-height:30px;margin-bottom:20px;padding-left:20px;font-weight:700}.qui-confirm-box-content-icon,.qui-confirm-closeIcon{position:absolute;background-image:url(//fed.static.qyer.com/core/web/common/resource/ui/oldconfirm/icons.png);width:32px;background-repeat:no-repeat}.qui-confirm-box-content-icon{float:left;height:32px;margin:-16px 0 0 10px;top:50%;vertical-align:middle}.qui-confirm-box-content-iconOK{background-position:0 -67px}.qui-confirm-box-content-iconError{background-position:0 -12px}.qui-confirm-box-content-iconWarning{background-position:0 -121px}.qui-confirm-box-content-text{color:#666;height:100%;margin:0 20px 0 60px}.qui-confirm-box-bottom{background-color:#fff;text-align:right;height:50px;line-height:50px;padding-right:20px}.qui-confirm-closeIcon{right:10px;top:10px;cursor:pointer;height:32px;background-position:0 -192px;border-radius:5px}.qui-confirm-closeIcon:hover{background-position:0 -230px}.qui-confirm-box-clearFloat{clear:both;height:0;overflow:hidden}.qui-tip{position:fixed;top:75pt;left:0;width:100%;text-align:center;display:none;z-index:1100}.qui-tip-box{display:inline-block;min-width:90pt;max-width:390px;padding:20px 30px;background-color:#fff;box-shadow:0 2px 7px rgba(0,0,0,.25);border:1px solid silver;text-align:left;font-size:18px;line-height:2pc}.qui-tip-text{display:block;position:relative;padding-left:34px}.qui-tip-text:before{content:'';position:absolute;left:0;top:4px;width:24px;height:24px;background:url(//fed.static.qyer.com/core/web/common/resource/ui/oldtip/icons2.png) no-repeat #fff}.qui-tip-box-error .qui-tip-text:before{background-position:0 -5pc}.qui-tip-box-warning .qui-tip-text:before{background-position:0 -40px}.qui-inputAutocomplete{position:absolute;z-index:1100;background-color:#fff;border:1px solid #eee}.qui-inputAutocomplete-ul li{height:32px;line-height:32px;border-bottom:solid 1px #eee;background-color:#fff;cursor:pointer;word-break:keep-all;text-overflow:ellipsis;overflow:hidden}.qui-inputAutocomplete-ul li:hover,.qui-inputAutocomplete-ul li[data-select=true]{background-color:#e0f1de}.qui-inputAutocomplete-ul li.disableDefalut{background-color:#fff!important;cursor:default}.qui-inputAutocomplete-noResult{color:red}.qyer_inputAutocomplete_name{padding:0 5px 0 10px}.qyer_inputAutocomplete_name .current{color:#077345}.qyer_inputAutocomplete_en{padding-right:10px;font-family:Tahoma,Geneva,sans-serif}.qyer_inputAutocomplete_found{color:#959595;padding-right:10px}.qyer_inputAutocomplete_creat{padding:10px}.qui-loading{position:fixed;top:0;left:0;width:100%;height:100%;background-image:url(//static.qyer.com/models/common/images/bg_255_255_255_0.7.png);z-index:1000;display:none;opacity:0}.qui-loading>div{display:table-cell;vertical-align:middle;text-align:center}.qui-loading-box{display:inline-block;margin:0 auto;border:3px solid #cfcfcf;color:#555;padding:10px;border-radius:5px;min-width:75pt;font-weight:700;background:-moz-linear-gradient(#fff,#eee 100%);box-shadow:0 0 5px #999}.qui-popup2{position:fixed;top:0;left:0;width:100%;height:100%;background-image:url(//static.qyer.com/models/common/images/bg_255_255_255_0.7.png);z-index:1000;overflow-y:auto;opacity:0}.qui-popup2>div{display:table;height:100%;margin:0 auto}.qui-popup2-dt{display:table-cell;vertical-align:middle}.qui-popup2-box{margin:0 auto;background-color:#fff;position:relative;-webkit-box-shadow:0 0 6px #aaa;-moz-box-shadow:0 0 6px #aaa;box-shadow:0 0 6px #aaa;border:1px solid #ccc;opacity:0}.qui-popup2-loadingBtn,.qui-popup2-okBtn{vertical-align:middle;margin-left:16px}.qui-popup2-box-title{height:70px;line-height:70px;font-size:20px;font-weight:700;padding-left:30px}.qui-popup2-box-content{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0 30px}.qui-popup2-box-content>iframe{width:100%;border:none}.qui-popup2-box-bottom{text-align:right;height:70px;line-height:70px;padding-right:30px}.qui-popup2-closeIcon{position:absolute;right:10px;top:10px;cursor:pointer;background-image:url(//static.qyer.com/models/common/ui/popup2/icons.png);height:32px;width:32px;background-repeat:no-repeat;background-position:0 -18px;border-radius:5px}.qui-popup2-closeIcon:hover{background-position:0 -65px}.qui-popup2-cancelBtn{vertical-align:middle}.qui-popup2-loadingBtn{display:none}\n.qyEdit_append_title { height:26px; padding:10px 20px; position:relative;}\n.qyEdit_append_title .text { float:left; margin-right:20px; font-size:18px; line-height:26px;}\n.qyEdit_append_title .close { position:absolute; right:10px; top:8px; width:32px; height:32px; display:block; background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat 0 -452px; cursor:pointer;}\n.qyEdit_append_title .close:hover { background-position:0 -484px;}\n.qyEdit_append_title .minimize { position:absolute; right:10px; top:8px; width:32px; height:32px; display:block; background:url(//static.qyer.com/models/project/bbs/css/images/icon_arrow.png) no-repeat 0 0; cursor:pointer;}\n.qyEdit_append_title .minimize .tip { display: none; position: absolute; top: -28px; left: -13px; width: 58px; height: 32px; line-height: 26px; color: #959595; text-align: center; background:url(//static.qyer.com/models/project/bbs/css/images/icon_arrow.png) no-repeat 0 -32px;}\n.qyEdit_append_title .minimize.hvr:hover .tip { display: block;}\n.qyEdit_append_title .minimize_tip { position: absolute; top: -42px; right: -79px; width: 220px; height: 30px; line-height: 30px; color: #FFF; text-align: center; background: #3dc067; border-radius: 3px;}\n.qyEdit_append_title .minimize_tip:after { content: '\\25C6'; position: absolute; top: 14px; left: 50%; color: #3dc067;}\n.qyEdit_append_title .minimize_tip em { margin-left: 5px; font-size: 18px; vertical-align: -2px; cursor: pointer;}\n.fixed_minimizebar { display: none; position: fixed; z-index: 1000; left: 50%; bottom: 0; margin-left: -299px; width: 598px; height: 48px; border: 1px solid #d7d7d7; background: #FFF; font-size: 14px;}\n.fixed_minimizebar .wrap { position: absolute; z-index: 2; width: 100%; height: 100%; line-height: 48px;}\n.fixed_minimizebar .wrap p { padding: 0 20px;}\n.fixed_minimizebar .wrap .back { position: absolute; top: 8px; right: 10px; width: 32px; height: 32px; background:url(//static.qyer.com/models/project/bbs/css/images/icon_arrow.png) no-repeat -32px 0; cursor:pointer;}\n.fixed_minimizebar .progress { position: absolute; top: 0; left: 0; z-index: 1; width: 0%; height: 100%; background: #f5f5f5; transition: all .2s ease-in;}\n.fixed_minimizebar.complete { border-color: #10b041;}\n.fixed_minimizebar.complete .wrap p { color: #10b041;}\n.fixed_minimizebar.complete .wrap .back { background-position: -64px 0;}\n.fixed_minimizebar.complete .progress { display: none;}\n.qyEdit_append_button { padding:20px; height:28px;}\n.qyEdit_append_button a { float:right; margin-left:10px;}\n.qyEdit_append_video { padding:20px 0 0;}\n.qyEdit_append_video .input { border:1px solid #dedede; margin:0 20px; border-radius:2px; padding:3px 30px 3px 10px; position:relative;}\n.qyEdit_append_video .inputError { border:1px solid #fb6850;}\n.qyEdit_append_video .input input { width:100%; border:0; padding:0;}\n.qyEdit_append_video .input input:focus { box-shadow:0 0 0 rgba(0,0,0,0);}\n.qyEdit_append_video .input .loading { text-indent:-9999px; position:absolute; right:10px; top:8px; left:auto;width:16px; height:16px; background:url(//static.qyer.com/images/common/tpl/wait_16.gif) no-repeat;}\n.qyEdit_append_video .tips { height:18px; margin:10px 20px 0;}\n.qyEdit_append_video .tips .error { padding-left:20px; position:relative;display: none;color:#fb6850;width: auto;}\n.qyEdit_append_video .tips .error span { background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat 0 -385px; display:block; width:16px; height:16px; position:absolute; left:0; top:1px;}\n.qyEdit_append_video .tips .tip{font-size: 14px;color: #959595;}\n.showError .input{border:1px solid #fb6850;}\n.showError .tips .error{display: block;}\n.qyEdit_append_video .input .correct {\n  text-indent: -9999px;\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  left:auto;\n  width: 16px;\n  height: 16px;\n  background: url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat -100px -385px;}\n.editor_video .qui-popup2-box-content{padding: 0;}\n.editor_file .qui-popup2-box-content{padding: 0;}\n.qyEdit_append_affix { padding:20px 0 0;}\n.qyEdit_append_affix .input { border:1px solid #dedede; cursor:pointer; background:#f5f5f5; margin:0 20px; border-radius:2px; padding:3px 30px 3px 10px; position:relative;}\n.qyEdit_append_affix .inputError { border:1px solid #fb6850;}\n.qyEdit_append_affix .upload { line-height:24px; padding:3px 0; color:#636363; font-size:14px;overflow: hidden;text-overflow:ellipsis;white-space:nowrap;}\n.input:hover .upload .default{background-position:-256px -194px; color:#10b041;}\n.qyEdit_append_affix .upload .default { padding-left:20px; background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat -256px -168px;}\n.qyEdit_append_affix .input .loading { text-indent:-9999px; position:absolute; left:550px; top:10px; width:16px; height:16px; background:url(//static.qyer.com/images/common/tpl/wait_16.gif) no-repeat;}\n.qyEdit_append_affix .input .correct { text-indent:-9999px; position:absolute; right:10px; top:10px; width:16px; height:16px; background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat -100px -385px;}\n.qyEdit_append_affix .tips { height:20px; margin:10px 20px 0; line-height:20px;}\n.qyEdit_append_affix .tips p { font-size:14px; color:#959595;}\n.qyEdit_append_affix .tips .error { color:#fb6850; padding-left:20px; font-size:12px; position:relative;display: none;}\n.qyEdit_append_affix .tips .error span { background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat 0 -385px; display:block; width:16px; height:16px; position:absolute; left:0; top:2px;}\n.webuploader-container {\n    position: relative;\n}\n.webuploader-element-invisible {\n    position: absolute !important;\n    clip: rect(1px 1px 1px 1px); \n    clip: rect(1px,1px,1px,1px);\n}\n.editor_createAlbum .qui-popup2-box-content{padding: 0;}.loading{position: absolute;width: 100%;height: 100%;left: 0;top:0;text-align: center;}.qui-slidConfirm{position:absolute;z-index:1300;top:75pt;left:75pt;border:1px solid #ccc;padding:10px;background-color:#fff;box-shadow:0 0 6px #aaa}.qui-slidConfirm-bottom{margin-top:10px;text-align:center}.qui-slidConfirm-text{background-image:url(//fed.static.qyer.com/core/web/common/resource/ui/oldslidconfirm/icons.png);background-repeat:no-repeat;display:inline-block;padding-left:20px;background-position:0 -79px;text-align:center}.qui-select{position:relative;display:inline-block;width:75pt;height:30px;overflow:visible}.qui-select-disable>.titles{background-color:#eee!important;cursor:default!important}.qui-select .contents ul li,.qui-select .titles{font-size:14px;cursor:pointer;text-overflow:ellipsis}.qui-select .titles{background:url(//fed.static.qyer.com/core/web/common/resource/ui/oldselect/icons.png) center right no-repeat #fff;border:1px solid silver;color:#636363;display:block;line-height:30px;padding:0 10px 0 5px;width:100%;height:100%;overflow:hidden}.qui-select .titles .title-text{background-position:0 -4px;margin-left:5px;white-space:nowrap}.qui-select .contents{background-color:#FFF;border:1px solid silver;box-shadow:0 1px 2px rgba(0,0,0,.1);display:none;line-height:38px;position:absolute;top:31px;width:180px;max-height:235px;overflow:auto;z-index:10}.qui-select .contents ul li:first-child{border-top:0 none}.qui-select .contents ul li{border-top:1px solid #EBEBEB;line-height:38px;white-space:nowrap;overflow:hidden}.qui-select .contents ul li:hover{background-color:#d9eed7}.qui-select .contents ul li a{padding-left:10px;color:#636363;text-decoration:none}\n.tools{width: 24px;padding: 0 23px;float: left;}\n.tools div span{width: 24px;height: 24px;background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat;display: inline-block;}\n.tools div i{display: none;width: 2px;height: 16px;background: #10b041;position: relative;top: 5px;}\n.tools div.selected i{display: inline-block;}\n.tools .lift{background-position:-32px -163px;}\n.tools .faces{background-position:-32px -199px;}\n.tools .insertimage{background-position: -32px -235px;}\n.tools .insertvideo{background-position: -32px -271px;}\n.tools .insertattach{background-position: -32px -307px;}\n.tools .help{background-position: -132px -164px;}\n.tools .lift:hover{background-position:-110px -163px;}\n.tools .selected .lift{background-position:-110px -163px;}\n.tools .faces:hover { background-position:-110px -199px;}\n.tools .selected .faces{background-position:-110px -199px;}\n.tools .insertimage:hover{background-position: -110px -235px;}\n.tools .selected .insertimage{background-position:-110px -235px;}\n.tools .insertvideo:hover{background-position: -110px -271px;}\n.tools .insertattach:hover{background-position: -110px -307px;}\n.tools .help:hover{background-position: -155px -164px;}\n.tool_content{width: 170px;float: right;padding-top: 8px;}\n.tool_content .lift_cont{height: 200px;overflow: auto;}\n.tool_content .lift_cont .lift_head{position: relative;}\n.tool_content .lift_cont .lift_head .reload{position: absolute;right: 8px;top: 3px;}\n.tool_content .lift_cont h3{color: #10b041;font-size: 14px;font-weight: 400;}\n.tool_content .lift_cont h4,.container .tool_content .lift_cont ul li{height: 18px;margin-top:4px;overflow: hidden;text-overflow:ellipsis;white-space:nowrap;}\n.tool_content .lift_cont h4 span{color: #636363;font-size: 12px;cursor:pointer;}\n.tool_content .lift_cont ul{margin-top: 4px;padding-left: 15px;overflow: hidden;}\n.tool_content .lift_cont ul li span{color: #959595;font-size: 12px;line-height: 18px;cursor:pointer;}\n.tool_content .lift_cont span:hover{text-decoration: none;color: #10b041;}\n.tool_content .lift_cont .lift_body{margin-top: 23px;}\n.tool_content .emotion_cont span{background-image: url(//static.qyer.com/models/project/bbs/css/images/emotion.png); display: inline-block; width: 24px; height: 24px; float: left; margin: 4px ; border: 1px solid #fff;cursor:pointer;}\n.tool_content .emotion_cont span:hover{border: 1px solid #c0c0c0; }\n.tool_content .image_cont .buttons{margin-top: 8px;}\n.tool_content .image_cont{width: 100%; display: block; padding: 0; border-radius: 0;}\n.tool_content .image_cont .lists {overflow: auto; width: 184px; min-height: 300px;position: relative;margin-top: 10px;}\n.tool_content .image_cont .lists ul{margin-left: -10px;}\n.tool_content .image_cont .lists ul li{margin: 0 0 0 8px;float: left;}\n.tool_content .image_cont .lists ul li img{display: block;width: 80px;height: 80px;margin-top: 8px;cursor: pointer;}\n.tool_content .image_cont .qui-select{height: auto;}\n.tool_content .image_cont .qui-select .titles{line-height: 24px;height: 24px;padding-right: 28px;}\n.tool_content .image_cont .qui-select .contents{top: 25px;}\n.tool_content .image_cont .qui-select .contents ul li{line-height: 30px;}\n.tool_content .image_cont .ui_button{padding: 1px 28px 0;border-radius:0;background-color:#10b041;font-size: 12px;height: 27px;white-space: nowrap;}\n.tool_content .image_cont .ui_button:hover{background-color: #3f9f5f;}\n.tool_content .image_cont .ui_button .add{display: inline-block;width: 12px;height: 12px;background: url(//static.qyer.com/models/project/bbs/css/images/add.png) no-repeat;float: left;margin: 7px 5px 0 0;}\n.tool_content .image_cont .uploadPanel { display: none; position: absolute; z-index: 10; top: 0; left: 0; width: 100%; height: 100%;}\n.tool_content .image_cont .scrollTip{width: 64px;height: 20px;line-height: 20px;text-align: center;background: url(//static.qyer.com/models/project/bbs/css/images/img_tip.png) no-repeat;position: absolute;left: 166px;top:95px;display: none;color: #636363;}\n@-webkit-keyframes rotate {\n  from {-webkit-transform:rotate(0deg);}\n  to {-webkit-transform:rotate(360deg);}\n}\n.animateRotate{\n  -webkit-animation-name: rotate;\n  -webkit-animation-duration: 0.5s;\n  -webkit-animation-iteration-count: 1;\n  -webkit-animation-timing-function: linear;\n}\n.editor_uploadImage .qui-popup2-box-content,.editor_concatpoi .qui-popup2-box-content{padding: 0;}\n.qyEdit_append_pic { width:620px; border:1px solid #c0c0c0; background:#fff; box-shadow:0 2px 7px rgba(0,0,0,0.25); margin:0 auto;}\n.editor_uploadImage .qyEdit_append_wrap{\n  height: 261px;\n}\n.editor_uploadImage .qyEdit_append_title,.editor_concatpoi .qyEdit_append_title{\n  border-bottom: 1px solid #c0c0c0;\n  box-shadow: 0 1px 3px #ccc;\n}\n.qyEdit_append_button .tips { float:left; color:#959595; line-height:28px;}\n.qyEdit_append_button .checkBox { float:right; padding-right:10px;}\n.qyEdit_append_button .checkBox label { float:left; color:#959595;}\n.qyEdit_append_button .checkBox input { margin:6px 5px 0 0; float:left; width:14px; height:14px;}\n.qyEdit_append_button .checkBox p { float:left; line-height:28px;}\n.qyEdit_append_wrap { height:260px; overflow:hidden; overflow-y:auto; border-bottom:1px solid #c0c0c0;}\n.qyEdit_append_list { padding-bottom:20px;}\n.qyEdit_append_list li { width:100px; float:left; margin:20px 0 0 20px; position:relative;}\n.qyEdit_append_list li img { width:100px; height:100px; display:block; background:#ececec;}\n.qyEdit_append_list li .rotate { display:none; position:absolute; left:0; bottom:0; right:0; background:#575757; background:rgba(0,0,0,0.8); padding:0 14px; height:30px;}\n.qyEdit_append_list li .rotate span { background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat; height:30px; text-indent:-9999px; width:50%; float:left; cursor:pointer;}\n.qyEdit_append_list li .rotate .left { background-position:-30px -16px;}\n.qyEdit_append_list li .rotate .left:hover { background-position:-30px 7px;}\n.qyEdit_append_list li .rotate .right { background-position:-68px -16px;}\n.qyEdit_append_list li .rotate .right:hover { background-position:-68px 7px;}\n.qyEdit_append_list li .error { position:absolute; left:0; right:0; top:0; bottom:0; border:1px solid #fb6850; background:rgba(0,0,0,0); text-align:center;}\n.qyEdit_append_list li .error .icon { background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat 0 -385px; display:inline-block; width:16px; height:16px; margin:13px auto 0;}\n.qyEdit_append_list li .error .tips { display:block; line-height:24px; color:#959595;}\n.qyEdit_append_list li .error a { color:#323232;}\n.qyEdit_append_list li .error a:hover { color:#10b041;}\n.qyEdit_append_list li .delete { position:absolute; right:-7px; top:-7px; background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat -114px 0; width:20px; height:19px; overflow:hidden; text-indent:-9999px; cursor:pointer;}\n.qyEdit_append_list li .tArrow { white-space:nowrap; border:1px solid #d7d7d7; background:#f5f5f5; border-radius:3px; position:absolute; left:0; top:-20px; padding:3px 8px; line-height:16px; color:#959595;}\n.qyEdit_append_list li .tArrow .arrow0 { position:absolute; bottom:-6px; left:45%; height:6px; display:inline-block;}\n.qyEdit_append_list li .tArrow .arrow0 span { display:inline-block; height:0; width:0; overflow:hidden; position:absolute; top:0;}\n.qyEdit_append_list li .tArrow .arrow1 { left:1px; z-index:1; border-left:6px solid transparent; border-right:6px solid transparent; border-top:6px solid #f5f5f5;}\n.qyEdit_append_list li .tArrow .arrow2 { left:0; z-index:0; border-left:7px solid transparent; border-right:7px solid transparent; border-top:7px solid #d7d7d7;}\n.qyEdit_append_list li .loading { padding:0 10px; position:absolute; left:0; right:0; top:0; bottom:0;width: auto;}\n.qyEdit_append_list li .loading span { margin-top:47px; display:block; overflow:hidden; height:5px; background:#c0c0c0; border-radius:3px;}\n.qyEdit_append_list li .loading span em { display:block; background:#5cad77; border-radius:3px; overflow:hidden; height:5px;}\n.editor_concatpoi .qyEdit_append_button { padding:20px; height:28px;}\n.editor_concatpoi .qyEdit_append_button .button a { float:right; margin-left:10px;}\n.editor_concatpoi .qyEdit_append_button .tips { float:left; color:#959595; line-height:28px;}\n.editor_concatpoi .qyEdit_append_button .tips a { color:#959595;}\n.editor_concatpoi .qyEdit_append_button .place { float:left; padding-left:20px; background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) 0 -570px no-repeat; display: none;position: relative;}\n.editor_concatpoi .qyEdit_append_button .place input { border-radius:3px; float:left; padding:1px 7px; width:230px;}\n.editor_concatpoi .qyEdit_append_button .place .error { border:1px solid #fb6850;}\n.editor_concatpoi .qyEdit_append_button .place .tText { float:left; line-height:28px; margin-left:10px; color:#fb6850;display: none;}\n.editor_concatpoi .qyEdit_append_button .place .tText em { width:16px; height:16px; background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat 0 -385px; float:left; margin:5px 5px 0 0;}\n.editor_concatpoi .qyEdit_append_list { padding-bottom:20px;}\n.editor_concatpoi .qyEdit_append_list li { width:100px; float:left; margin:20px 0 0 20px; position:relative;}\n.editor_concatpoi .qyEdit_append_list li img { width:100px; height:100px; display:block; background:#ececec;}\n.editor_concatpoi .qyEdit_append_list li .status { display:none; height:100px; width:100px; position:absolute; left:0; top:0;}\n.editor_concatpoi .qyEdit_append_list li .status span { position:absolute; left:34px; top:34px; width:32px; height:32px; display:block; background:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat;}\n.editor_concatpoi .qyEdit_append_list li .status .selected { background-position:0 -416px;}\n.editor_concatpoi .qyEdit_append_list li .place { position:absolute; left:0; right:0; bottom:0;background-color:transparent;background-color:rgba(48,51,51,0.8);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#7F303333,endColorstr=#7F434345);line-height:30px;color:#fff;display: none;}\n.editor_concatpoi .qyEdit_append_list li .place strong {position:absolute;left:10px;top:-1px;width:12px;height:16px;background: url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png) no-repeat -124px -385px;}\n.qui-inputAutocomplete{top:-1px;}\n.qui-inputAutocomplete ul { border-top:1px solid #d7d7d7;}\n.qui-inputAutocomplete ul li{font-size: 12px;color: #636363;padding:0 23px 0 7px; line-height:28px; height:28px; width:100%; text-overflow:ellipsis; white-space:nowrap; overflow:hidden;\n-webkit-box-sizing:border-box; -moz-box-sizing:border-box; box-sizing:border-box;\n}\n.qui-inputAutocomplete ul .active { background:#e3fae3; cursor:pointer;}\n.qui-inputAutocomplete ul .lastChild { border-top:1px solid #ececec;}\n.qui-inputAutocomplete ul li .poiname{padding-right:10px;}\n.qui-inputAutocomplete ul li .country{color: #959595;}\n.qui-inputAutocomplete ul li .kw{color: #10b041;}\n.pub-threadhelp-wrap{position:fixed;bottom:0;left:0;right:0;height:400px;background-color:#f5f5f5;border-top:2px solid #10b041;z-index:9999;overflow:hidden;}\n.pub-threadhelp-wrap .x-header a{\n\tfloat:right;\n\twidth:24px;\n\theight:24px;\n\tmargin:20px 40px 0 0;\n\tbackground-image:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png);\n\tbackground-repeat:no-repeat;\n\tbackground-position:-40px -418px;\n}\n.pub-threadhelp-wrap .x-header a:hover{\n\tbackground-position:-93px -418px; \n}\n.x-header{position:relative;height:39px;}\n.pub-threadhelp-wrap .x-header p{\n\tposition:absolute;\n\tleft:9%;\n\ttop:-1px;\n\twidth:114px;\n\theight:39px;\n\t\n\tbackground:url(//static.qyer.com/models/project/bbs/css/images/x-publish-help.jpg) no-repeat;\n\tz-index:2000;\n}\n.pub-threadhelp-wrap .x-footer{\n\ttext-align:center;\n}\n.pub-threadhelp-wrap .x-footer a{\n\tdisplay:inline-block;\n\t*display:inline;\n\t*zoom:1;\n\twidth:17px;\n\theight:11px;\n\tmargin-right:6px;\n\tbackground-image:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png);\n\tbackground-repeat: no-repeat;\n\tbackground-position:-119px -418px;\n}\n.pub-threadhelp-wrap .x-footer a.active,\n.pub-threadhelp-wrap .x-footer a:hover{\n\twidth:17px;\n\theight:10px;\n\tbackground-position:-122px -432px;\n}\n.pub-threadhelp-wrap .x-content{position:relative;width:900px;height:292px;padding-bottom:25px;margin:0 auto;text-align:center;}\n.pub-threadhelp-wrap .xcd{\n\tposition: relative;\n\t\n\theight:292px;\n\twidth:25px;\n\ttext-align:center;\n}\n.xfl{float:left;}\n.xfr{float:right;}\n.pub-threadhelp-wrap .xcd i{\n\tposition: absolute;\n\tbottom:0;\n\ttop:0;\n\tleft:0;\n\tright:0;\n\tmargin:auto;\n\twidth:19px;\n\theight:36px;\n\tbackground-image:url(//static.qyer.com/models/project/bbs/css/images/editor_icon.png);\n\tbackground-repeat:no-repeat;\n\tcursor:pointer;\n}\n.pub-threadhelp-wrap .xcd .xleft{\n\tbackground-position:-56px -452px;\n}\n.pub-threadhelp-wrap .xcd .xleft:hover{\n\tbackground-position:-101px -452px;\n}\n.pub-threadhelp-wrap .xcd .xright{\n\tbackground-position:-78px -452px;\n}\n.pub-threadhelp-wrap .xcd .xright:hover{\n\tbackground-position: -36px -452px;\n}\n.pub-threadhelp-wrap .xcimages{\n\tposition: relative;\n\tdisplay: inline-block;\n\t*display:inline;\n\t*zoom:1;\n\twidth:660px;\n\theight:240px;\n}\n.pub-gifwrap{\n\tposition:absolute;\n\tdisplay:none;\n\tleft:0;\n\ttop:-8px;\n}\n.x-pubdesc-wrap{\n\twidth:600px;\n\tmargin:0 auto;\n\ttext-align: left;\n}\n.x-pubdesc-wrap > div{\n\tdisplay:inline-block;\n}\n.x-pubnum{\n\tposition:absolute;\n\tmargin-top:-166px;\n\tfont-size:200px;\n\tfont-weight:bold;\t\n\tcolor:#f6e9e8;\n}\n.x-pubdesc1{\n\tmargin:-3px 0 0 122px;\n}\n.x-pubdesc2{\n\tmargin:-3px 0 0 130px;\n}\n.x-pubdesc3,.x-pubdesc4{\n\tmargin:-21px 0 0 130px;\n}\n.x-pubdesc5,.x-pubdesc6{\n\tmargin:33px 0 0 130px;\n}\n.x-pubdesc-title{\n\tline-height:42px;\n\tcolor:#fb6850;\n\tfont-size:24px;\n\tfont-weight:bold;\n}\n.x-pubdesc-content{\n\twidth:415px;\n\theight:40px;\n\tline-height:20px;\n\toverflow:hidden;\n\tcolor:#636363;\n\tfont-size:16px;\n\tword-wrap:break-word;\n\tword-break:break-all;\n}\n.x-edithread-info{\n    position:absolute;\n    right:152px;\n    top:15px;\n    height:18px;\n    font-size:14px;\n    color:#636363;\n    cursor:pointer;\n}\n.x-edithread-info:hover{text-decoration:none;color:#10b041;}\n.x-edithread-info:hover .xei-setting{\n    background-position:-12px 0;\n}\n.xei-setting{display:inline-block;margin-right:7px;width:12px;height:12px;vertical-align:-1px;background:url(//common1.qyerstatic.com/bbs/old/images/issue_settag.png) no-repeat;}\n.tools-inner-wrap{position:relative;float:left;width:24px;height:24px;margin:6px 0;cursor:pointer;}\n.reload {\n  background: url(//static.qyer.com/models/project/bbs/css/images/reload.png) no-repeat;\n  width: 16px;\n  height: 13px;\n  display: block;\n  cursor: pointer;\n}\n#addPhotoWrap{width:166px;}\n.x-tool-wrap{\n\tposition:absolute;\n\tleft:26px;\n\ttop:0;\n\tvisibility: hidden;\n\topacity:0;\n\tmin-width:78px;\n\t-webkit-transition:all 0.3s linear;\n\t-moz-transition:all 0.3s linear;\n\ttransition:all 0.3s linear;\n\tz-index:1000;\n}\n.x-tool-left{\n\tfloat:left;\n\twidth:10px;\n\theight:26px;\n\tbackground:url(//static.qyer.com/models/project/bbs/images/tooltipleft.png) no-repeat;\n}\n.x-tool-xtm{\n\tfloat:left;\t\n\tpadding:0 4px;\n\tline-height:26px;\n\tword-wrap:break-word;\n\tword-break:break-all;\n\tcolor:#959595;\n\tbackground:url(//static.qyer.com/models/project/bbs/images/tagtip.png) repeat-x;\n}\n.x-tool-right{\n\tfloat:left;\n\twidth:4px;\n\theight:26px;\n\tbackground:url(//static.qyer.com/models/project/bbs/images/tooltipright.png) no-repeat;\n}\n.tools .tools-inner-wrap:hover .x-tool-wrap{display:block;visibility: visible;opacity: 1}\n..qui-popup2{z-index:4000 !important;}\n.x-contact-tips{float:left;line-height:30px;color:#959595;}\n.x-ui-input{\n\twidth:200px;\n\theight: 20px;\n\tmargin:0 6px;\n\toverflow: hidden;\n\tpadding: 3px 7px;\n\tborder: 1px solid #c0c0c0;\n\tfont-size: 14px;\n\tline-height: 20px;\n\tborder-radius: 3px;\n  }\n.x-ao-dest{\n\tdisplay:inline-block;\n\t*display:inline;\n\t*zoom:1;\n\tbackground-image:url(//static.qyer.com/models/project/bbs/images/aoDestination.png);\n\tbackground-position:no-repeat;\n}\n.x-ao-pos1{\n\twidth:12px;\n\theight:16px;\n\tbackground-position:-1px -1px;\n\tvertical-align: -2px;\n}\n.x-ao-pos2{\n\twidth:16px;\n\theight:16px;\n\tmargin-right:6px;\n\tvertical-align: -4px;\n\tbackground-position:-1px -19px;\n}\n#contactPlaceCon{display:none;}\n.qyEdit_append_pic .place .con-des{display:inline-block;*display:inline;*zoom:1;width:66px;margin-left:28px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:bold;vertical-align:-12px;}\n.qyEdit_append_pic .place .qui-inputAutocomplete{left:148px;top:44px;z-index:3000;}\n.qyEdit_append_pic .place .tText{color:#ff654c;}\n.x-btl-wrap{padding-top:8px;color:#959595;}\n#checkedXAll{vertical-align: 1px;}\n.x-btl-wrap label{margin:0 20px 0 6px;color:#636363;}\n.x-ischecked{position:absolute;width:100px;height:100px;cursor:pointer;z-index:2000;}\n.x-ischecked.unchecked{background:url(//static.qyer.com/models/project/bbs/images/xunchecked.png) no-repeat;}\n.x-ischecked.checked{background:url(//static.qyer.com/models/project/bbs/images/xchecked.png) no-repeat;}\n.qui-tip{z-index:5000 !important;}\n.image_cont #photolist .contents{width:164px !important;} \n@media screen and (-webkit-min-device-pixel-ratio: 2),\nscreen and (max-moz-device-pixel-ratio: 2){\n   .xei-setting{\n          background:url(//common1.qyerstatic.com/bbs/old/images/issue_settag.png) no-repeat 0 -7px/12px auto;\n     } \n    .x-edithread-info:hover .xei-setting{background-position:0 -20px}\n       \n}\n");